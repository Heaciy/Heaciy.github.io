<!DOCTYPE html>
<html lang="en-us" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="‰ªéObserver patternÂà∞Django signal">
<title>Django SignalÁÆÄÊûê</title>

<link rel='canonical' href='https://heaciy.com/p/django-signal-principle-analysis/'>

<link rel="stylesheet" href="/scss/style.min.7f5ba5a3e5ae89e65fac327867461cc61100abc64c8e215bbfd2701fceb40575.css"><meta property='og:title' content="Django SignalÁÆÄÊûê">
<meta property='og:description' content="‰ªéObserver patternÂà∞Django signal">
<meta property='og:url' content='https://heaciy.com/p/django-signal-principle-analysis/'>
<meta property='og:site_name' content='Heaciy&#39;s Blog'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='python' /><meta property='article:tag' content='django' /><meta property='article:published_time' content='2021-06-10T00:00:00&#43;00:00'/><meta property='article:modified_time' content='2021-06-10T00:00:00&#43;00:00'/><meta property='og:image' content='https://images.unsplash.com/photo-1494129935429-873eafa78178?crop=entropy&amp;amp;cs=tinysrgb&amp;amp;fit=max&amp;amp;fm=jpg&amp;amp;ixid=MXwxMTc3M3wwfDF8c2VhcmNofDF8fHNpZ25hbHN8ZW58MHx8fA&amp;amp;ixlib=rb-1.2.1&amp;amp;q=80&amp;amp;w=2000' />
<meta name="twitter:title" content="Django SignalÁÆÄÊûê">
<meta name="twitter:description" content="‰ªéObserver patternÂà∞Django signal"><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='https://images.unsplash.com/photo-1494129935429-873eafa78178?crop=entropy&amp;amp;cs=tinysrgb&amp;amp;fit=max&amp;amp;fm=jpg&amp;amp;ixid=MXwxMTc3M3wwfDF8c2VhcmNofDF8fHNpZ25hbHN8ZW58MHx8fA&amp;amp;ixlib=rb-1.2.1&amp;amp;q=80&amp;amp;w=2000' />
    <link rel="shortcut icon" href="/favicon.ico" />

    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="Toggle Menu">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu6707014650456449175.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">üç•</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">Heaciy&#39;s Blog</a></h1>
            <h2 class="site-description">Life is what happens to you while you&#39;re busy making other plans.</h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://github.com/heaciy'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://twitter.com/heaciy'
                        target="_blank"
                        title="Twitter"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c-.002 -.249 1.51 -2.772 1.818 -4.013z" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>Home</span>
            </a>
        </li>
        
        
        <li >
            <a href='/about/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>About</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archives</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>Dark Mode</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">Table of contents</h2>

        
            <div class="widget--toc--custom">
                <nav id="TableOfContents">
  <ol>
    <li><a href="#ËßÇÂØüËÄÖÊ®°Âºè">ËßÇÂØüËÄÖÊ®°Âºè</a></li>
    <li><a href="#signalÁÆÄËø∞">SignalÁÆÄËø∞</a>
      <ol>
        <li><a href="#1-signal">1. signal</a></li>
        <li><a href="#2-sender">2. sender</a></li>
        <li><a href="#3-receiver">3. receiver</a></li>
      </ol>
    </li>
    <li><a href="#ÂéüÁêÜÁÆÄÊûê">ÂéüÁêÜÁÆÄÊûê</a>
      <ol>
        <li><a href="#1-signalÁöÑÂ±ûÊÄßÂíå__init__ÊñπÊ≥ï">1. SignalÁöÑÂ±ûÊÄßÂíå__init__ÊñπÊ≥ï</a></li>
        <li><a href="#2-signal‰∏≠ÁöÑÊñπÊ≥ï">2. Signal‰∏≠ÁöÑÊñπÊ≥ï</a></li>
        <li><a href="#3-Â§ßÊ¶ÇÊµÅÁ®ã">3. Â§ßÊ¶ÇÊµÅÁ®ã</a></li>
        <li><a href="#4-ÂæàÂ•áÊÄ™ÁöÑ‰∏ÄÁÇπ">4. ÂæàÂ•áÊÄ™ÁöÑ‰∏ÄÁÇπ</a></li>
        <li><a href="#5-Â§öËØ¥‰∏ÄÂè•">5. Â§öËØ¥‰∏ÄÂè•</a></li>
      </ol>
    </li>
    <li><a href="#Ê∫êÁ†ÅÁÆÄÊûê">Ê∫êÁ†ÅÁÆÄÊûê</a></li>
    <li><a href="#‰∏Ä‰∫õÂèØËÉΩÊúâÁî®ÁöÑÈìæÊé•">‰∏Ä‰∫õÂèØËÉΩÊúâÁî®ÁöÑÈìæÊé•</a></li>
  </ol>
</nav>
            </div>
        
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="has-image main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/p/django-signal-principle-analysis/">
                
                    <img src="https://images.unsplash.com/photo-1494129935429-873eafa78178?crop=entropy&amp;amp;cs=tinysrgb&amp;amp;fit=max&amp;amp;fm=jpg&amp;amp;ixid=MXwxMTc3M3wwfDF8c2VhcmNofDF8fHNpZ25hbHN8ZW58MHx8fA&amp;amp;ixlib=rb-1.2.1&amp;amp;q=80&amp;amp;w=2000" loading="lazy" alt="Featured image of post Django SignalÁÆÄÊûê" />
                
            </a>
        </div>
    

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/cs/" >
                CS
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/django-signal-principle-analysis/">Django SignalÁÆÄÊûê</a>
        </h2>
    
        
        <h3 class="article-subtitle">
            ‰ªéObserver patternÂà∞Django signal
        </h3>
        
    </div>

    
    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Jun 10, 2021</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    12 minute read
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <blockquote>
<p>ÊàëÊâøËÆ§ÔºåÊòØÊ†áÈ¢òÂÖöÔºÅÂìàÂìàÂìàÂìàÂìàÂìàÂìàÔºåÊú¨Êù•ÊòØÂáÜÂ§áÂÜô‰∏ÄÁØá‚ÄúDjango SignalÊ∫êÁ†ÅËß£Êûê‚Äî‚Äî‰ªéObserver PatternÂà∞Django Signal‚ÄùÁöÑÔºå‰ΩÜÊòØÊàëÂèà‰∏çËÉΩ‰∏Ä‰∏§Âè•ËØùÊääËßÇÂØüËÄÖÊ®°ÂºèËÆ≤Ê∏ÖÊ•öÁöÑÔºåÂπ≤ËÑÜÂ∞±Áõ¥Êé•Ë¥¥‰∫Ü‰∏Ä‰∫õÁõ∏ÂÖ≥ÁöÑÈìæÊé•‚Ä¶‚Ä¶ÂêéÈù¢Ë∂äÂÜôË∂äÂ§ö„ÄÅË∂äÊãñË∂äÈïøÂ∞±Âπ≤ËÑÜÊîπÊàêÁÆÄÊûêÁÆó‰∫Ü‚Ä¶‚Ä¶<br/>
Êú¨ÊñáÂè™‰Ωú‰∏∫‰∏™‰∫∫Â≠¶‰π†ËÆ∞ÂΩïÔºå‰ªÖ‰æõÂèÇËÄÉÔºåÂ¶ÇÊúâËØØÊ¨¢ËøéËÆ®ËÆ∫ÊåáÊ≠£<br/>
È¢òÂõæÊù•Ëá™ unsplashÔºå<a class="link" href="https://images.unsplash.com/photo-1494129935429-873eafa78178?crop=entropy&amp;amp;cs=tinysrgb&amp;amp;fit=max&amp;amp;fm=jpg&amp;amp;ixid=MXwxMTc3M3wwfDF8c2VhcmNofDF8fHNpZ25hbHN8ZW58MHx8fA&amp;amp;ixlib=rb-1.2.1&amp;amp;q=80&amp;amp;w=2000"  target="_blank" rel="noopener"
    >ÂéüÂõæÈìæÊé•üîó</a></p>
</blockquote>
<h2 id="ËßÇÂØüËÄÖÊ®°Âºè">ËßÇÂØüËÄÖÊ®°Âºè
</h2><p>‚ÄúËßÇÂØüËÄÖÊ®°ÂºèÊòØ‰∏ÄÁßçÂØπË±°Ë°å‰∏∫Ê®°Âºè„ÄÇÂÆÉÂÆö‰πâÂØπË±°Èó¥ÁöÑ‰∏ÄÁßç‰∏ÄÂØπÂ§öÁöÑ‰æùËµñÂÖ≥Á≥ªÔºåÂΩì‰∏Ä‰∏™ÂØπË±°ÁöÑÁä∂ÊÄÅÂèëÁîüÊîπÂèòÊó∂ÔºåÊâÄÊúâ‰æùËµñ‰∫éÂÆÉÁöÑÂØπË±°ÈÉΩÂæóÂà∞ÈÄöÁü•Âπ∂Ë¢´Ëá™Âä®Êõ¥Êñ∞„ÄÇ<a class="link" href="https://baike.baidu.com/item/%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F/5881786"  target="_blank" rel="noopener"
    >[1]</a>‚Äù</p>
<p>‚ÄúËßÇÂØüËÄÖÊ®°ÂºèÊòØ‰∏ÄÁßçË°å‰∏∫ËÆæËÆ°Ê®°ÂºèÔºå ÂÖÅËÆ∏‰Ω†ÂÆö‰πâ‰∏ÄÁßçËÆ¢ÈòÖÊú∫Âà∂Ôºå ÂèØÂú®ÂØπË±°‰∫ã‰ª∂ÂèëÁîüÊó∂ÈÄöÁü•Â§ö‰∏™ ‚ÄúËßÇÂØü‚Äù ËØ•ÂØπË±°ÁöÑÂÖ∂‰ªñÂØπË±°„ÄÇ<a class="link" href="https://refactoringguru.cn/design-patterns/observer"  target="_blank" rel="noopener"
    >[2]</a>‚Äù</p>
<p>ËßÇÂØüËÄÖÊ®°ÂºèÊúâÂ§öÁßçÂÆûÁé∞ÊñπÂºèÔºåÊØîËæÉÁªèÂÖ∏ÁöÑ‰∏ÄÁßçÂÆûÁé∞ÔºåÊúâÂõõ‰∏™ËßíËâ≤ÔºöSubjectÔºàË¢´ËßÇÂØüÂØπË±°ÊäΩË±°Á±ªÔºâ„ÄÅObserverÔºàËßÇÂØüËÄÖÊäΩË±°Á±ªÔºâ„ÄÅConcreateObserverÔºàÂÖ∑‰ΩìËßÇÂØüËÄÖÔºâ„ÄÅConcreateSubject(ÂÖ∑‰ΩìÁöÑË¢´ËßÇÂØüËÄÖ)‚Ä¶‚Ä¶</p>
<p>ËøôÈáåÂ∞±‰∏çËµòËø∞‰∫Ü‚Ä¶‚Ä¶ÂèØ‰ª•ÂèÇËßÅ‰∏ãÈù¢ÁöÑÈìæÊé•</p>
<ul>
<li><a class="link" href="https://en.wikipedia.org/wiki/Observer_pattern"  target="_blank" rel="noopener"
    >wikipediaÔºöObserver pattern</a></li>
<li><a class="link" href="https://baike.baidu.com/item/%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F/5881786"  target="_blank" rel="noopener"
    >ÁôæÂ∫¶ÁôæÁßëÔºöËßÇÂØüËÄÖÊ®°Âºè</a></li>
<li><a class="link" href="http://c.biancheng.net/view/1390.html"  target="_blank" rel="noopener"
    >ËßÇÂØüËÄÖÊ®°ÂºèÔºàObserverÊ®°ÂºèÔºâËØ¶Ëß£</a></li>
<li><a class="link" href="https://refactoringguru.cn/design-patterns/observer"  target="_blank" rel="noopener"
    >ËßÇÂØüËÄÖÊ®°Âºè</a></li>
<li><a class="link" href="https://www.runoob.com/design-pattern/observer-pattern.html"  target="_blank" rel="noopener"
    >ËèúÈ∏üÊïôÁ®ãÔºöËßÇÂØüËÄÖÊ®°Âºè</a></li>
<li><a class="link" href="https://juejin.cn/post/6844903471586476039"  target="_blank" rel="noopener"
    >ËßÇÂØüËÄÖÊ®°ÂºèÁöÑpythonÁÆÄÂçïÂÆûÁé∞</a></li>
</ul>
<h2 id="signalÁÆÄËø∞">SignalÁÆÄËø∞
</h2><p>ÂèØ‰ª•ÂÖàÁúãÁúãDjangoÁöÑÂÆòÊñπÊñáÊ°£</p>
<ul>
<li><a class="link" href="https://docs.djangoproject.com/zh-hans/3.0/topics/signals/"  target="_blank" rel="noopener"
    >https://docs.djangoproject.com/zh-hans/3.0/topics/signals/</a></li>
<li><a class="link" href="https://docs.djangoproject.com/zh-hans/3.0/ref/signals/"  target="_blank" rel="noopener"
    >https://docs.djangoproject.com/zh-hans/3.0/ref/signals/</a></li>
</ul>
<p>‰∏éËßÇÂØüËÄÖÊ®°ÂºèÂØπÂ∫îÔºösenderÂ∞±ÊòØË¢´ËßÇÂØüËÄÖ„ÄÅreceiverÊòØËßÇÂØüËÄÖ„ÄÇÊúâÊâÄ‰∏çÂêåÁöÑÂ∞±ÊòØÂ§ö‰∫Ü‰∏™signalÔºå‰πüÂ∞±ÊòØ‚Äú‰ø°Âè∑‚ÄùÔºà‰πüÂèØ‰ΩøËØ¥ÊòØ‰ø°Âè∑ÁöÑ‚ÄúÁÆ°ÁêÜËÄÖ‚ÄùÔºâ„ÄÇÂú®ÊôÆÈÄöËßÇÂØüËÄÖÊ®°Âºè‰∏≠ÔºåË¢´ËßÇÂØüÂØπË±°ÊäΩË±°Á±ª‰∏≠‰∏ÄËà¨‰ºöÁª¥Êä§‰∏Ä‰∏™ËßÇÂØüËÄÖÊäΩË±°Á±ªÁöÑÂºïÁî®ÂàóË°®Ôºå‰ª•Ê≠§Êù•‰º†ÈÄíÊ∂àÊÅØÔºåËÄådjango‰∏≠ÂàôÊòØÂÄüÂä©SignalÁ±ªËøõ‰∏ÄÊ≠•Ëß£ËÄ¶ÔºåÈÄöËøáSignalÁ±ªËøõË°å‚Äú‰ø°Âè∑‰º†ÈÄí‚ÄùÔºåÂÖ∑‰ΩìËß£ÊûêÂ¶Ç‰∏ãÔºö</p>
<h3 id="1-signal">1. signal
</h3><p>‰ø°Âè∑Á±ªÔºåÁª¥Êä§‰∏Ä‰∏™receiversÂàóË°®ÔºåÁî®‰∫éÂ≠òÂÇ®senderÂíåreceiverÁöÑÂØπÂ∫îËÆ∞ÂΩï</p>
<p><code>signal.connect()</code>Áî®‰∫éÂæÄ<code>signal.receivers</code>‰∏≠Ê∑ªÂä†ÂØπÂ∫îÁöÑreceiverÂíåsenderËÆ∞ÂΩï</p>
<p><code>signal_send()</code>ÔºåÂú®<code>signal.receivers</code>‰∏≠Êü•ÊâæsenderÂØπÂ∫îÁöÑreceiversÂπ∂Â∞ÜÂØπÂ∫î‰ø°Âè∑(ÂèÇÊï∞)‰º†ÈÄíÁªôÂØπÂ∫îÁöÑreceivers</p>
<p>djangoÈ¢ÑÁΩÆ‰∫Ü‰∏Ä‰∫õ‰ø°Âè∑ÂØπË±°Ôºåpre_init„ÄÅpost_init„ÄÅpre_save„ÄÅpost_saveÁ≠âÔºåËøô‰∫õÈÉΩÊòØÁõ¥Êé•ÊàñÈó¥Êé•ÁöÑÁªßÊâøËá™SiganlÁ±ªÔºåÂçï‰∏ÄËÅåË¥£ÂéüÂàôÔºåÊØè‰∏™ÂÖ∑‰ΩìÁöÑ‰ø°Âè∑ÂØπË±°Âè™Ë¥üË¥£Â≠òÂÇ®‚Äú‰∏ÄÁ±ª‰ø°Âè∑‚ÄùÔºåÊØîÂ¶ÇÂâçÈù¢Âàó‰∏æÁöÑÂõõ‰∏™‰ø°Âè∑ÂØπË±°ÈÉΩÊòØdjango modelÁõ∏ÂÖ≥ÁöÑ„ÄÇ‰ª•pre_save‰∏∫‰æãÔºåÂè™ÊúâÂú®Ë∞ÉÁî®Êüê‰∏™modelÂØπË±°ÁöÑsaveÊñπÊ≥ïÊó∂ÔºàÂâçÔºâÊâç‰ºöË∞ÉÁî®pre_save.send()ÂèëÈÄÅÁõ∏ÂÖ≥Êï∞ÊçÆÔºà‚Äú‰ø°Âè∑‚ÄùÔºâ„ÄÇ‰πüÂ∞±ÊòØËØ¥pre_saveËøô‰∏™SignalÂØπË±°ÁöÑreceiversÂàóË°®‰∏≠Â≠òÂÇ®ÁöÑsenderÈÉΩÊòØmodelËÄåreceiverÈÉΩÊòØÊàë‰ª¨Â∏åÊúõÂú®ËøõË°åmodel.save()ÂâçË∞ÉÁî®ÁöÑÂáΩÊï∞Êù•ËøõË°åÁöÑ‰∏Ä‰∫õÁõ∏ÂÖ≥Êìç‰Ωú„ÄÇ</p>
<h3 id="2-sender">2. sender
</h3><p>‰ø°Âè∑ÁöÑÂèëÈÄÅÊñπÔºåÂç≥Ë∞ÉÁî®<code>signal.send()</code>ÊñπÊ≥ïÁöÑÁ±ª„ÄÇÊØîÂ¶ÇÔºåÊâÄÊúâmodelÁ±ªÁöÑÁà∂Á±ªÈÉΩÊòØBaseModelÔºåËÄåBaseModelÊúâ‰∏Ä‰∏™__init__ÂáΩÊï∞Âú®ËØ•ÂáΩÊï∞‰∏≠ÔºåÈ¶ñÂÖàÂ∞±‰ºöË∞ÉÁî®<code>pre_init.send(self.__class__,**kwargs)</code>ÂèëÈÄÅÂç≥Â∞ÜÂºÄÂßãinitÁöÑ‰ø°Âè∑ÔºåÁÑ∂ÂêéÂÜçËøõË°åÂÖ∑‰ΩìÁöÑinitÊìç‰ΩúÔºåÂú®init‰πãÂêéÂÜçË∞ÉÁî®<code>post_init.send</code>ÂèëÈÄÅinitÂÆåÊàêÁöÑ‰ø°Âè∑„ÄÇÊïÖËøôÈáåÁöÑBaseModelÁ±ªÂ∞±ÊòØËøô‰∏§‰∏™‰ø°Âè∑ÂØπË±°(pre_init„ÄÅpost_init)ÁöÑsender„ÄÇËÄåÊàë‰ª¨ÁöÑmodelÁ±ªÈÉΩÊòØÁªßÊâøËá™BaseModelÔºåinitÊñπÊ≥ï‰πüÊòØÁªßÊâøÊù•ÁöÑÔºåÊïÖÊ≠§Êó∂ÁöÑsenderÂ∞±ÊòØÊàë‰ª¨ÂÆö‰πâÁöÑmodelÁ±ª„ÄÇ</p>
<h3 id="3-receiver">3. receiver
</h3><p>‰ø°Âè∑ÁöÑÊé•Êî∂ÊñπÔºå‰∏∫ÂèØË∞ÉÁî®ÂØπË±°Ôºå‰∏ÄËà¨ÊòØ‰∏™ÂáΩÊï∞ÔºåÊé•Êî∂signal.send()‰º†ÈÄíËøáÊù•ÁöÑÂèÇÊï∞ÔºåÂÜçËøõË°åÁõ∏ÂÖ≥ÁöÑÊìç‰Ωú</p>
<p>ÂÅáÂ¶ÇÊàë‰ª¨Êúâ‰∏™modelÂØπË±°‰∏∫PeopleÔºåÊàë‰ª¨ÊÉ≥Ë¶ÅÂú®ÊûÑÈÄ†ÊØè‰∏Ä‰∏™PeopleÊó∂Ôºà<code>new_people¬†= People(name=&quot;haha&quot;,email=&quot;haha@mail.com&quot;)</code>ÔºâÊâìÂç∞Âá∫ÂÖ∂Áõ∏ÂÖ≥‰ø°ÊÅØÔºåÊàë‰ª¨ÂèØ‰ª•Áî®‰∏Ä‰∏™ÂáΩÊï∞ÊâìÂç∞ÂÖ∂‰ø°ÊÅØÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">print_info</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;args: </span><span class="si">{</span><span class="n">args</span><span class="si">}</span><span class="se">\n</span><span class="s2">kwargs: </span><span class="si">{</span><span class="n">kwargs</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÁÑ∂Âêé‰ΩøÁî®<code>pre_init.connect(print_info, sender=People)</code>Â∞ÜÂÖ∂‰∏ésenderÁªëÂÆöËµ∑Êù•,Âç≥Âú®pre_initÁöÑreceiversÂàóË°®‰∏≠Â≠ò‰∏ÄÊù°ÂØπÂ∫îÁöÑËÆ∞ÂΩï:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="p">((</span><span class="n">People_id</span><span class="p">,</span><span class="n">print_info_id</span><span class="p">),</span><span class="n">print_info_weakref</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Ê≠§Â§ÑÁöÑ<code>print_info</code>ÂáΩÊï∞Âç≥‰∏∫‰∏Ä‰∏™receiverÔºåpre_init‰ø°Âè∑‰∏≠PeopleÁ±ªÂØπÂ∫îÁöÑreceiver„ÄÇ</p>
<p>ÂΩìÁÑ∂‰πüÂèØ‰ª•Áõ¥Êé•‰ΩøÁî®Ë£ÖÈ•∞Âô®Ôºå‰∏çËøá‰πüÊòØÂêåÊ†∑ÁöÑÈÅìÁêÜ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="nd">@receiver</span><span class="p">(</span><span class="n">pre_init</span><span class="p">,</span><span class="n">sender</span><span class="o">=</span><span class="n">People</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">print_info_before_init</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;args: </span><span class="si">{</span><span class="n">args</span><span class="si">}</span><span class="se">\n</span><span class="s2">kwargs: </span><span class="si">{</span><span class="n">kwargs</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÊúÄÁªàÊâìÂç∞Âá∫Êù•ÁöÑÁªìÊûúÊòØ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">args: []
</span></span><span class="line"><span class="cl">kwargs: {&#39;name&#39;:&#39;haha&#39;,&#39;email&#39;:&#39;haha.mail.com&#39;}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="ÂéüÁêÜÁÆÄÊûê">ÂéüÁêÜÁÆÄÊûê
</h2><p>djangoÁöÑÊï¥‰∏™‰ø°Âè∑Ê®°ÂùóÈÉΩÊòØ‰æùËµñSignalËøô‰∏™Á±ªÂÆåÊàêÁöÑ</p>
<p><img src="/p/django-signal-principle-analysis/signal.png"
	width="373"
	height="569"
	srcset="/p/django-signal-principle-analysis/signal_hu8251001186732828751.png 480w, /p/django-signal-principle-analysis/signal_hu17536644674691067904.png 1024w"
	loading="lazy"
	
		alt="Signal Class Diagram"
	
	
		class="gallery-image" 
		data-flex-grow="65"
		data-flex-basis="157px"
	
>
<img src="/p/django-signal-principle-analysis/signal_detail.png"
	width="956"
	height="538"
	srcset="/p/django-signal-principle-analysis/signal_detail_hu3840407809679362127.png 480w, /p/django-signal-principle-analysis/signal_detail_hu9076136509210613243.png 1024w"
	loading="lazy"
	
		alt="Signal Class Diagram Detail"
	
	
		class="gallery-image" 
		data-flex-grow="177"
		data-flex-basis="426px"
	
></p>
<h3 id="1-signalÁöÑÂ±ûÊÄßÂíå__init__ÊñπÊ≥ï">1. SignalÁöÑÂ±ûÊÄßÂíå__init__ÊñπÊ≥ï
</h3><p>1.receiversÔºö‰∏Ä‰∏™ÂàóË°®Áî®‰∫éÂ≠òÂèñËØ•Signal‰∏≠ÂØπÂ∫îÁöÑsenderÂíåreceiverÂπ∂Â≠ò‰∏ãreceiverÁöÑÂºïÁî®(ÊàñÂº±ÂºïÁî®)ÔºåÂú®Ë∞ÉÁî®connect()ÊñπÊ≥ïÊó∂‰ºöÂæÄreceivers‰∏≠Ê∑ªÂä†ÂØπÂ∫îÂÖ≥Á≥ªÔºåËÄåÂú®Ë∞ÉÁî®send()ÊñπÊ≥ïÊó∂‰ºöÂú®ÂÖ∂‰∏≠Êü•ÊâæÂØπÂ∫îÂÖ≥Á≥ª</p>
<p>Êï∞ÊçÆÁªìÊûÑÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Â¶ÇÊûúÂú®Ë∞ÉÁî®connectÊñπÊ≥ïÊ∑ªÂä†Êó∂weakÂèÇÊï∞‰∏∫TrueÔºàÈªòËÆ§‰∏∫TrueÔºâ</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ÂàôÂ≠òÂÇ®receiverÁöÑÂº±ÂºïÁî®ÔºåÂú®ÂûÉÂúæÂõûÊî∂Êó∂‰ºöËá™Âä®Â§ÑÁêÜ</span>
</span></span><span class="line"><span class="cl"><span class="p">[((</span><span class="n">receiver_id</span><span class="p">,</span><span class="n">sender_id</span><span class="p">),</span><span class="n">receiver_weakref</span><span class="p">),]</span>  <span class="c1"># Âº±ÂºïÁî®</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Â¶ÇÊûúconnectÊñπÊ≥ïÁöÑweakÂèÇÊï∞‰∏∫False</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ÂàôÂ≠òÂÇ®receiverÁöÑÂº∫ÂºïÁî®ÔºåÊúÄÁªàÈúÄË¶ÅË∞ÉÁî®disconnectÈîÄÊØÅËÆ∞ÂΩï</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Âê¶ÂàôÁõ∏ÂÖ≥ÂèòÈáèÊó†Ê≥ïË¢´ÂûÉÂúæÂõûÊî∂Ôºå‰πüÂ∞±ÊòØ‚ÄùÂÜÖÂ≠òÊ≥ÑÈú≤‚Äú</span>
</span></span><span class="line"><span class="cl"><span class="p">[((</span><span class="n">receiver_id</span><span class="p">,</span><span class="n">sender_id</span><span class="p">),</span><span class="n">receiver</span><span class="p">),]</span>  <span class="c1"># Âº∫ÂºïÁî®</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>2.providing_argsÔºöËØ•signalÊé•ÂèóÁöÑÂèÇÊï∞ÁöÑÂàóË°®</p>
<p>3.lockÔºöthreading.lockÔºåÂØπÁõ∏Â∫îÊìç‰ΩúÂä†ÈîÅ‰ª•‰øùËØÅÂÆâÂÖ®</p>
<p>4.use_cachingÔºöboolÁ±ªÂûãÔºåÊ†áËØÜÊòØÂê¶‰ΩøÁî®ÁºìÂ≠òÔºåÂ¶ÇÊûú‰ΩøÁî®ÁºìÂ≠òÊàë‰ª¨‰ºöÁºìÂ≠òÊØè‰∏Ä‰∏™senderÁ±ªÁöÑreceiversÂπ∂Â≠òÂÇ®Âà∞self.sender_receivers_cache‰∏≠</p>
<p>5.sender_receivers_cacheÔºösignalÂØπÊØè‰∏Ä‰∏™senderÁöÑreceiversËøõË°åÁºìÂ≠ò</p>
<p>Êï∞ÊçÆÁªìÊûÑÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;sender1&#34;</span><span class="p">:</span> <span class="p">[</span><span class="err">receiver</span><span class="mi">1</span><span class="err">_weakref</span><span class="p">,</span> <span class="err">receiver</span><span class="mi">2</span><span class="err">_weakref</span><span class="p">,</span><span class="err">...</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;sender2&#34;</span><span class="p">:</span> <span class="p">[</span><span class="err">receiver</span><span class="mi">3</span><span class="err">_weakref</span><span class="p">,</span> <span class="err">receiver</span><span class="mi">4</span><span class="err">_weakref</span><span class="p">,</span><span class="err">...</span><span class="p">],</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÊØèÊ¨°sendÊó∂‰ºö‰ΩøÁî®sender_receivers_cacheÂø´ÈÄüÂà§Êñ≠ËØ•senderÊòØÂê¶ÊúâreceiverÔºåÂ¶ÇÊûúÊúâÂàôÂÜçË∞ÉÁî®_live_receiversËé∑ÂèñÂÖ∂ÂØπÂ∫îÁöÑreceiversÁöÑÂº∫Â∫îÁî®ÂàóË°®</p>
<p>6._dead_receiversÔºöboolÁ±ªÂûãÔºåÁî®‰∫éÊ†áËØÜself.reivers‰∏≠ÊòØÂê¶Âê´ÊúâÂ§±ÊïàÁöÑ receiverÁöÑÂº±ÂºïÁî®„ÄÇÂΩìÂº±ÂºïÁî®ÊåáÂêëÁöÑreceiverË¢´ÂûÉÂúæÂõûÊî∂Êó∂‰ºöË∞ÉÁî®Signal._remove_receiverÊñπÊ≥ïÂ∞Ü_dead_receiversÁΩÆ‰∏∫True</p>
<h3 id="2-signal‰∏≠ÁöÑÊñπÊ≥ï">2. Signal‰∏≠ÁöÑÊñπÊ≥ï
</h3><p>ËØ¥Âú®ÂâçÈù¢ÔºöreceiverÂíåsenderÈÉΩÂøÖÈ°ªÊòØ<a class="link" href="https://stackoverflow.com/questions/14535730/what-does-hashable-mean-in-python"  target="_blank" rel="noopener"
    >ÂèØÂìàÂ∏åÁöÑ</a></p>
<p>1.connectÔºöÂ∞ÜreceiverÂíåsenderÈÄöËøáÂØπÂ∫îÁöÑSignalËøûÊé•Ëµ∑Êù•ÔºàÂç≥Â∞ÜÂØπÂ∫îËÆ∞ÂΩïÊ∑ªÂä†Âà∞ÂØπÂ∫îSignalÂØπË±°ÁöÑreceiversÂ±ûÊÄßÂàóË°®‰∏≠Ôºâ</p>
<p>ÂèÇÊï∞Ëß£ÊûêÔºö</p>
<ul>
<li>receiverÔºöÈúÄË¶ÅÊé•Êî∂‰ø°Âè∑ÁöÑreceiver</li>
<li>senderÔºöÂèëÈÄÅËØ•‰ø°Âè∑ÁöÑsender</li>
<li>weakÔºöÊòØÂê¶‰ΩøÁî®Âº±ÂºïÁî®ÔºåÈªòËÆ§‰∏∫True„ÄÇÂ¶ÇÊûú‰∏∫TrueÂàôÂ≠òÂÇ®receiverÂØπÂ∫îÁöÑweakrefÂê¶ÂàôÁõ¥Êé•Â≠òÂÇ®Âº∫ÂºïÁî®„ÄÇÁî±‰∫éËÆæÁΩÆ‰∫Ü<code>weakref.finalize(receiver_object, self._remove_receiver)</code>Ëã•Â≠òÂÇ®Âº±ÂºïÁî®ÂàôÂèØ‰ª•Âú®receiverÂûÉÂúæÂõûÊî∂Êó∂Ëá™Âä®Ê∏ÖÈô§Signal.receivers‰∏≠ÂØπÂ∫îÁöÑËÆ∞ÂΩïÔºàËßÅ‰∏ãÈù¢ÁöÑÂàÜÊûêÔºâËã•Â≠òÂÇ®Âº∫ÂºïÁî®ÂàôÈúÄË¶ÅÂÖàÊâãÂä®Ë∞ÉÁî®disconnectÊñπÊ≥ïÂà†Èô§Signal.receivers‰∏≠ÂØπÂ∫îÁöÑËÆ∞ÂΩïÂê¶ÂàôËØ•receiverÂ∞ÜÊó†Ê≥ïË¢´ÂûÉÂúæÂõûÊî∂ÂØºËá¥‚ÄúÂÜÖÂ≠òÊ≥ÑÊºè‚Äù</li>
<li>dispatch_uidÔºöÈªòËÆ§‰∏∫NoneÔºåÂ¶ÇÊûú‰ΩøÁî®‰∫ÜËØ•ÂÄºÔºà‰∏ÄËà¨‰∏∫‰∏Ä‰∏™Â≠óÁ¨¶‰∏≤ÔºâÔºåÁõ∏ÂΩì‰∫é‰∏∫ËØ•receiverËá™ÂÆö‰πâ‰∏™ÂîØ‰∏ÄÂêçÁß∞Ôºà‰∏çÂÖÅËÆ∏ÈáçÂ§çÔºâÔºåÂ≠òÂÇ®Êó∂Â∞Ü‰ºö‰ΩøÁî®<code>dispatch_uid</code>‰ª£Êõø<code>id(sender)</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">receiver</span><span class="p">,</span> <span class="n">sender</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weak</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dispatch_uid</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">dispatch_uid</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">lookup_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">dispatch_uid</span><span class="p">,</span> <span class="n">_make_id</span><span class="p">(</span><span class="n">sender</span><span class="p">))</span>  <span class="c1"># Â¶ÇÊûúËÆæÁΩÆ‰∫Üdispatch_uidÂàô‰ΩøÁî®ÂÖ∂ÊúüÂæÖidÂÄº‰Ωú‰∏∫ÂîØ‰∏ÄÊ†áËØÜ</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">lookup_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">_make_id</span><span class="p">(</span><span class="n">receiver</span><span class="p">),</span> <span class="n">_make_id</span><span class="p">(</span><span class="n">sender</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">weak</span><span class="p">:</span>  <span class="c1"># Â¶ÇÊûú‰ΩøÁî®Âº±ÂºïÁî®</span>
</span></span><span class="line"><span class="cl">        <span class="n">ref</span> <span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ref</span>
</span></span><span class="line"><span class="cl">        <span class="n">receiver_object</span> <span class="o">=</span> <span class="n">receiver</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Check for bound methods</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">receiver</span><span class="p">,</span> <span class="s1">&#39;__self__&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">receiver</span><span class="p">,</span> <span class="s1">&#39;__func__&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Â¶ÇÊûúËØ•receiverÊòØÂØπË±°ÊñπÊ≥ïÔºåÂàôreceiver_object‰∏∫ÂåÖÂê´ËØ•receiverÁöÑÂØπË±°</span>
</span></span><span class="line"><span class="cl">            <span class="n">ref</span> <span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">WeakMethod</span>
</span></span><span class="line"><span class="cl">            <span class="n">receiver_object</span> <span class="o">=</span> <span class="n">receiver</span><span class="o">.</span><span class="vm">__self__</span>
</span></span><span class="line"><span class="cl">        <span class="n">receiver</span> <span class="o">=</span> <span class="n">ref</span><span class="p">(</span><span class="n">receiver</span><span class="p">)</span>  <span class="c1"># Ëé∑ÂèñËØ•receiverÁöÑÂº±ÂºïÁî®</span>
</span></span><span class="line"><span class="cl">        <span class="n">weakref</span><span class="o">.</span><span class="n">finalize</span><span class="p">(</span><span class="n">receiver_object</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remove_receiver</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># receiver_objectÂûÉÂúæÂõûÊî∂Êó∂Ë∞ÉÁî®self._remove_receiverÂ∞Üself._dead_receiversÁΩÆ‰∏∫True</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Âú®ÂêéÈù¢ÁöÑsendÊàñsend_robust‰∏≠ÂØπself.receiversÂä†ÈîÅÂêéÊ∏ÖÁêÜ</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">_clear_dead_receivers</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">r_key</span> <span class="o">==</span> <span class="n">lookup_key</span> <span class="k">for</span> <span class="n">r_key</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">receivers</span><span class="p">):</span>  <span class="c1"># Ê£ÄÊü•ÊòØÂê¶ÊúâÈáçÂ§ç</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">receivers</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">lookup_key</span><span class="p">,</span> <span class="n">receiver</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">sender_receivers_cache</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># ÊØèÊ¨°connectÊàñdisconnectÂêéÈÉΩË¶ÅÊ∏ÖÈô§ÁºìÂ≠ò</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># ËØ•ÁºìÂ≠ò‰ºöÂú®sendÊó∂ÊûÑÂª∫</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>‚Äã</p>
<p>2.disconnectÔºö‰ªéÂØπÂ∫îSignalÂØπË±°ÁöÑreceiversÂàóË°®‰∏≠Âà†Èô§ÂØπÂ∫îËÆ∞ÂΩïÔºà‰∏ÄËà¨Áî®‰∫éÊâãÂä®Âà†Èô§Âú®connectÊó∂‰ΩøÁî®weak=FalseÁöÑÊÉÖÂÜµÔºåÂç≥ËØ•Êù°ËÆ∞ÂΩïÂ≠òÁöÑÊòØreceiverÁöÑÂº∫ÂºïÁî®ÔºåËã•‰∏çÊâãÂä®Âà†Èô§ËØ•Êù°ËÆ∞ÂΩï‰ºöÂØºËá¥‚ÄúÂÜÖÂ≠òÊ≥ÑÊºè‚ÄùÔºå‰∏é<a class="link" href="https://docs.python.org/zh-cn/3.8/library/gc.html"  target="_blank" rel="noopener"
    >gcÁöÑÂºïÁî®ËÆ°Êï∞</a>ÊúâÂÖ≥Ôºâ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">receiver</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sender</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dispatch_uid</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    Â∞Üsignal‰∏≠ÁöÑreceiver‰∏ésender‚ÄúÊñ≠ÂºÄËøûÊé•‚Äù
</span></span></span><span class="line"><span class="cl"><span class="s2">    ËØ•ÂáΩÊï∞‰∏ªË¶ÅÈíàÂØπÈÇ£‰∫õÂú®connectÊó∂weakÂèÇÊï∞‰∏∫FalseÁöÑÊÉÖÂÜµÔºåÂç≥signalÁöÑreceiversÂàóË°®
</span></span></span><span class="line"><span class="cl"><span class="s2">    ‰∏≠Â≠òÂÇ®ÁöÑÊòØrceiverÁöÑÂº∫ÂºïÁî®
</span></span></span><span class="line"><span class="cl"><span class="s2">    
</span></span></span><span class="line"><span class="cl"><span class="s2">    Â¶ÇÊûúÂú®connectÊó∂‰ΩøÁî®ÁöÑÂº±ÂºïÁî®(weak=True), Âàô‰∏çÈúÄË¶ÅÊâãÂä®Ë∞ÉÁî®disconnectÊñπÊ≥ï
</span></span></span><span class="line"><span class="cl"><span class="s2">    receiverÂíåsenderÁöÑËÆ∞ÂΩï‰ºöË¢´Ëá™Âä®Âà†Èô§
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">dispatch_uid</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">lookup_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">dispatch_uid</span><span class="p">,</span> <span class="n">_make_id</span><span class="p">(</span><span class="n">sender</span><span class="p">))</span>  <span class="c1"># Â¶ÇÊûúÊèê‰æõ‰∫Üdispatch_uidÂàô‰ΩøÁî®ÂÖ∂Êõø‰ª£ id(receiver)</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">lookup_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">_make_id</span><span class="p">(</span><span class="n">receiver</span><span class="p">),</span> <span class="n">_make_id</span><span class="p">(</span><span class="n">sender</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">disconnected</span> <span class="o">=</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">_clear_dead_receivers</span><span class="p">()</span>  <span class="c1"># ÂÖàÊ∏ÖÈô§dead_receivers</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">receivers</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="n">r_key</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">receivers</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">r_key</span> <span class="o">==</span> <span class="n">lookup_key</span><span class="p">:</span>  <span class="c1"># Ê†πÊçÆlookup_keyÂú®self.receivers‰∏≠Êü•Êâæ</span>
</span></span><span class="line"><span class="cl">                <span class="n">disconnected</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">receivers</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>  <span class="c1"># Âà†Èô§self.receivers‰∏≠ÁöÑÂØπÂ∫îËÆ∞ÂΩï</span>
</span></span><span class="line"><span class="cl">                <span class="k">break</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">sender_receivers_cache</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>  <span class="c1"># ÂèòÊõ¥ÂêéÊ∏ÖÈô§ÁºìÂ≠ò</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">disconnected</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>‚Äã</p>
<p>3.has_listenersÔºöÊ£ÄÊü•Êüê‰∏™senderÊòØÂê¶Êúâreceiver</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">has_listeners</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sender</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_live_receivers</span><span class="p">(</span><span class="n">sender</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>‚Äã</p>
<p>4.sendÔºöÁªôÊüê‰∏™senderÂØπÂ∫îÁöÑÊâÄÊúâreceiversÂèëÈÄÅÁõ∏Â∫îÁöÑ‰ø°Âè∑ÔºåÈ¶ñÂÖà‰ºöÊ£ÄÊü•Ëøô‰∏™senderÊòØÂê¶Êúâreceivers„ÄÇÂ¶ÇÊûúÊúâÔºåÂÖàË∞ÉÁî®_live_receiversËé∑ÂèñÂΩìÂâçsenderÂØπÂ∫îÁöÑÊâÄÊúâÁöÑreceiverÁöÑÂº∫ÂºïÁî®ÔºåÁÑ∂Âêé‰æùÊ¨°Ë∞ÉÁî®ÊØè‰∏™receiver‰º†ÂÖ•Áõ∏ÂÖ≥ÁöÑÂèÇÊï∞„ÄÇÊúÄÂêéÔºåËøîÂõû<code>[(receiver,response),]</code>ÔºàËøôÈáåÁöÑreceiverÊòØÂº∫ÂºïÁî®Âç≥ÂèØÁõ¥Êé•Ë∞ÉÁî®ÁöÑreceiverÂáΩÊï∞ÔºåresponseÊòØË∞ÉÁî®receiverÂáΩÊï∞ËøîÂõûÁöÑÁªìÊûúÔºâ</p>
<p>ÂèÇÊï∞Ëß£ÊûêÔºö</p>
<ul>
<li>senderÔºöÂèëÈÄÅ‰ø°Âè∑ÁöÑÁ±ª</li>
<li>**namedÔºö‰º†ÈÄíÁªôËØ•senderÂØπÂ∫îÁöÑreceiversÁöÑÂèÇÊï∞</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">send</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sender</span><span class="p">,</span> <span class="o">**</span><span class="n">named</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">receivers</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">sender_receivers_cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">sender</span><span class="p">)</span> <span class="ow">is</span> <span class="n">NO_RECEIVERS</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="n">receiver</span><span class="p">,</span> <span class="n">receiver</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">sender</span><span class="o">=</span><span class="n">sender</span><span class="p">,</span> <span class="o">**</span><span class="n">named</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">receiver</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_live_receivers</span><span class="p">(</span><span class="n">sender</span><span class="p">)</span>  <span class="c1"># _live_receiversËøîÂõûÁöÑÊòØËØ•senderÂØπÂ∫îÁöÑÊâÄÊúâÁöÑreceiversÁöÑÂº∫ÂºïÁî®</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Ê≥®Ôºö</strong> ÂΩìË∞ÉÁî®Êüê‰∏™receiverÂèëÁîüÂºÇÂ∏∏Êó∂Á®ãÂ∫è‰ºöÁõ¥Êé•ÈÄÄÂá∫ÔºåÂèØËÉΩÂØºËá¥ÂÖ∂‰ªñÂâ©‰∏ãÁöÑreceiverÂπ∂Ê≤°ÊúâË¢´Ë∞ÉÁî®ÊâßË°å</p>
<p>‚Äã</p>
<p>5.send_robustÔºö‚ÄúÂÅ•Â£ÆÁâà‚ÄùÁöÑsendÔºåÂΩìË∞ÉÁî®Êüê‰∏™receiverÂèëÁîüÂºÇÂ∏∏Êó∂‰ºöÂ∞ÜÂºÇÂ∏∏ÊçïÊçâÂπ∂Â≠òÂÇ®Ëµ∑Êù•ÔºåÊïÖËØ•senderÁöÑÊâÄÊúâÁöÑreceiverÈÉΩËÉΩË¢´Ë∞ÉÁî®ÊâßË°å„ÄÇËØ•ÂáΩÊï∞‰ºöËøîÂõû<code>[(receiver,response / err),]</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">send_robust</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sender</span><span class="p">,</span> <span class="o">**</span><span class="n">named</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Áõ∏ÊØîsendÊñπÊ≥ïË∞ÉÁî®receiverÊñπÊ≥ïÂºÇÂ∏∏Êó∂Áõ¥Êé•ÈÄÄÂá∫Ôºåsend_robust‰ºöÊî∂ÈõÜÂºÇÂ∏∏Âπ∂ËøîÂõû</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">receivers</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">sender_receivers_cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">sender</span><span class="p">)</span> <span class="ow">is</span> <span class="n">NO_RECEIVERS</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Call each receiver with whatever arguments it can accept.</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Return a list of tuple pairs [(receiver, response), ... ].</span>
</span></span><span class="line"><span class="cl">    <span class="n">responses</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">receiver</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_live_receivers</span><span class="p">(</span><span class="n">sender</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">response</span> <span class="o">=</span> <span class="n">receiver</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">sender</span><span class="o">=</span><span class="n">sender</span><span class="p">,</span> <span class="o">**</span><span class="n">named</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">responses</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">receiver</span><span class="p">,</span> <span class="n">err</span><span class="p">))</span>  
</span></span><span class="line"><span class="cl">            <span class="c1"># Â¶ÇÊûúË∞ÉÁî®receiverÂá∫Áé∞ÂºÇÂ∏∏ÂàôÊçïËé∑Âπ∂ËøîÂõûÁõ∏Â∫îÁöÑÂºÇÂ∏∏ËÄå‰∏çÂΩ±ÂìçÂÖ∂‰ªñreceiverÁöÑË∞ÉÁî®</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">responses</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">receiver</span><span class="p">,</span> <span class="n">response</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">responses</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>‚Äã</p>
<p>6._clean_dead_receiversÔºöÊ∏ÖÈô§Signal.receivers‰∏≠ÁöÑdead receiverÔºåËØ•ÂáΩÊï∞‰ºöÂú®sendÊàñsend_robust‰∏≠ÂØπSignal.receiversÂä†ÈîÅ‰∫ÜÁöÑÊÉÖÂÜµ‰∏ãË∞ÉÁî®</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">_clear_dead_receivers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Note: caller is assumed to hold self.lock.</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Ê∏ÖÈô§dead_receivers</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dead_receivers</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">_dead_receivers</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># ËøòÂéü_dead_receivers‰∏∫False</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">receivers</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">receivers</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ReferenceType</span><span class="p">)</span> <span class="ow">and</span> <span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">]()</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Âº±ÂºïÁî®ÔºåÂπ∂‰∏îËØ•Âº±ÂºïÁî®ÂØπÂ∫îÁöÑÂØπË±°Â∑≤Ê∂à‰∫°</span>
</span></span><span class="line"><span class="cl">        <span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>‚Äã</p>
<p><strong>Ê≥®Ôºö</strong> ÂÖ∂ÂÆûËøôÈáåËØ¥ÁöÑÊ∏ÖÈô§dead receiverÔºåÂ∞±ÊòØÂà†Èô§Signal.receivers‰∏≠ÈÇ£‰∫õÂéüÂáΩÊï∞/ÂØπË±°ÔºàÂç≥receiverÂáΩÊï∞ÊàñÂåÖÂê´receievrÂáΩÊï∞ÁöÑÂØπË±°ÔºâÂ∑≤ÁªèË¢´ÂûÉÂúæÂõûÊî∂‰∫ÜÁöÑweakrefÔºåËá≥‰∫éÈÇ£‰∫õÂú®connectÊó∂‰ΩøÁî®weak=FalseÊ∑ªÂä†ÁöÑÂº∫ÂºïÁî®ÂàôÈúÄË¶ÅÊâãÂä®Ë∞ÉÁî®disconnectËøõË°åÊâãÂä®Ê∏ÖÈô§ÔºåÂê¶ÂàôÂèØËÉΩ‰ºöÂØºËá¥ÂÜÖÂ≠òÊ≥ÑÈú≤</p>
<p>7._live_receiversÔºöÂÖàÈÄöËøáself._dead_receiversÊ£ÄÊü•ÊòØÂê¶Êúâdead receiversÂ¶ÇÊûúÊúâÂàôÂÖàËøáÊª§‰∏ÄÈÅçSignal.receiversÔºåÁÑ∂Âêé‰ªéSignal.receivers‰∏≠ÊâæÂá∫ËØ•senderÂØπÂ∫îÊâÄÊúâÁöÑreceiverÔºåÂπ∂ËøîÂõûÂåÖÂê´ÊâÄÊúâreceiverÂº∫ÂºïÁî®ÁöÑÂàóË°®</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">_live_receivers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sender</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    Filter sequence of receivers to get resolved, live receivers.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    This checks for weak references and resolves them, then returning only
</span></span></span><span class="line"><span class="cl"><span class="s2">    live receivers.
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">receivers</span> <span class="o">=</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_caching</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dead_receivers</span><span class="p">:</span>  <span class="c1"># Â¶ÇÊûú‰ΩøÁî®ÁºìÂ≠òÂπ∂‰∏îself.receivers‰∏≠Êó†dead_receivers</span>
</span></span><span class="line"><span class="cl">        <span class="n">receivers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sender_receivers_cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">sender</span><span class="p">)</span>  <span class="c1"># Áõ¥Êé•‰ªéÁºìÂ≠ò‰∏≠Ëé∑Âèñ</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># We could end up here with NO_RECEIVERS even if we do check this case in</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># .send() prior to calling _live_receivers() due to concurrent .send() call.</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># ÂÖ∂ÂÆûÊàë‰ª¨Âú®Ë∞ÉÁî®_live_receiversÊñπÊ≥ïÁöÑsendÊñπÊ≥ï‰∏≠Â∑≤ÁªèÊ£ÄÊü•Ëøá‰∏ÄÊ¨°‰∫Ü</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">receivers</span> <span class="ow">is</span> <span class="n">NO_RECEIVERS</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">receivers</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># Â¶ÇÊûú‰∏ç‰ΩøÁî®ÁºìÂ≠òÊàñËÄÖÂ≠òÂú®ÂæÖÊ∏ÖÁêÜÁöÑdead receivers</span>
</span></span><span class="line"><span class="cl">        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">_clear_dead_receivers</span><span class="p">()</span>  <span class="c1"># ÂÖàÊ∏ÖÁêÜdead_receivers</span>
</span></span><span class="line"><span class="cl">            <span class="n">senderkey</span> <span class="o">=</span> <span class="n">_make_id</span><span class="p">(</span><span class="n">sender</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">receivers</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="p">(</span><span class="n">receiverkey</span><span class="p">,</span> <span class="n">r_senderkey</span><span class="p">),</span> <span class="n">receiver</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">receivers</span><span class="p">:</span> <span class="c1"># ÈÅçÂéÜself.receiversËøõË°åÊü•ÊâæÂåπÈÖç</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="n">r_senderkey</span> <span class="o">==</span> <span class="n">NONE_ID</span> <span class="ow">or</span> <span class="n">r_senderkey</span> <span class="o">==</span> <span class="n">senderkey</span><span class="p">:</span>  <span class="c1"># Â¶ÇÊûúsenderkey‰∏∫id(None)ÊàñÂåπÈÖç</span>
</span></span><span class="line"><span class="cl">                    <span class="n">receivers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">receiver</span><span class="p">)</span>  <span class="c1"># Â∞Üreceiver(weakref)Ê∑ªÂä†Âà∞receivers‰∏≠</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Êõ¥Êñ∞ÁºìÂ≠ò</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_caching</span><span class="p">:</span>  <span class="c1"># Â¶ÇÊûú‰ΩøÁî®ÁºìÂ≠ò</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="ow">not</span> <span class="n">receivers</span><span class="p">:</span>  <span class="c1"># Â¶ÇÊûúËØ•senderÊ≤°Êúâreceiver (receivers‰∏∫Á©∫)</span>
</span></span><span class="line"><span class="cl">                    <span class="bp">self</span><span class="o">.</span><span class="n">sender_receivers_cache</span><span class="p">[</span><span class="n">sender</span><span class="p">]</span> <span class="o">=</span> <span class="n">NO_RECEIVERS</span>  <span class="c1"># Â∞Ücache‰∏≠ËØ•senderÁöÑreceiversÁΩÆ‰∏∫Á©∫</span>
</span></span><span class="line"><span class="cl">                <span class="k">else</span><span class="p">:</span>  <span class="c1"># Â¶ÇÊûúËØ•senderÂ≠òÂú®ÂØπÂ∫îÁöÑreceiver</span>
</span></span><span class="line"><span class="cl">                    <span class="c1"># Note, we must cache the weakref versions.</span>
</span></span><span class="line"><span class="cl">                    <span class="c1"># Ê≥®ÊÑèÊàë‰ª¨Â∫îËØ•ÁºìÂ≠òÂº±ÂºïÁî®</span>
</span></span><span class="line"><span class="cl">                    <span class="bp">self</span><span class="o">.</span><span class="n">sender_receivers_cache</span><span class="p">[</span><span class="n">sender</span><span class="p">]</span> <span class="o">=</span> <span class="n">receivers</span>  <span class="c1"># Â∞ÜËØ•senderÂèäÂÖ∂ÊâÄÊúâÁöÑreceiversÁºìÂ≠òËµ∑Êù•</span>
</span></span><span class="line"><span class="cl">    <span class="n">non_weak_receivers</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">receiver</span> <span class="ow">in</span> <span class="n">receivers</span><span class="p">:</span>  <span class="c1"># receiversË¶Å‰πà‰∏∫[] Ë¶Å‰πà‰∏∫[receiver]</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">receiver</span><span class="p">,</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ReferenceType</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Dereference the weak reference.</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># https://www.kite.com/python/docs/weakref.ReferenceType</span>
</span></span><span class="line"><span class="cl">            <span class="n">receiver</span> <span class="o">=</span> <span class="n">receiver</span><span class="p">()</span>  <span class="c1"># Ëé∑ÂèñÂº±ÂºïÁî®ÊâÄÊåáÁöÑÂÆûÈôÖÂØπË±°ÔºåËã•Â∑≤Ê∂à‰∫°ÂàôËøîÂõûNoneÔºåÂê¶ÂàôËøîÂõûÂØπË±°ÁöÑÂº∫ÂºïÁî®(‚ÄúÂèØÁõ¥Êé•Ë∞ÉÁî®‚Äù)</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">receiver</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># weakrefÊâÄÊåáÁöÑÂéüÂØπË±°Â∞öÊú™Ê∂à‰∫°</span>
</span></span><span class="line"><span class="cl">                <span class="n">non_weak_receivers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">receiver</span><span class="p">)</span>  <span class="c1"># Ê∑ªÂä†ÂÆûÈôÖÂèØË∞ÉÁî®ÁöÑreceiverÂØπË±°</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">non_weak_receivers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">receiver</span><span class="p">)</span>  <span class="c1"># ‰∏çÊòØÂº±ÂºïÁî®ÂàôÁõ¥Êé•Ê∑ªÂä†</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">non_weak_receivers</span>  <span class="c1"># ÂèØË∞ÉÁî®ÂØπË±°receiverÁöÑÂàóË°®</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>8._remove_receiversÔºöÂ∞ÜSignal._dead_receiversÁΩÆ‰∏∫TrueÔºåÂú®ÂêéÈù¢Ë∞ÉÁî®sendÊàñsend_robustÊñπÊ≥ïÊó∂‰ºöÂÖàÊ£ÄÊü•_dead_receiversÔºåÂ¶ÇÊûú‰∏∫TrueÂàôÂÖàË∞ÉÁî®_clean_dead_receiversËøõË°åÊ∏ÖÁêÜ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">_remove_receiver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">receiver</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Mark that the self.receivers list has dead weakrefs. If so, we will</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># clean those up in connect, disconnect and _live_receivers while</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># holding self.lock. Note that doing the cleanup here isn&#39;t a good</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># idea, _remove_receiver() will be called as side effect of garbage</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># collection, and so the call can happen while we are already holding</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># self.lock.</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Ê†áËÆ∞self.receivers‰∏≠Êúâdead weakrefs(weakrefÊâÄÊåáÂØπË±°Â∑≤Ê∂à‰∫°).Â¶ÇÊûúÂ≠òÂú®dead receiver</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Á®ãÂ∫è‰ºöÂú®Ë∞ÉÁî®connect, disconnectÂíå_live_receiversÊó∂Âú®Âä†ÈîÅÁöÑÊÉÖÂÜµ‰∏ãÊ∏ÖÈô§dead weakrefs</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Ê≥®ÊÑèÂú®ËøôÈáåÊâßË°åÂÖ∑‰ΩìÁöÑÊ∏ÖÈô§Êìç‰ΩúÂπ∂‰∏çÊòØ‰∏Ä‰∏™Â•Ω‰∏ªÊÑèÔºåÂú®ÂûÉÂúæÂõûÊî∂Êó∂_remove_receiver()‰ºöË¢´</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Ëá™Âä®Ëß¶ÂèëÔºåËÄåÊàë‰ª¨ÂèØËÉΩÂú®ÂÖ∂‰ªñÊìç‰Ωú‰∏≠ÂØπreceiversÂä†‰∫ÜÈîÅÔºåÊ≠§Êó∂Ê∏ÖÁêÜreceiversÂ∞Ü‰ºöÂØºËá¥ÂÜ≤Á™Å</span>
</span></span><span class="line"><span class="cl">    <span class="bp">self</span><span class="o">.</span><span class="n">_dead_receivers</span> <span class="o">=</span> <span class="kc">True</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Ê≥®Ôºö</strong> Áî±‰∫éÂú®connectÊñπÊ≥ï‰∏≠ÁöÑËÆæÁΩÆ‰∫Ü<code>weakref.finalize(receiver_object, self._remove_receiver)</code>ÔºåÂú®receiver_objectÂûÉÂúæÂõûÊî∂Êó∂‰ºöËá™Âä®Ëß¶Âèë_remove_receiverÊñπÊ≥ï„ÄÇÂ¶ÇÊûúÂ∞ÜÊ∏ÖÈô§ËøáÊª§Signal.receiversÁöÑËøáÁ®ãÊîæÂú®Ëøô‰∏™ÂáΩÊï∞‰∏≠ÔºåËÄåÂÖ∂ÂÆÉÂú∞ÊñπÂèØËÉΩÊ≠£Âú®Âú®Âä†ÈîÅÁöÑÊÉÖÂÜµ‰∏ã‰ΩøÁî®receiversÂàô‰ºöÂØºËá¥ÂÜ≤Á™Å„ÄÇÊïÖ_remove_receiversÂè™Â∞ÜSignal._dead_receiversÁΩÆ‰∏∫TrueÔºå‰ªéËÄåÊääÊ∏ÖÁêÜdead receiverÁöÑËøáÁ®ãÂª∂ËøüÂà∞‰∫Üconnect„ÄÅdisconnect„ÄÅsend„ÄÅsend_robust‰∏≠Âä†ÈîÅËøõË°å</p>
<h3 id="3-Â§ßÊ¶ÇÊµÅÁ®ã">3. Â§ßÊ¶ÇÊµÅÁ®ã
</h3><p>ÈÄöËøáSignal.connectÂêëSignal.receivers‰∏≠Ê≥®ÂÜåÂØπÂ∫îÁöÑ<code>((receiver_id, sender_id), receiver_weakref)</code>ËÆ∞ÂΩïÔºåÁÑ∂Âêésender‰ºöÂú®ÊÅ∞ÂΩìÁöÑÊó∂ÂÄôË∞ÉÁî®ÊÅ∞ÂΩìÁöÑSignalÂπ∂‰ΩøÁî®Signal.sendÂèëÈÄÅÊÅ∞ÂΩìÁöÑ‰ø°Âè∑ÁªôÂØπÂ∫îÁöÑÊâÄÊúâreceiver„ÄÇËøôÂ∞±ÊòØ‰ø°Âè∑ÁöÑÂ§ßËá¥‰º†ÈÄíËøáÁ®ã</p>
<h3 id="4-ÂæàÂ•áÊÄ™ÁöÑ‰∏ÄÁÇπ">4. ÂæàÂ•áÊÄ™ÁöÑ‰∏ÄÁÇπ
</h3><p>Á®ãÂ∫èÈáåÈù¢Êúâ‰∏™Â•áÊÄ™ÁöÑ<code>None</code>ÔºåÂú®connectÊó∂‰∏çÊåáÂÆösenderÂàôsenderÔºåÈªòËÆ§senderÂ∞±‰ºöÊòØNoneÔºåËÄåÂú®sender‰∏≠Ë∞ÉÁî®Siganl.sendÊñπÊ≥ïËØ•ÊñπÊ≥ïÂèà‰ºöË∞ÉÁî®Signal._live_receiversÊñπÊ≥ïÔºåÂú®Signal._live_receivers‰∏≠‰ºöÂØªÊâæËØ•senderÂØπÂ∫îÁöÑreceiverÔºåËÄåÂåπÈÖçÊù°‰ª∂Â±ÖÁÑ∂ÊòØ<code>if r_senderkey == NONE_ID or r_senderkey == senderkey</code>Ôºåsender‰∏∫NoneÁöÑreceivers‰πü‰ºöË¢´ÂåπÈÖçÔºüÊúâÁÇπ‰∏çÂ§™ÁêÜËß£ËøôÈáåÁöÑÂÅöÊ≥ï</p>
<h3 id="5-Â§öËØ¥‰∏ÄÂè•">5. Â§öËØ¥‰∏ÄÂè•
</h3><p>ÂºÇÊ≠•ÈóÆÈ¢òÔºåÂΩì‰∏Ä‰∏™senderÊ≥®ÂÜåÁöÑreceiverËøáÂ§öÊó∂ÔºåË∞ÉÁî®sendÊñπÊ≥ïÊó∂ÂèØËÉΩ‰ºöÈùûÂ∏∏Âç†Áî®Êó∂Èó¥ÈÄ†ÊàêÈòªÂ°ûÔºåËßÇÂØüËÄÖÊ®°ÂºèÂ•ΩÂÉèÈÉΩÊúâËøô‰∏™ÈóÆÈ¢òÔºåÂèØ‰ª•‰ΩøÁî®ÂºÇÊ≠•ÊîπÂñÑÔºüÔºàÂú®ÁΩë‰∏äÁúãÂà∞ÁöÑÔºåÂÖ∑‰ΩìÂ¶Ç‰ΩïÊîπÂñÑÊàëËøòÊ≤°ÊêûÊ∏ÖÊ•öÔºåÁ≠âÂºÑÊòéÁôΩ‰∫ÜÂÜçË°•‰∏ä‚Ä¶‚Ä¶Ôºâ</p>
<h2 id="Ê∫êÁ†ÅÁÆÄÊûê">Ê∫êÁ†ÅÁÆÄÊûê
</h2><p>Ê∫êÁ†ÅÔºö</p>
<ul>
<li><a class="link" href="https://github.com/django/django/blob/main/django/dispatch/dispatcher.py"  target="_blank" rel="noopener"
    >Github</a></li>
<li><a class="link" href="https://docs.djangoproject.com/zh-hans/3.0/_modules/django/dispatch/dispatcher/#Signal.disconnect"  target="_blank" rel="noopener"
    >Django Docs</a></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span><span class="lnt">237
</span><span class="lnt">238
</span><span class="lnt">239
</span><span class="lnt">240
</span><span class="lnt">241
</span><span class="lnt">242
</span><span class="lnt">243
</span><span class="lnt">244
</span><span class="lnt">245
</span><span class="lnt">246
</span><span class="lnt">247
</span><span class="lnt">248
</span><span class="lnt">249
</span><span class="lnt">250
</span><span class="lnt">251
</span><span class="lnt">252
</span><span class="lnt">253
</span><span class="lnt">254
</span><span class="lnt">255
</span><span class="lnt">256
</span><span class="lnt">257
</span><span class="lnt">258
</span><span class="lnt">259
</span><span class="lnt">260
</span><span class="lnt">261
</span><span class="lnt">262
</span><span class="lnt">263
</span><span class="lnt">264
</span><span class="lnt">265
</span><span class="lnt">266
</span><span class="lnt">267
</span><span class="lnt">268
</span><span class="lnt">269
</span><span class="lnt">270
</span><span class="lnt">271
</span><span class="lnt">272
</span><span class="lnt">273
</span><span class="lnt">274
</span><span class="lnt">275
</span><span class="lnt">276
</span><span class="lnt">277
</span><span class="lnt">278
</span><span class="lnt">279
</span><span class="lnt">280
</span><span class="lnt">281
</span><span class="lnt">282
</span><span class="lnt">283
</span><span class="lnt">284
</span><span class="lnt">285
</span><span class="lnt">286
</span><span class="lnt">287
</span><span class="lnt">288
</span><span class="lnt">289
</span><span class="lnt">290
</span><span class="lnt">291
</span><span class="lnt">292
</span><span class="lnt">293
</span><span class="lnt">294
</span><span class="lnt">295
</span><span class="lnt">296
</span><span class="lnt">297
</span><span class="lnt">298
</span><span class="lnt">299
</span><span class="lnt">300
</span><span class="lnt">301
</span><span class="lnt">302
</span><span class="lnt">303
</span><span class="lnt">304
</span><span class="lnt">305
</span><span class="lnt">306
</span><span class="lnt">307
</span><span class="lnt">308
</span><span class="lnt">309
</span><span class="lnt">310
</span><span class="lnt">311
</span><span class="lnt">312
</span><span class="lnt">313
</span><span class="lnt">314
</span><span class="lnt">315
</span><span class="lnt">316
</span><span class="lnt">317
</span><span class="lnt">318
</span><span class="lnt">319
</span><span class="lnt">320
</span><span class="lnt">321
</span><span class="lnt">322
</span><span class="lnt">323
</span><span class="lnt">324
</span><span class="lnt">325
</span><span class="lnt">326
</span><span class="lnt">327
</span><span class="lnt">328
</span><span class="lnt">329
</span><span class="lnt">330
</span><span class="lnt">331
</span><span class="lnt">332
</span><span class="lnt">333
</span><span class="lnt">334
</span><span class="lnt">335
</span><span class="lnt">336
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">threading</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">weakref</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">django.utils.inspect</span> <span class="kn">import</span> <span class="n">func_accepts_kwargs</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ËøîÂõûÂØπË±°ÁöÑid,Âú®connectÂ≠òÂÇ®ËÆ∞ÂΩïÂíåsendÊü•ËØ¢ËÆ∞ÂΩïÊó∂‰ºöÁî®Âà∞</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Ê≥®ÊÑèÔºösenderÂíåreceiverÈÉΩÂøÖÈ°ªÊòØÂèØÂìàÂ∏åÁöÑ</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">_make_id</span><span class="p">(</span><span class="n">target</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="s1">&#39;__func__&#39;</span><span class="p">):</span>  <span class="c1"># Â¶ÇÊûúÊòØÂØπË±°ÊñπÊ≥ï</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="vm">__self__</span><span class="p">),</span> <span class="nb">id</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="vm">__func__</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nb">id</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># django.utils.inspect.func_accepts_kwargs</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Ê£ÄÊü•‰º†ÂÖ•ÁöÑÂáΩÊï∞ÊòØÂê¶Êé•Âèó**kwargsÂèÇÊï∞</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">func_accepts_kwargs</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nb">any</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="n">func</span><span class="p">)</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="n">p</span><span class="o">.</span><span class="n">VAR_KEYWORD</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">NONE_ID</span> <span class="o">=</span> <span class="n">_make_id</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># A marker for caching</span>
</span></span><span class="line"><span class="cl"><span class="n">NO_RECEIVERS</span> <span class="o">=</span> <span class="nb">object</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Signal</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    ÊâÄÊúâsignalÁöÑÂü∫Á±ª
</span></span></span><span class="line"><span class="cl"><span class="s2">    Base class for all signals
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    Internal attributes:
</span></span></span><span class="line"><span class="cl"><span class="s2">    
</span></span></span><span class="line"><span class="cl"><span class="s2">        receivers
</span></span></span><span class="line"><span class="cl"><span class="s2">            { receiverkey (id) : weakref(receiver) }
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">providing_args</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">use_caching</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">        ÂàõÂª∫Êñ∞ÁöÑsignal
</span></span></span><span class="line"><span class="cl"><span class="s2">        providing_args: Âú®Ë∞ÉÁî®send()ÊñπÊ≥ïÊó∂ÂèØ‰ª•‰º†ÂÖ•Ëøô‰∏™signalÁöÑÂèÇÊï∞ÂàóË°®
</span></span></span><span class="line"><span class="cl"><span class="s2">        &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">receivers</span> <span class="o">=</span> <span class="p">[]</span>  
</span></span><span class="line"><span class="cl">        <span class="c1"># ((receiver_id,sender_id),receiver_weakref)ÊàñËÄÖÊòØ((dispatch_id,sender_id),receiverweak_ref)</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># ÂÖ∑‰ΩìÊòØÂº∫ÂºïÁî®ËøòÊòØweakrefÂèñÂÜ≥‰∫éconnectÊó∂ÁöÑweakÂèÇÊï∞ÊòØTrueËøòÊòØFalse</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># ÈªòËÆ§weak‰∏∫True‰ΩøÁî®Âº±ÂºïÁî®ÔºåËã•‰∏∫FalseÂàôÂà†Èô§ËØ•Êù°ËÆ∞ÂΩïÊó∂ÈúÄË¶ÅÊâãÂä®disconnect</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">providing_args</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">providing_args</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">providing_args</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">providing_args</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">lock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>  <span class="c1"># Âä†ÈîÅ‰øùËØÅÊìç‰ΩúÊï∞ÊçÆÊó∂Á∫øÁ®ãÂÆâÂÖ®</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">use_caching</span> <span class="o">=</span> <span class="n">use_caching</span>  <span class="c1"># ÊòØÂê¶‰ΩøÁî®ÁºìÂ≠ò</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># ‰∏∫‰∫Ü‰æøÂà©Âç≥‰Ωø‰∏ç‰ΩøÁî®ÁºìÂ≠òÊàë‰ª¨‰πü‰ºöÂàõÂª∫Á©∫ÁöÑÁºìÂ≠ò</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># ÂÖ≥‰∫éÁºìÂ≠òÈúÄË¶ÅÊ≥®ÊÑèÁöÑ‰∏ÄÁÇπÊòØÔºöÂ¶ÇÊûúuse_caching‰∏∫TrueÔºåÂØπ‰∫éÊØè‰∏Ä‰∏™sender</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Êàë‰ª¨‰ºöÂú®sender_receiver_cache‰∏≠ÁºìÂ≠òÂÖ∂ÊâÄÊúâÁöÑreceiver„ÄÇ</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># ËØ•ÁºìÂ≠òÂú®Ë∞ÉÁî®.connect()ÊàñËÄÖ.disconnect()Êó∂‰ºöË¢´Ê∏ÖÈô§ÔºåËÄåÂú®Ë∞ÉÁî®sendÊó∂‰ºöË¢´Â°´ÂÖÖ</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">sender_receivers_cache</span> <span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">WeakKeyDictionary</span><span class="p">()</span> <span class="k">if</span> <span class="n">use_caching</span> <span class="k">else</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">_dead_receivers</span> <span class="o">=</span> <span class="kc">False</span>  
</span></span><span class="line"><span class="cl">        <span class="c1"># receiversÂ±ûÊÄßÂàóË°®‰∏≠ÊòØÂê¶Âê´Êúâ‚ÄúÂ§±Êïà‚ÄùÁöÑreceiverÂºïÁî®(Â∑≤Ë¢´ÂûÉÂúæÂõûÊî∂)</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Âú®_clear_dead_receiversÊñπÊ≥ï‰∏≠‰ºöÊ£ÄÊü•ÂÖ∂ÂÄºÔºåÂ¶ÇÊûú‰∏∫TrueÂàô‰ª£Ë°®ÂÖ∂‰∏≠</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># ÊúâÂ§±ÊïàÁöÑreceiverÂºïÁî®ÔºåÂàôËøáÊª§Ê∏ÖÁêÜ‰∏ÄÈÅçreceiversÂ±ûÊÄßÂàóË°®</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">receiver</span><span class="p">,</span> <span class="n">sender</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weak</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dispatch_uid</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">        # ÈÄöËøásignalÂ∞ÜreceiverËøûÊé•Âà∞sender
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">        Arguments:
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">            receiver
</span></span></span><span class="line"><span class="cl"><span class="s2">                A function or an instance method which is to receive signals.
</span></span></span><span class="line"><span class="cl"><span class="s2">                Receivers must be hashable objects.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">                If weak is True, then receiver must be weak referenceable.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">                Receivers must be able to accept keyword arguments.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">                If a receiver is connected with a dispatch_uid argument, it
</span></span></span><span class="line"><span class="cl"><span class="s2">                will not be added if another receiver was already connected
</span></span></span><span class="line"><span class="cl"><span class="s2">                with that dispatch_uid.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">            sender
</span></span></span><span class="line"><span class="cl"><span class="s2">                The sender to which the receiver should respond. Must either be
</span></span></span><span class="line"><span class="cl"><span class="s2">                a Python object, or None to receive events from any sender.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">            weak
</span></span></span><span class="line"><span class="cl"><span class="s2">                Whether to use weak references to the receiver. By default, the
</span></span></span><span class="line"><span class="cl"><span class="s2">                module will attempt to use weak references to the receiver
</span></span></span><span class="line"><span class="cl"><span class="s2">                objects. If this parameter is false, then strong references will
</span></span></span><span class="line"><span class="cl"><span class="s2">                be used.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">            dispatch_uid
</span></span></span><span class="line"><span class="cl"><span class="s2">                An identifier used to uniquely identify a particular instance of
</span></span></span><span class="line"><span class="cl"><span class="s2">                a receiver. This will usually be a string, though it may be
</span></span></span><span class="line"><span class="cl"><span class="s2">                anything hashable.
</span></span></span><span class="line"><span class="cl"><span class="s2">        &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># If DEBUG is on, check that we got a good receiver</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Â¶ÇÊûúÂú®DEBUGÊ®°Âºè‰∏ãÔºåÂàôÊ£ÄÊü•ËØ•receiverÊòØÂê¶Êª°Ë∂≥Ë¶ÅÊ±Ç</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">configured</span> <span class="ow">and</span> <span class="n">settings</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">assert</span> <span class="n">callable</span><span class="p">(</span><span class="n">receiver</span><span class="p">),</span> <span class="s2">&#34;Signal receivers must be callable.&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1"># Check for **kwargs</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="ow">not</span> <span class="n">func_accepts_kwargs</span><span class="p">(</span><span class="n">receiver</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&#34;Signal receivers must accept keyword arguments (**kwargs).&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">dispatch_uid</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">lookup_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">dispatch_uid</span><span class="p">,</span> <span class="n">_make_id</span><span class="p">(</span><span class="n">sender</span><span class="p">))</span>  <span class="c1"># Â¶ÇÊûúËÆæÁΩÆ‰∫Üdispatch_uid‰Ωú‰∏∫ÊüêreceiverÁöÑÊ†áËØÜ</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">lookup_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">_make_id</span><span class="p">(</span><span class="n">receiver</span><span class="p">),</span> <span class="n">_make_id</span><span class="p">(</span><span class="n">sender</span><span class="p">))</span>  <span class="c1"># Ê≤°Êúâdispatch_uidÂàô‰ΩøÁî®receiverÁöÑid</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">weak</span><span class="p">:</span>  <span class="c1"># Â¶ÇÊûú‰ΩøÁî®weakÂàôÂ≠òÂÇ®ËØ•receiverÁöÑÂº±ÂºïÁî®ÔºåÂê¶ÂàôÂ∞±Áõ¥Êé•Â≠òÂÇ®Âº∫ÂºïÁî®(Âº∫ÂºïÁî®ÊúÄÁªàÈúÄË¶ÅÊâãÂä®disconnect)</span>
</span></span><span class="line"><span class="cl">            <span class="n">ref</span> <span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ref</span>
</span></span><span class="line"><span class="cl">            <span class="n">receiver_object</span> <span class="o">=</span> <span class="n">receiver</span>  <span class="c1"># Âº∫ÂºïÁî®</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Check for bound methods</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">receiver</span><span class="p">,</span> <span class="s1">&#39;__self__&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">receiver</span><span class="p">,</span> <span class="s1">&#39;__func__&#39;</span><span class="p">):</span>  <span class="c1"># Ê£ÄÊü•ÊòØÂê¶ÊòØÂØπË±°ÊñπÊ≥ï</span>
</span></span><span class="line"><span class="cl">                <span class="c1"># https://docs.python.org/zh-cn/3/library/weakref.html#weakref.WeakMethod</span>
</span></span><span class="line"><span class="cl">                <span class="n">ref</span> <span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">WeakMethod</span>
</span></span><span class="line"><span class="cl">                <span class="n">receiver_object</span> <span class="o">=</span> <span class="n">receiver</span><span class="o">.</span><span class="vm">__self__</span>  <span class="c1"># ÂåÖÂê´ËØ•ÂØπË±°ÊñπÊ≥ïÁöÑÂØπË±°</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># ‰ΩøÁî®Âº±ÂºïÁî®Êõø‰ª£Âº∫ÂºïÁî®</span>
</span></span><span class="line"><span class="cl">            <span class="n">receiver</span> <span class="o">=</span> <span class="n">ref</span><span class="p">(</span><span class="n">receiver</span><span class="p">)</span>  <span class="c1"># ÊôÆÈÄöÂáΩÊï∞ÊñπÊ≥ïÂàôÁõ¥Êé•ÂèñÂÖ∂Âº±ÂºïÁî®</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1"># ÂΩìreceiverÊñπÊ≥ï„ÄÅÊàñÂåÖÂê´ËØ•ÊñπÊ≥ïÂØπË±°Ê∂à‰∫°Êó∂‰ªésignalÁöÑreceiversÂàóË°®‰∏≠Ê∏ÖÈô§ËØ•Êù°ËÆ∞ÂΩï</span>
</span></span><span class="line"><span class="cl">            <span class="n">weakref</span><span class="o">.</span><span class="n">finalize</span><span class="p">(</span><span class="n">receiver_object</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remove_receiver</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># https://docs.python.org/zh-cn/3/library/weakref.html#weakref.finalize</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># ÂΩìreceiverÂØπË±°ÂûÉÂúæÂõûÊî∂Êó∂Ë∞ÉÁî®_remove_receiverÁΩÆself._dead_receivers = True</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">_clear_dead_receivers</span><span class="p">()</span>  <span class="c1"># Ê∏ÖÈô§„ÄÅËøáÊª§dead_receivers</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">r_key</span> <span class="o">==</span> <span class="n">lookup_key</span> <span class="k">for</span> <span class="n">r_key</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">receivers</span><span class="p">):</span>  <span class="c1"># Êü•Èáç</span>
</span></span><span class="line"><span class="cl">                <span class="bp">self</span><span class="o">.</span><span class="n">receivers</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">lookup_key</span><span class="p">,</span> <span class="n">receiver</span><span class="p">))</span>  <span class="c1"># Ê∑ªÂä†((receiver_id,sender_id),receiver_weakref)</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">sender_receivers_cache</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>  <span class="c1"># ÂèòÊõ¥ÂêéÊ∏ÖÈô§ÁºìÂ≠ò</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">receiver</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sender</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dispatch_uid</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">        Â∞Üsignal‰∏≠ÁöÑreceiver‰∏ésender‚ÄúÊñ≠ÂºÄËøûÊé•‚Äù
</span></span></span><span class="line"><span class="cl"><span class="s2">        ËØ•ÂáΩÊï∞‰∏ªË¶ÅÈíàÂØπÈÇ£‰∫õÂú®connectÊó∂weakÂèÇÊï∞‰∏∫FalseÁöÑÊÉÖÂÜµÔºåÂç≥signalÁöÑreceiversÂàóË°®
</span></span></span><span class="line"><span class="cl"><span class="s2">        ‰∏≠Â≠òÂÇ®ÁöÑÊòØrceiverÁöÑÂº∫ÂºïÁî®
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">        Â¶ÇÊûúÂú®connectÊó∂‰ΩøÁî®ÁöÑÂº±ÂºïÁî®(weak=True), Âàô‰∏çÈúÄË¶ÅÊâãÂä®Ë∞ÉÁî®disconnectÊñπÊ≥ï
</span></span></span><span class="line"><span class="cl"><span class="s2">        receiverÂíåsenderÁöÑËÆ∞ÂΩï‰ºöË¢´Ëá™Âä®Âà†Èô§
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">        Arguments:
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">            receiver
</span></span></span><span class="line"><span class="cl"><span class="s2">                The registered receiver to disconnect. May be none if
</span></span></span><span class="line"><span class="cl"><span class="s2">                dispatch_uid is specified.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">            sender
</span></span></span><span class="line"><span class="cl"><span class="s2">                The registered sender to disconnect
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">            dispatch_uid
</span></span></span><span class="line"><span class="cl"><span class="s2">                the unique identifier of the receiver to disconnect
</span></span></span><span class="line"><span class="cl"><span class="s2">        &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">dispatch_uid</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">lookup_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">dispatch_uid</span><span class="p">,</span> <span class="n">_make_id</span><span class="p">(</span><span class="n">sender</span><span class="p">))</span>  <span class="c1"># Â¶ÇÊûúÊèê‰æõ‰∫Üdispatch_uidÂàô‰ΩøÁî®ÂÖ∂Êõø‰ª£ id(receiver)</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">lookup_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">_make_id</span><span class="p">(</span><span class="n">receiver</span><span class="p">),</span> <span class="n">_make_id</span><span class="p">(</span><span class="n">sender</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">disconnected</span> <span class="o">=</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">_clear_dead_receivers</span><span class="p">()</span>  <span class="c1"># ÂÖàÊ∏ÖÈô§dead_receivers</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">receivers</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">                <span class="p">(</span><span class="n">r_key</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">receivers</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="n">r_key</span> <span class="o">==</span> <span class="n">lookup_key</span><span class="p">:</span>  <span class="c1"># Ê†πÊçÆlookup_keyÂú®self.receivers‰∏≠Êü•Êâæ</span>
</span></span><span class="line"><span class="cl">                    <span class="n">disconnected</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">                    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">receivers</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>  <span class="c1"># Âà†Èô§self.receivers‰∏≠ÁöÑÂØπÂ∫îËÆ∞ÂΩï</span>
</span></span><span class="line"><span class="cl">                    <span class="k">break</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">sender_receivers_cache</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>  <span class="c1"># ÂèòÊõ¥ÂêéÊ∏ÖÈô§ÁºìÂ≠ò</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">disconnected</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">has_listeners</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sender</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># ÈÄöËøáË∞ÉÁî®_live_receiversÊñπÊ≥ïÁúãsenderÁöÑreciversÊòØÂê¶‰∏∫Á©∫</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_live_receivers</span><span class="p">(</span><span class="n">sender</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">send</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sender</span><span class="p">,</span> <span class="o">**</span><span class="n">named</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">        Send signal from sender to all connected receivers.
</span></span></span><span class="line"><span class="cl"><span class="s2">        ‰ªésender‰∏≠ÂèëÈÄÅ‰ø°Âè∑ÁªôÊâÄÊúâËøûÊé•Âà∞ËØ•senderÁöÑreceiver
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">        If any receiver raises an error, the error propagates back through send,
</span></span></span><span class="line"><span class="cl"><span class="s2">        terminating the dispatch loop. So it&#39;s possible that all receivers
</span></span></span><span class="line"><span class="cl"><span class="s2">        won&#39;t be called if an error is raised.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">        Arguments:
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">            sender
</span></span></span><span class="line"><span class="cl"><span class="s2">                The sender of the signal. Either a specific object or None.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">            named
</span></span></span><span class="line"><span class="cl"><span class="s2">                Named arguments which will be passed to receivers.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">        Return a list of tuple pairs [(receiver, response), ... ].
</span></span></span><span class="line"><span class="cl"><span class="s2">        &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">receivers</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">sender_receivers_cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">sender</span><span class="p">)</span> <span class="ow">is</span> <span class="n">NO_RECEIVERS</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Â¶ÇÊûúËØ•signalÂæóreceivers‰∏∫Á©∫ÊàñËÄÖËØ•senderÂØπÂ∫îÁöÑreceiversÁºìÂ≠ò‰∏∫Á©∫</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="n">receiver</span><span class="p">,</span> <span class="n">receiver</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">sender</span><span class="o">=</span><span class="n">sender</span><span class="p">,</span> <span class="o">**</span><span class="n">named</span><span class="p">))</span>  <span class="c1"># ËøôÈáåÁöÑreceiverÂ∞±ÊòØÂÖ∑‰ΩìÁöÑreceiverÂáΩÊï∞</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="n">receiver</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_live_receivers</span><span class="p">(</span><span class="n">sender</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># _live_receiverËøîÂõûÁöÑÊòØreceiverÁöÑÂèØË∞ÉÁî®ÂØπË±°(Â∞±ÊòØÂÖ∑‰ΩìÁöÑreceiverÂáΩÊï∞ÔºåÂº∫ÂºïÁî®)ÁöÑÂàóË°®</span>
</span></span><span class="line"><span class="cl">        <span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># ËøîÂõû[(receiverÂáΩÊï∞,Ë∞ÉÁî®receiverÂáΩÊï∞ÁöÑÁªìÊûú)]Â¶ÇÊûúË∞ÉÁî®Êüê‰∏™receiverÊó∂ÂèëÁîüÂºÇÂ∏∏Á®ãÂ∫è‰ºöÁõ¥Êé•ÈÄÄÂá∫</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># ÂØºËá¥ÂÖ∂‰ªñÁöÑÂâ©‰∏ãÁöÑreceiverÂπ∂Êú™Ë¢´ÊâßË°å</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">send_robust</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sender</span><span class="p">,</span> <span class="o">**</span><span class="n">named</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">        Send signal from sender to all connected receivers catching errors.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">        Arguments:
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">            sender
</span></span></span><span class="line"><span class="cl"><span class="s2">                The sender of the signal. Can be any Python object (normally one
</span></span></span><span class="line"><span class="cl"><span class="s2">                registered with a connect if you actually want something to
</span></span></span><span class="line"><span class="cl"><span class="s2">                occur).
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">            named
</span></span></span><span class="line"><span class="cl"><span class="s2">                Named arguments which will be passed to receivers. These
</span></span></span><span class="line"><span class="cl"><span class="s2">                arguments must be a subset of the argument names defined in
</span></span></span><span class="line"><span class="cl"><span class="s2">                providing_args.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">        Return a list of tuple pairs [(receiver, response), ... ].
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">        If any receiver raises an error (specifically any subclass of
</span></span></span><span class="line"><span class="cl"><span class="s2">        Exception), return the error instance as the result for that receiver.
</span></span></span><span class="line"><span class="cl"><span class="s2">        Áõ∏ÊØîsendÊñπÊ≥ïË∞ÉÁî®receiverÊñπÊ≥ïÂºÇÂ∏∏Êó∂Áõ¥Êé•ÈÄÄÂá∫Ôºåsend_robust‰ºöÊî∂ÈõÜÂºÇÂ∏∏Âπ∂ËøîÂõû
</span></span></span><span class="line"><span class="cl"><span class="s2">        &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">receivers</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">sender_receivers_cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">sender</span><span class="p">)</span> <span class="ow">is</span> <span class="n">NO_RECEIVERS</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># Call each receiver with whatever arguments it can accept.</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Return a list of tuple pairs [(receiver, response), ... ].</span>
</span></span><span class="line"><span class="cl">        <span class="n">responses</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">receiver</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_live_receivers</span><span class="p">(</span><span class="n">sender</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">response</span> <span class="o">=</span> <span class="n">receiver</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">sender</span><span class="o">=</span><span class="n">sender</span><span class="p">,</span> <span class="o">**</span><span class="n">named</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">responses</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">receiver</span><span class="p">,</span> <span class="n">err</span><span class="p">))</span>  
</span></span><span class="line"><span class="cl">                <span class="c1"># Â¶ÇÊûúË∞ÉÁî®receiverÂá∫Áé∞ÂºÇÂ∏∏ÂàôÊçïËé∑Âπ∂ËøîÂõûÁõ∏Â∫îÁöÑÂºÇÂ∏∏ËÄå‰∏çÂΩ±ÂìçÂÖ∂‰ªñreceiverÁöÑË∞ÉÁî®</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">responses</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">receiver</span><span class="p">,</span> <span class="n">response</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">responses</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_clear_dead_receivers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Note: caller is assumed to hold self.lock.</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Ê∏ÖÈô§dead_receivers</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dead_receivers</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">_dead_receivers</span> <span class="o">=</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">receivers</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                <span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">receivers</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ReferenceType</span><span class="p">)</span> <span class="ow">and</span> <span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">]()</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="c1"># Âº±ÂºïÁî®ÔºåÂπ∂‰∏îËØ•Âº±ÂºïÁî®ÂØπÂ∫îÁöÑÂØπË±°Â∑≤Ê∂à‰∫°</span>
</span></span><span class="line"><span class="cl">            <span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_live_receivers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sender</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">        Filter sequence of receivers to get resolved, live receivers.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">        This checks for weak references and resolves them, then returning only
</span></span></span><span class="line"><span class="cl"><span class="s2">        live receivers.
</span></span></span><span class="line"><span class="cl"><span class="s2">        &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">receivers</span> <span class="o">=</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_caching</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dead_receivers</span><span class="p">:</span>  <span class="c1"># Â¶ÇÊûú‰ΩøÁî®ÁºìÂ≠òÂπ∂‰∏îself.receivers‰∏≠Êó†dead_receivers</span>
</span></span><span class="line"><span class="cl">            <span class="n">receivers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sender_receivers_cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">sender</span><span class="p">)</span>  <span class="c1"># Áõ¥Êé•‰ªéÁºìÂ≠ò‰∏≠Ëé∑Âèñ</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># We could end up here with NO_RECEIVERS even if we do check this case in</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># .send() prior to calling _live_receivers() due to concurrent .send() call.</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Âú®Ë∞ÉÁî®_live_receiversÊñπÊ≥ïÁöÑÊñπÊ≥ï‰∏≠Â∑≤ÁªèÊ£ÄÊü•Ëøá‰∏ÄÊ¨°‰∫Ü</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">receivers</span> <span class="ow">is</span> <span class="n">NO_RECEIVERS</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">receivers</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># Â¶ÇÊûú‰∏ç‰ΩøÁî®ÁºìÂ≠òÊàñËÄÖÂ≠òÂú®ÂæÖÊ∏ÖÁêÜÁöÑdead receivers</span>
</span></span><span class="line"><span class="cl">            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="bp">self</span><span class="o">.</span><span class="n">_clear_dead_receivers</span><span class="p">()</span>  <span class="c1"># ÂÖàÊ∏ÖÁêÜdead_receivers</span>
</span></span><span class="line"><span class="cl">                <span class="n">senderkey</span> <span class="o">=</span> <span class="n">_make_id</span><span class="p">(</span><span class="n">sender</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">receivers</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">                <span class="k">for</span> <span class="p">(</span><span class="n">receiverkey</span><span class="p">,</span> <span class="n">r_senderkey</span><span class="p">),</span> <span class="n">receiver</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">receivers</span><span class="p">:</span> <span class="c1"># ÈÅçÂéÜself.receiversËøõË°åÊü•ÊâæÂåπÈÖç</span>
</span></span><span class="line"><span class="cl">                    <span class="k">if</span> <span class="n">r_senderkey</span> <span class="o">==</span> <span class="n">NONE_ID</span> <span class="ow">or</span> <span class="n">r_senderkey</span> <span class="o">==</span> <span class="n">senderkey</span><span class="p">:</span>  <span class="c1"># Â¶ÇÊûúsenderkey‰∏∫id(None)ÊàñÂåπÈÖç</span>
</span></span><span class="line"><span class="cl">                        <span class="n">receivers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">receiver</span><span class="p">)</span>  <span class="c1"># Â∞Üreceiver(weakref)Ê∑ªÂä†Âà∞receivers‰∏≠</span>
</span></span><span class="line"><span class="cl">                <span class="c1"># Êõ¥Êñ∞ÁºìÂ≠ò</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_caching</span><span class="p">:</span>  <span class="c1"># Â¶ÇÊûú‰ΩøÁî®ÁºìÂ≠ò</span>
</span></span><span class="line"><span class="cl">                    <span class="k">if</span> <span class="ow">not</span> <span class="n">receivers</span><span class="p">:</span>  <span class="c1"># Â¶ÇÊûúËØ•senderÊ≤°Êúâreceiver (receivers‰∏∫Á©∫)</span>
</span></span><span class="line"><span class="cl">                        <span class="bp">self</span><span class="o">.</span><span class="n">sender_receivers_cache</span><span class="p">[</span><span class="n">sender</span><span class="p">]</span> <span class="o">=</span> <span class="n">NO_RECEIVERS</span>  <span class="c1"># Â∞Ücache‰∏≠ËØ•senderÁöÑreceiversÁΩÆ‰∏∫Á©∫</span>
</span></span><span class="line"><span class="cl">                    <span class="k">else</span><span class="p">:</span>  <span class="c1"># Â¶ÇÊûúËØ•senderÂ≠òÂú®ÂØπÂ∫îÁöÑreceiver</span>
</span></span><span class="line"><span class="cl">                        <span class="c1"># Note, we must cache the weakref versions.</span>
</span></span><span class="line"><span class="cl">                        <span class="c1"># Ê≥®ÊÑèÊàë‰ª¨Â∫îËØ•ÁºìÂ≠òÂº±ÂºïÁî®</span>
</span></span><span class="line"><span class="cl">                        <span class="bp">self</span><span class="o">.</span><span class="n">sender_receivers_cache</span><span class="p">[</span><span class="n">sender</span><span class="p">]</span> <span class="o">=</span> <span class="n">receivers</span>  <span class="c1"># Â∞ÜËØ•senderÂèäÂÖ∂ÊâÄÊúâÁöÑreceiversÁºìÂ≠òËµ∑Êù•</span>
</span></span><span class="line"><span class="cl">        <span class="n">non_weak_receivers</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">receiver</span> <span class="ow">in</span> <span class="n">receivers</span><span class="p">:</span>  <span class="c1"># receiversË¶Å‰πà‰∏∫[] Ë¶Å‰πà‰∏∫[receiver]</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">receiver</span><span class="p">,</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ReferenceType</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">                <span class="c1"># Dereference the weak reference.</span>
</span></span><span class="line"><span class="cl">                <span class="c1"># https://www.kite.com/python/docs/weakref.ReferenceType</span>
</span></span><span class="line"><span class="cl">                <span class="n">receiver</span> <span class="o">=</span> <span class="n">receiver</span><span class="p">()</span>  <span class="c1"># Ëé∑ÂèñÂº±ÂºïÁî®ÊâÄÊåáÁöÑÂÆûÈôÖÂØπË±°ÔºåËã•Â∑≤Ê∂à‰∫°ÂàôËøîÂõûNoneÔºåÂê¶ÂàôËøîÂõûÂØπË±°ÁöÑÂº∫ÂºïÁî®(‚ÄúÂèØÁõ¥Êé•Ë∞ÉÁî®‚Äù)</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="n">receiver</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># refÊâÄÊåáÁöÑÂéüÂØπË±°Â∞öÊú™Ê∂à‰∫°</span>
</span></span><span class="line"><span class="cl">                    <span class="n">non_weak_receivers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">receiver</span><span class="p">)</span>  <span class="c1"># Ê∑ªÂä†ÂÆûÈôÖÂèØË∞ÉÁî®ÁöÑÂØπË±°</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">non_weak_receivers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">receiver</span><span class="p">)</span>  <span class="c1"># ‰∏çÊòØÂº±ÂºïÁî®ÂàôÁõ¥Êé•Ê∑ªÂä†</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">non_weak_receivers</span>  <span class="c1"># ÂèØË∞ÉÁî®ÂØπË±°receiverÁöÑÂàóË°®</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_remove_receiver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">receiver</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Mark that the self.receivers list has dead weakrefs. If so, we will</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># clean those up in connect, disconnect and _live_receivers while</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># holding self.lock. Note that doing the cleanup here isn&#39;t a good</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># idea, _remove_receiver() will be called as side effect of garbage</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># collection, and so the call can happen while we are already holding</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># self.lock.</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Ê†áËÆ∞self.receivers‰∏≠Êúâdead weakrefs(weakrefÊâÄÊåáÂØπË±°Â∑≤Ê∂à‰∫°).Â¶ÇÊûúÂ≠òÂú®dead receiver</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Á®ãÂ∫è‰ºöÂú®Ë∞ÉÁî®connect, disconnectÂíå_live_receiversÊó∂Âú®Âä†ÈîÅÁöÑÊÉÖÂÜµ‰∏ãÊ∏ÖÈô§dead weakrefs</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Ê≥®ÊÑèÂú®ËøôÈáåÊâßË°åÂÖ∑‰ΩìÁöÑÊ∏ÖÈô§Êìç‰ΩúÂπ∂‰∏çÊòØ‰∏Ä‰∏™Â•Ω‰∏ªÊÑèÔºåÂú®ÂûÉÂúæÂõûÊî∂Êó∂_remove_receiver()‰ºöË¢´</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Ëá™Âä®Ëß¶ÂèëÔºåËÄåÊàë‰ª¨ÂèØËÉΩÂú®ÂÖ∂‰ªñÊìç‰Ωú‰∏≠ÂØπreceiversÂä†‰∫ÜÈîÅÔºåÊ≠§Êó∂Ê∏ÖÁêÜreceiversÂ∞Ü‰ºöÂØºËá¥ÂÜ≤Á™Å</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">_dead_receivers</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">receiver</span><span class="p">(</span><span class="n">signal</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    A decorator for connecting receivers to signals. Used by passing in the
</span></span></span><span class="line"><span class="cl"><span class="s2">    signal (or list of signals) and keyword arguments to connect::
</span></span></span><span class="line"><span class="cl"><span class="s2">    Áî®Êù•Â∞ÜreceiversËøûÊé•Âà∞ÂØπÂ∫îsignalÁöÑË£ÖÈ•∞Âô®. ‰ΩøÁî®Êó∂‰º†ÂÖ•signal(ÊàñËÄÖÊòØË£ÖÊúâsignalÁöÑÂàóË°®)
</span></span></span><span class="line"><span class="cl"><span class="s2">    ‰ª•ÂèäÁõ∏ÂÖ≥ÁöÑÂÖ≥ÈîÆÂ≠óÂèÇÊï∞
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">        @receiver(post_save, sender=MyModel)
</span></span></span><span class="line"><span class="cl"><span class="s2">        def signal_receiver(sender, **kwargs):
</span></span></span><span class="line"><span class="cl"><span class="s2">            ...
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">        @receiver([post_save, post_delete], sender=MyModel)
</span></span></span><span class="line"><span class="cl"><span class="s2">        def signals_receiver(sender, **kwargs):
</span></span></span><span class="line"><span class="cl"><span class="s2">            ...
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_decorator</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">signal</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>  <span class="c1"># ‰º†ÂÖ•ÁöÑÊòØsignalÂàóË°®</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">signal</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">s</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># Ë∞ÉÁî®connectÊñπÊ≥ïÔºåsenderÁöÑ‰ø°ÊÅØÂåÖÂê´Âú®kwargs‰∏≠‰∫Ü</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">signal</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">func</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">_decorator</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Èô§Ê≠§‰πãÂ§ñÔºådjangoÂ∑≤Áªè‰∏∫Êàë‰ª¨È¢ÑÁΩÆ‰∫Ü‰∏Ä‰∫õ‰ø°Âè∑:</p>
<p><code>pre_init</code>„ÄÅ<code>post_init</code>„ÄÅ<code>pre_save</code>„ÄÅ<code>post_save</code>„ÄÅ<code>pre_delete</code>„ÄÅ<code>post_delete</code>„ÄÅ<code>m2m_change</code>‚Ä¶‚Ä¶(<a class="link" href="https://docs.djangoproject.com/zh-hans/3.0/ref/signals/"  target="_blank" rel="noopener"
    >ËØ¶ÁªÜÁî®Ê≥ïËßÅÂÆòÊñπÊñáÊ°£</a>)</p>
<p>djangoÂú®<a class="link" href="https://github.com/django/django/blob/main/django/db/models/signals.py"  target="_blank" rel="noopener"
    ><code>django/db/models/signals.py</code></a>‰∏≠ÂÆö‰πâ‰∫Ü‰∏éÊï∞ÊçÆÂ∫ìModelÁõ∏ÂÖ≥ÁöÑ‰ø°Âè∑ÂØπË±°:</p>
<ul>
<li><a class="link" href="https://docs.djangoproject.com/zh-hans/3.0/ref/signals/#pre-init"  target="_blank" rel="noopener"
    >pre_init &amp; post_init</a></li>
<li><a class="link" href="https://docs.djangoproject.com/zh-hans/3.0/ref/signals/#pre-save"  target="_blank" rel="noopener"
    >pre_save &amp; post_save</a></li>
<li><a class="link" href="https://docs.djangoproject.com/zh-hans/3.0/ref/signals/#pre-delete"  target="_blank" rel="noopener"
    >pre_delete &amp; post_delete</a></li>
<li><a class="link" href="https://docs.djangoproject.com/zh-hans/3.0/ref/signals/#m2m-changed"  target="_blank" rel="noopener"
    >m2m_change</a></li>
<li><a class="link" href="https://docs.djangoproject.com/zh-hans/3.0/ref/signals/#class-prepared"  target="_blank" rel="noopener"
    >class_prepared</a></li>
<li><a class="link" href="https://docs.djangoproject.com/zh-hans/3.0/ref/signals/#pre-migrate"  target="_blank" rel="noopener"
    >pre_migrate &amp; post_migrate</a></li>
</ul>
<p>Âú®<a class="link" href="https://github.com/django/django/blob/main/django/core/signals.py"  target="_blank" rel="noopener"
    ><code>django/core/signals.py</code></a>‰∏≠ÂÆö‰πâ‰∫Ü‰∏érequestÂíåsettingÁõ∏ÂÖ≥ÁöÑ‰ø°Âè∑ÂØπË±°:</p>
<ul>
<li><a class="link" href="https://docs.djangoproject.com/zh-hans/3.0/ref/signals/#request-started"  target="_blank" rel="noopener"
    >request_started &amp; request_finished</a></li>
<li><a class="link" href="https://docs.djangoproject.com/zh-hans/3.0/ref/signals/#got-request-exception"  target="_blank" rel="noopener"
    >got_request_exception</a></li>
<li><a class="link" href="https://docs.djangoproject.com/zh-hans/3.0/ref/signals/#setting-changed"  target="_blank" rel="noopener"
    >setting_changed</a></li>
</ul>
<p>django‰∏∫Êàë‰ª¨È¢ÑÁΩÆËøô‰∫õ‰ø°Âè∑ÂØπË±°ÔºåÂπ∂‰∏îÂú®<u>ÈÄÇÂΩìÁöÑÊó∂ÂÄô</u>Ë∞ÉÁî®<u>ÈÄÇÂΩìÁöÑ‰ø°Âè∑ÂØπË±°</u>ÂèëÈÄÅ<u>ÈÄÇÂΩìÁöÑ‚Äú‰ø°Âè∑‚Äù</u>„ÄÇÊØîÂ¶ÇÂú®<a class="link" href="https://github.com/django/django/blob/316cc34d046ad86e100227772294f906fae1c2e5/django/db/models/base.py#L404"  target="_blank" rel="noopener"
    ><code>django/db/models/base.py</code></a>‰∏≠ÔºåÂú®ModelÁ±ªÁöÑ__init__ÊñπÊ≥ïÂºÄÂßã‰ΩçÁΩÆË∞ÉÁî®<a class="link" href="https://github.com/django/django/blob/316cc34d046ad86e100227772294f906fae1c2e5/django/db/models/base.py#L415"  target="_blank" rel="noopener"
    >pre_init.send()</a>Âú®__init__ÁöÑÁªìÊùü‰ΩçÁΩÆË∞ÉÁî®<a class="link" href="https://github.com/django/django/blob/316cc34d046ad86e100227772294f906fae1c2e5/django/db/models/base.py#L509"  target="_blank" rel="noopener"
    >post_init.send()</a>ÔºåËÄåÊàë‰ª¨ÁöÑmodelÂèàÈÉΩÊòØÁªßÊâøËá™ËØ•Model„ÄÇ</p>
<p>django‰∏∫Êàë‰ª¨È¢ÑÁΩÆÂ•Ω‰∫Ü‰∏Ä‰∫õ‰ø°Âè∑ÔºåÂπ∂‰∏îÂú®ÂÅöÁõ∏Â∫îÊìç‰ΩúÊó∂‰ºöÂèëÈÄÅÂØπÂ∫îÁöÑ‰ø°Âè∑ÔºåÊâÄ‰ª•Êàë‰ª¨ÈúÄË¶ÅÂÅöÁöÑÂ∞±ÊòØÂú®ÈúÄË¶ÅÁî®Âà∞Êó∂ÔºåÂÆö‰πâÂØπÂ∫îÁöÑreceiverÂéªÊé•Êî∂ÂØπÂ∫îÁöÑ‰ø°Âè∑üì∂Âç≥ÂèØ„ÄÇÂΩìÁÑ∂Êàë‰ª¨‰πüÂèØ‰ª•Áõ¥Êé•ÂÆû‰æãÂåñÊàñÁªßÊâøSignalÁ±ªÊù•ÂÆö‰πâÊàë‰ª¨Ëá™Â∑±ÁöÑ‰ø°Âè∑„ÄÇÂÖ∑‰ΩìÁöÑ‰ΩøÁî®ÂèØ‰ª•ÂèÇËßÅ<a class="link" href="https://www.liujiangblog.com/course/django/170"  target="_blank" rel="noopener"
    >ËøôÁØáÂçöÂÆ¢</a></p>
<h2 id="‰∏Ä‰∫õÂèØËÉΩÊúâÁî®ÁöÑÈìæÊé•">‰∏Ä‰∫õÂèØËÉΩÊúâÁî®ÁöÑÈìæÊé•
</h2><ul>
<li><a class="link" href="https://docs.python.org/zh-cn/3/library/weakref.html"  target="_blank" rel="noopener"
    >Python Âº±ÂºïÁî®</a></li>
<li>Python ÂûÉÂúæÂõûÊî∂
<ol>
<li><a class="link" href="https://docs.python.org/zh-cn/3.8/library/gc.html"  target="_blank" rel="noopener"
    >python gcÊ®°ÂùóÊé•Âè£ÊñáÊ°£</a></li>
<li><a class="link" href="https://www.jianshu.com/p/1e375fb40506"  target="_blank" rel="noopener"
    >ÁÆÄ‰π¶ PythonÂûÉÂúæÂõûÊî∂Êú∫Âà∂</a></li>
<li><a class="link" href="https://zhuanlan.zhihu.com/p/83251959"  target="_blank" rel="noopener"
    >Áü•‰πé PythonÂûÉÂúæÂõûÊî∂Êú∫Âà∂</a></li>
</ol>
</li>
</ul>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/python/">Python</a>
        
            <a href="/tags/django/">Django</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>


    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">Related content</h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="has-image">
    <a href="/p/top-6-django-decorators/">
        
        
            <div class="article-image">
                <img src="/p/top-6-django-decorators/top-6-django-decorators.3d19f1f09ba5d940aa0d60f9a5aff2b4_hu7783161890850055115.jpg" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post Top 6 Django Decorators"
                        data-key="top-6-django-decorators" 
                        data-hash="md5-PRnx8Jul2UCqDWD5pa/ytA==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">Top 6 Django Decorators</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/internal-sort/">
        
        
            <div class="article-image">
                <img src="/p/internal-sort/internal-sort.de55f3fac40b7cda92238bd6566e842d_hu829372757959253208.jpg" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post Â∏∏Áî®ÂÜÖÈÉ®ÊéíÂ∫èÁÆóÊ≥ï"
                        data-key="internal sort" 
                        data-hash="md5-3lXz&#43;sQLfNqSI4vWVm6ELQ==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">Â∏∏Áî®ÂÜÖÈÉ®ÊéíÂ∫èÁÆóÊ≥ï</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/zxcvbn-explained/">
        
        
            <div class="article-image">
                <img src="/p/zxcvbn-explained/artiom-vallat-y7nZ4ENg7ic-unsplash.2283c5d768410121dca955c3526137a3_hu3144410286309968048.jpg" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post zxcvbn ÂéüÁêÜËØ¶Ëß£"
                        data-key="zxcvbn explained" 
                        data-hash="md5-IoPF12hBASHcqVXDUmE3ow==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">zxcvbn ÂéüÁêÜËØ¶Ëß£</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/analyzing-libpcap-pcap-file/">
        
        
            <div class="article-image">
                <img src="/p/analyzing-libpcap-pcap-file/cover.c098cdcd1ed9e47f7e0c93684c782214_hu2080152033521557187.jpg" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post LibpcapÊ†ºÂºèpcapÂåÖÂàÜÊûê"
                        data-key="analyzing libpcap pcap file" 
                        data-hash="md5-wJjNzR7Z5H9&#43;DJNoTHgiFA==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">LibpcapÊ†ºÂºèpcapÂåÖÂàÜÊûê</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/implementing-a-trie-in-python/">
        
        
            <div class="article-image">
                <img src="/p/implementing-a-trie-in-python/trie.02fdb0bd3268abc47c744733f52d5d50_hu7520324502837500842.jpeg" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post Implementing a Trie in Python"
                        data-key="implementing a trie in Python" 
                        data-hash="md5-Av2wvTJoq8R8dEcz9S1dUA==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">Implementing a Trie in Python</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    <div class="disqus-container">
    <div id="disqus_thread"></div>
<script>
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "heaciy" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>

<style>
    .disqus-container {
        background-color: var(--card-background);
        border-radius: var(--card-border-radius);
        box-shadow: var(--shadow-l1);
        padding: var(--card-padding);
    }
</style>

<script>
    window.addEventListener('onColorSchemeChange', (e) => {
        if (typeof DISQUS == 'object') {
            DISQUS.reset({
                reload: true
            });
        }
    })
</script>

    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2019 - 
        
        2025 Heaciy&#39;s Blog
    </section>
    
    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        Theme <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.30.0">Stack</a></b> designed by <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a>
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
