<!DOCTYPE html>
<html lang="en-us">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='ä»Observer patternåˆ°Django signal'><title>Django Signalç®€æ</title>

<link rel='canonical' href='https://heaciy.com/p/django-signal-principle-analysis/'>

<link rel="stylesheet" href="/scss/style.min.css"><script src='//unpkg.com/valine/dist/Valine.min.js'></script><meta property='og:title' content='Django Signalç®€æ'>
<meta property='og:description' content='ä»Observer patternåˆ°Django signal'>
<meta property='og:url' content='https://heaciy.com/p/django-signal-principle-analysis/'>
<meta property='og:site_name' content='Heaciy&#39;s Blog'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='python' /><meta property='article:tag' content='django' /><meta property='article:published_time' content='2021-06-10T00:00:00&#43;00:00'/><meta property='article:modified_time' content='2021-06-10T00:00:00&#43;00:00'/><meta property='og:image' content='https://images.unsplash.com/photo-1494129935429-873eafa78178?crop=entropy&amp;cs=tinysrgb&amp;fit=max&amp;fm=jpg&amp;ixid=MXwxMTc3M3wwfDF8c2VhcmNofDF8fHNpZ25hbHN8ZW58MHx8fA&amp;ixlib=rb-1.2.1&amp;q=80&amp;w=2000' />
<meta name="twitter:title" content="Django Signalç®€æ">
<meta name="twitter:description" content="ä»Observer patternåˆ°Django signal"><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='https://images.unsplash.com/photo-1494129935429-873eafa78178?crop=entropy&amp;cs=tinysrgb&amp;fit=max&amp;fm=jpg&amp;ixid=MXwxMTc3M3wwfDF8c2VhcmNofDF8fHNpZ25hbHN8ZW58MHx8fA&amp;ixlib=rb-1.2.1&amp;q=80&amp;w=2000' />
    </head>
    <body class="">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            localStorage.setItem(colorSchemeKey, "auto");
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.body.dataset.scheme = 'dark';
        } else {
            document.body.dataset.scheme = 'light';
        }
    })();
</script><div class="container main-container flex on-phone--column extended article-page with-toolbar">
            <aside class="sidebar left-sidebar sticky">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="Toggle Menu">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header class="site-info">
        
            <figure class="site-avatar">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu5506042264f2f143136192cbc8fadc99_165574_300x0_resize_box_2.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar" referrer="no-referrer|origin|unsafe-url">
                    
                

                
                    <span class="emoji">ğŸ‰</span>
                
            </figure>
        
        <h1 class="site-name"><a href="https://heaciy.com">Heaciy&#39;s Blog</a></h1>
        <h2 class="site-description">Life is what happens to you while you&#39;re busy making other plans.</h2>
    </header>

    <ol class="menu" id="main-menu">
        
        
        

        <li >
            <a href='/'>
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>Home</span>
            </a>
        </li>
        
        

        <li >
            <a href='/about'>
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>About</span>
            </a>
        </li>
        
        

        <li >
            <a href='/archives'>
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archives</span>
            </a>
        </li>
        
        

        <li >
            <a href='/search'>
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        
        

        <li >
            <a href='/index.xml'>
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-rss" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="5" cy="19" r="1" />
  <path d="M4 4a16 16 0 0 1 16 16" />
  <path d="M4 11a9 9 0 0 1 9 9" />
</svg>



                
                <span>Feed</span>
            </a>
        </li>
        

        
    </ol>
</aside>

            <main class="main full-width">
    <div id="article-toolbar">
        <a href="https://heaciy.com" class="back-home">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="15 6 9 12 15 18" />
</svg>



            <span>Back</span>
        </a>
    </div>

    <article class="has-image main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/p/django-signal-principle-analysis/">
                
                    <img src="https://images.unsplash.com/photo-1494129935429-873eafa78178?crop=entropy&amp;amp;cs=tinysrgb&amp;amp;fit=max&amp;amp;fm=jpg&amp;amp;ixid=MXwxMTc3M3wwfDF8c2VhcmNofDF8fHNpZ25hbHN8ZW58MHx8fA&amp;amp;ixlib=rb-1.2.1&amp;amp;q=80&amp;amp;w=2000" loading="lazy" alt="Featured image of post Django Signalç®€æ" referrer="no-referrer|origin|unsafe-url" />
                
            </a>
        </div>
    

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/cs/" >
                CS
            </a>
        
    </header>
    

    <h2 class="article-title">
        <a href="/p/django-signal-principle-analysis/">Django Signalç®€æ</a>
    </h2>

    
    <h3 class="article-subtitle">
        ä»Observer patternåˆ°Django signal
    </h3>
    <footer class="article-time">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



        <time class="article-time--published">Jun 10, 2021</time>
    </footer></div>
</header>

    <section class="article-content">
    <blockquote>
<p>æˆ‘æ‰¿è®¤ï¼Œæ˜¯æ ‡é¢˜å…šï¼å“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆï¼Œæœ¬æ¥æ˜¯å‡†å¤‡å†™ä¸€ç¯‡â€œDjango Signalæºç è§£æâ€”â€”ä»Observer Patternåˆ°Django Signalâ€çš„ï¼Œä½†æ˜¯æˆ‘åˆä¸èƒ½ä¸€ä¸¤å¥è¯æŠŠè§‚å¯Ÿè€…æ¨¡å¼è®²æ¸…æ¥šçš„ï¼Œå¹²è„†å°±ç›´æ¥è´´äº†ä¸€äº›ç›¸å…³çš„é“¾æ¥â€¦â€¦åé¢è¶Šå†™è¶Šå¤šã€è¶Šæ‹–è¶Šé•¿å°±å¹²è„†æ”¹æˆç®€æç®—äº†â€¦â€¦<br/>
æœ¬æ–‡åªä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ï¼Œä»…ä¾›å‚è€ƒï¼Œå¦‚æœ‰è¯¯æ¬¢è¿è®¨è®ºæŒ‡æ­£<br/>
é¢˜å›¾æ¥è‡ª unsplashï¼Œ<a class="link" href="https://images.unsplash.com/photo-1494129935429-873eafa78178?crop=entropy&amp;amp;cs=tinysrgb&amp;amp;fit=max&amp;amp;fm=jpg&amp;amp;ixid=MXwxMTc3M3wwfDF8c2VhcmNofDF8fHNpZ25hbHN8ZW58MHx8fA&amp;amp;ixlib=rb-1.2.1&amp;amp;q=80&amp;amp;w=2000"  target="_blank" rel="noopener"
    >åŸå›¾é“¾æ¥ğŸ”—</a></p>
</blockquote>
<h3 id="è§‚å¯Ÿè€…æ¨¡å¼">è§‚å¯Ÿè€…æ¨¡å¼</h3>
<p>â€œè§‚å¯Ÿè€…æ¨¡å¼æ˜¯ä¸€ç§å¯¹è±¡è¡Œä¸ºæ¨¡å¼ã€‚å®ƒå®šä¹‰å¯¹è±¡é—´çš„ä¸€ç§ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»ï¼Œå½“ä¸€ä¸ªå¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œæ‰€æœ‰ä¾èµ–äºå®ƒçš„å¯¹è±¡éƒ½å¾—åˆ°é€šçŸ¥å¹¶è¢«è‡ªåŠ¨æ›´æ–°ã€‚<a class="link" href="https://baike.baidu.com/item/%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F/5881786"  target="_blank" rel="noopener"
    >[1]</a>â€</p>
<p>â€œè§‚å¯Ÿè€…æ¨¡å¼æ˜¯ä¸€ç§è¡Œä¸ºè®¾è®¡æ¨¡å¼ï¼Œ å…è®¸ä½ å®šä¹‰ä¸€ç§è®¢é˜…æœºåˆ¶ï¼Œ å¯åœ¨å¯¹è±¡äº‹ä»¶å‘ç”Ÿæ—¶é€šçŸ¥å¤šä¸ª â€œè§‚å¯Ÿâ€ è¯¥å¯¹è±¡çš„å…¶ä»–å¯¹è±¡ã€‚<a class="link" href="https://refactoringguru.cn/design-patterns/observer"  target="_blank" rel="noopener"
    >[2]</a>â€</p>
<p>è§‚å¯Ÿè€…æ¨¡å¼æœ‰å¤šç§å®ç°æ–¹å¼ï¼Œæ¯”è¾ƒç»å…¸çš„ä¸€ç§å®ç°ï¼Œæœ‰å››ä¸ªè§’è‰²ï¼šSubjectï¼ˆè¢«è§‚å¯Ÿå¯¹è±¡æŠ½è±¡ç±»ï¼‰ã€Observerï¼ˆè§‚å¯Ÿè€…æŠ½è±¡ç±»ï¼‰ã€ConcreateObserverï¼ˆå…·ä½“è§‚å¯Ÿè€…ï¼‰ã€ConcreateSubject(å…·ä½“çš„è¢«è§‚å¯Ÿè€…)â€¦â€¦</p>
<p>è¿™é‡Œå°±ä¸èµ˜è¿°äº†â€¦â€¦å¯ä»¥å‚è§ä¸‹é¢çš„é“¾æ¥</p>
<ul>
<li><a class="link" href="https://en.wikipedia.org/wiki/Observer_pattern"  target="_blank" rel="noopener"
    >wikipediaï¼šObserver pattern</a></li>
<li><a class="link" href="https://baike.baidu.com/item/%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F/5881786"  target="_blank" rel="noopener"
    >ç™¾åº¦ç™¾ç§‘ï¼šè§‚å¯Ÿè€…æ¨¡å¼</a></li>
<li><a class="link" href="http://c.biancheng.net/view/1390.html"  target="_blank" rel="noopener"
    >è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆObserveræ¨¡å¼ï¼‰è¯¦è§£</a></li>
<li><a class="link" href="https://refactoringguru.cn/design-patterns/observer"  target="_blank" rel="noopener"
    >è§‚å¯Ÿè€…æ¨¡å¼</a></li>
<li><a class="link" href="https://www.runoob.com/design-pattern/observer-pattern.html"  target="_blank" rel="noopener"
    >èœé¸Ÿæ•™ç¨‹ï¼šè§‚å¯Ÿè€…æ¨¡å¼</a></li>
<li><a class="link" href="https://juejin.cn/post/6844903471586476039"  target="_blank" rel="noopener"
    >è§‚å¯Ÿè€…æ¨¡å¼çš„pythonç®€å•å®ç°</a></li>
</ul>
<h3 id="signalç®€è¿°">Signalç®€è¿°</h3>
<p>å¯ä»¥å…ˆçœ‹çœ‹Djangoçš„å®˜æ–¹æ–‡æ¡£</p>
<ul>
<li><a class="link" href="https://docs.djangoproject.com/zh-hans/3.0/topics/signals/"  target="_blank" rel="noopener"
    >https://docs.djangoproject.com/zh-hans/3.0/topics/signals/</a></li>
<li><a class="link" href="https://docs.djangoproject.com/zh-hans/3.0/ref/signals/"  target="_blank" rel="noopener"
    >https://docs.djangoproject.com/zh-hans/3.0/ref/signals/</a></li>
</ul>
<p>ä¸è§‚å¯Ÿè€…æ¨¡å¼å¯¹åº”ï¼šsenderå°±æ˜¯è¢«è§‚å¯Ÿè€…ã€receiveræ˜¯è§‚å¯Ÿè€…ã€‚æœ‰æ‰€ä¸åŒçš„å°±æ˜¯å¤šäº†ä¸ªsignalï¼Œä¹Ÿå°±æ˜¯â€œä¿¡å·â€ï¼ˆä¹Ÿå¯ä½¿è¯´æ˜¯ä¿¡å·çš„â€œç®¡ç†è€…â€ï¼‰ã€‚åœ¨æ™®é€šè§‚å¯Ÿè€…æ¨¡å¼ä¸­ï¼Œè¢«è§‚å¯Ÿå¯¹è±¡æŠ½è±¡ç±»ä¸­ä¸€èˆ¬ä¼šç»´æŠ¤ä¸€ä¸ªè§‚å¯Ÿè€…æŠ½è±¡ç±»çš„å¼•ç”¨åˆ—è¡¨ï¼Œä»¥æ­¤æ¥ä¼ é€’æ¶ˆæ¯ï¼Œè€Œdjangoä¸­åˆ™æ˜¯å€ŸåŠ©Signalç±»è¿›ä¸€æ­¥è§£è€¦ï¼Œé€šè¿‡Signalç±»è¿›è¡Œâ€œä¿¡å·ä¼ é€’â€ï¼Œå…·ä½“è§£æå¦‚ä¸‹ï¼š</p>
<h4 id="1-signal">1. signal</h4>
<p>ä¿¡å·ç±»ï¼Œç»´æŠ¤ä¸€ä¸ªreceiversåˆ—è¡¨ï¼Œç”¨äºå­˜å‚¨senderå’Œreceiverçš„å¯¹åº”è®°å½•</p>
<p><code>signal.connect()</code>ç”¨äºå¾€<code>signal.receivers</code>ä¸­æ·»åŠ å¯¹åº”çš„receiverå’Œsenderè®°å½•</p>
<p><code>signal_send()</code>ï¼Œåœ¨<code>signal.receivers</code>ä¸­æŸ¥æ‰¾senderå¯¹åº”çš„receiverså¹¶å°†å¯¹åº”ä¿¡å·(å‚æ•°)ä¼ é€’ç»™å¯¹åº”çš„receivers</p>
<p>djangoé¢„ç½®äº†ä¸€äº›ä¿¡å·å¯¹è±¡ï¼Œpre_initã€post_initã€pre_saveã€post_saveç­‰ï¼Œè¿™äº›éƒ½æ˜¯ç›´æ¥æˆ–é—´æ¥çš„ç»§æ‰¿è‡ªSiganlç±»ï¼Œå•ä¸€èŒè´£åŸåˆ™ï¼Œæ¯ä¸ªå…·ä½“çš„ä¿¡å·å¯¹è±¡åªè´Ÿè´£å­˜å‚¨â€œä¸€ç±»ä¿¡å·â€ï¼Œæ¯”å¦‚å‰é¢åˆ—ä¸¾çš„å››ä¸ªä¿¡å·å¯¹è±¡éƒ½æ˜¯django modelç›¸å…³çš„ã€‚ä»¥pre_saveä¸ºä¾‹ï¼Œåªæœ‰åœ¨è°ƒç”¨æŸä¸ªmodelå¯¹è±¡çš„saveæ–¹æ³•æ—¶ï¼ˆå‰ï¼‰æ‰ä¼šè°ƒç”¨pre_save.send()å‘é€ç›¸å…³æ•°æ®ï¼ˆâ€œä¿¡å·â€ï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´pre_saveè¿™ä¸ªSignalå¯¹è±¡çš„receiversåˆ—è¡¨ä¸­å­˜å‚¨çš„senderéƒ½æ˜¯modelè€Œreceiveréƒ½æ˜¯æˆ‘ä»¬å¸Œæœ›åœ¨è¿›è¡Œmodel.save()å‰è°ƒç”¨çš„å‡½æ•°æ¥è¿›è¡Œçš„ä¸€äº›ç›¸å…³æ“ä½œã€‚</p>
<h4 id="2-sender">2. sender</h4>
<p>ä¿¡å·çš„å‘é€æ–¹ï¼Œå³è°ƒç”¨<code>signal.send()</code>æ–¹æ³•çš„ç±»ã€‚æ¯”å¦‚ï¼Œæ‰€æœ‰modelç±»çš„çˆ¶ç±»éƒ½æ˜¯BaseModelï¼Œè€ŒBaseModelæœ‰ä¸€ä¸ª__init__å‡½æ•°åœ¨è¯¥å‡½æ•°ä¸­ï¼Œé¦–å…ˆå°±ä¼šè°ƒç”¨<code>pre_init.send(self.__class__,**kwargs)</code>å‘é€å³å°†å¼€å§‹initçš„ä¿¡å·ï¼Œç„¶åå†è¿›è¡Œå…·ä½“çš„initæ“ä½œï¼Œåœ¨initä¹‹åå†è°ƒç”¨<code>post_init.send</code>å‘é€initå®Œæˆçš„ä¿¡å·ã€‚æ•…è¿™é‡Œçš„BaseModelç±»å°±æ˜¯è¿™ä¸¤ä¸ªä¿¡å·å¯¹è±¡(pre_initã€post_init)çš„senderã€‚è€Œæˆ‘ä»¬çš„modelç±»éƒ½æ˜¯ç»§æ‰¿è‡ªBaseModelï¼Œinitæ–¹æ³•ä¹Ÿæ˜¯ç»§æ‰¿æ¥çš„ï¼Œæ•…æ­¤æ—¶çš„senderå°±æ˜¯æˆ‘ä»¬å®šä¹‰çš„modelç±»ã€‚</p>
<h4 id="3-receiver">3. receiver</h4>
<p>ä¿¡å·çš„æ¥æ”¶æ–¹ï¼Œä¸ºå¯è°ƒç”¨å¯¹è±¡ï¼Œä¸€èˆ¬æ˜¯ä¸ªå‡½æ•°ï¼Œæ¥æ”¶signal.send()ä¼ é€’è¿‡æ¥çš„å‚æ•°ï¼Œå†è¿›è¡Œç›¸å…³çš„æ“ä½œ</p>
<p>å‡å¦‚æˆ‘ä»¬æœ‰ä¸ªmodelå¯¹è±¡ä¸ºPeopleï¼Œæˆ‘ä»¬æƒ³è¦åœ¨æ„é€ æ¯ä¸€ä¸ªPeopleæ—¶ï¼ˆ<code>new_peopleÂ = People(name=&quot;haha&quot;,email=&quot;haha@mail.com&quot;)</code>ï¼‰æ‰“å°å‡ºå…¶ç›¸å…³ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªå‡½æ•°æ‰“å°å…¶ä¿¡æ¯ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">print_info</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&#34;args: {args}</span><span class="se">\n</span><span class="s2">kwargs: {kwargs}&#34;</span><span class="p">)</span>
</code></pre></div><p>ç„¶åä½¿ç”¨<code>pre_init.connect(print_info, sender=People)</code>å°†å…¶ä¸senderç»‘å®šèµ·æ¥,å³åœ¨pre_initçš„receiversåˆ—è¡¨ä¸­å­˜ä¸€æ¡å¯¹åº”çš„è®°å½•:</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="p">((</span><span class="n">People_id</span><span class="p">,</span><span class="n">print_info_id</span><span class="p">),</span><span class="n">print_info_weakref</span><span class="p">)</span>
</code></pre></div><p>æ­¤å¤„çš„<code>print_info</code>å‡½æ•°å³ä¸ºä¸€ä¸ªreceiverï¼Œpre_initä¿¡å·ä¸­Peopleç±»å¯¹åº”çš„receiverã€‚</p>
<p>å½“ç„¶ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨è£…é¥°å™¨ï¼Œä¸è¿‡ä¹Ÿæ˜¯åŒæ ·çš„é“ç†</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="nd">@receiver</span><span class="p">(</span><span class="n">pre_init</span><span class="p">,</span><span class="n">sender</span><span class="o">=</span><span class="n">People</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">print_info_before_init</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&#34;args: {args}</span><span class="se">\n</span><span class="s2">kwargs: {kwargs}&#34;</span><span class="p">)</span>
</code></pre></div><p>æœ€ç»ˆæ‰“å°å‡ºæ¥çš„ç»“æœæ˜¯</p>
<pre><code>args: []
kwargs: {'name':'haha','email':'haha.mail.com'}
</code></pre><h3 id="åŸç†ç®€æ">åŸç†ç®€æ</h3>
<p>djangoçš„æ•´ä¸ªä¿¡å·æ¨¡å—éƒ½æ˜¯ä¾èµ–Signalè¿™ä¸ªç±»å®Œæˆçš„</p>
<p><figure style="flex-grow: 65; flex-basis: 157px">
		<a href="/p/django-signal-principle-analysis/signal.png" data-size="373x569"><img src="/p/django-signal-principle-analysis/signal.png"
				srcset="/p/django-signal-principle-analysis/signal_hu0d4340ace52137d0792da51c154fc30e_53377_480x0_resize_box_2.png 480w, /p/django-signal-principle-analysis/signal_hu0d4340ace52137d0792da51c154fc30e_53377_1024x0_resize_box_2.png 1024w"
				width="373"
				height="569"
				loading="lazy"
				alt="Signal Class Diagram"
				referrer="no-referrer|origin|unsafe-url">
		</a>
		
		<figcaption>Signal Class Diagram</figcaption>
		
	</figure>
<figure style="flex-grow: 177; flex-basis: 426px">
		<a href="/p/django-signal-principle-analysis/signal_detail.png" data-size="956x538"><img src="/p/django-signal-principle-analysis/signal_detail.png"
				srcset="/p/django-signal-principle-analysis/signal_detail_huba212b28afdc2707efba4351cf327446_99360_480x0_resize_box_2.png 480w, /p/django-signal-principle-analysis/signal_detail_huba212b28afdc2707efba4351cf327446_99360_1024x0_resize_box_2.png 1024w"
				width="956"
				height="538"
				loading="lazy"
				alt="Signal Class Diagram Detail"
				referrer="no-referrer|origin|unsafe-url">
		</a>
		
		<figcaption>Signal Class Diagram Detail</figcaption>
		
	</figure></p>
<h4 id="1-signalçš„å±æ€§å’Œ__init__æ–¹æ³•">1. Signalçš„å±æ€§å’Œ__init__æ–¹æ³•</h4>
<p>1.receiversï¼šä¸€ä¸ªåˆ—è¡¨ç”¨äºå­˜å–è¯¥Signalä¸­å¯¹åº”çš„senderå’Œreceiverå¹¶å­˜ä¸‹receiverçš„å¼•ç”¨(æˆ–å¼±å¼•ç”¨)ï¼Œåœ¨è°ƒç”¨connect()æ–¹æ³•æ—¶ä¼šå¾€receiversä¸­æ·»åŠ å¯¹åº”å…³ç³»ï¼Œè€Œåœ¨è°ƒç”¨send()æ–¹æ³•æ—¶ä¼šåœ¨å…¶ä¸­æŸ¥æ‰¾å¯¹åº”å…³ç³»</p>
<p>æ•°æ®ç»“æ„ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># å¦‚æœåœ¨è°ƒç”¨connectæ–¹æ³•æ·»åŠ æ—¶weakå‚æ•°ä¸ºTrueï¼ˆé»˜è®¤ä¸ºTrueï¼‰</span>
<span class="c1"># åˆ™å­˜å‚¨receiverçš„å¼±å¼•ç”¨ï¼Œåœ¨åƒåœ¾å›æ”¶æ—¶ä¼šè‡ªåŠ¨å¤„ç†</span>
<span class="p">[((</span><span class="n">receiver_id</span><span class="p">,</span><span class="n">sender_id</span><span class="p">),</span><span class="n">receiver_weakref</span><span class="p">),]</span>  <span class="c1"># å¼±å¼•ç”¨</span>

<span class="c1"># å¦‚æœconnectæ–¹æ³•çš„weakå‚æ•°ä¸ºFalse</span>
<span class="c1"># åˆ™å­˜å‚¨receiverçš„å¼ºå¼•ç”¨ï¼Œæœ€ç»ˆéœ€è¦è°ƒç”¨disconnecté”€æ¯è®°å½•</span>
<span class="c1"># å¦åˆ™ç›¸å…³å˜é‡æ— æ³•è¢«åƒåœ¾å›æ”¶ï¼Œä¹Ÿå°±æ˜¯â€å†…å­˜æ³„éœ²â€œ</span>
<span class="p">[((</span><span class="n">receiver_id</span><span class="p">,</span><span class="n">sender_id</span><span class="p">),</span><span class="n">receiver</span><span class="p">),]</span>  <span class="c1"># å¼ºå¼•ç”¨</span>
</code></pre></div><p>2.providing_argsï¼šè¯¥signalæ¥å—çš„å‚æ•°çš„åˆ—è¡¨</p>
<p>3.lockï¼šthreading.lockï¼Œå¯¹ç›¸åº”æ“ä½œåŠ é”ä»¥ä¿è¯å®‰å…¨</p>
<p>4.use_cachingï¼šboolç±»å‹ï¼Œæ ‡è¯†æ˜¯å¦ä½¿ç”¨ç¼“å­˜ï¼Œå¦‚æœä½¿ç”¨ç¼“å­˜æˆ‘ä»¬ä¼šç¼“å­˜æ¯ä¸€ä¸ªsenderç±»çš„receiverså¹¶å­˜å‚¨åˆ°self.sender_receivers_cacheä¸­</p>
<p>5.sender_receivers_cacheï¼šsignalå¯¹æ¯ä¸€ä¸ªsenderçš„receiversè¿›è¡Œç¼“å­˜</p>
<p>æ•°æ®ç»“æ„ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
    <span class="nt">&#34;sender1&#34;</span><span class="p">:</span> <span class="p">[</span><span class="err">receiver</span><span class="mi">1</span><span class="err">_weakref</span><span class="p">,</span> <span class="err">receiver</span><span class="mi">2</span><span class="err">_weakref</span><span class="p">,</span><span class="err">...</span><span class="p">],</span>
    <span class="nt">&#34;sender2&#34;</span><span class="p">:</span> <span class="p">[</span><span class="err">receiver</span><span class="mi">3</span><span class="err">_weakref</span><span class="p">,</span> <span class="err">receiver</span><span class="mi">4</span><span class="err">_weakref</span><span class="p">,</span><span class="err">...</span><span class="p">],</span>
<span class="p">}</span>
</code></pre></div><p>æ¯æ¬¡sendæ—¶ä¼šä½¿ç”¨sender_receivers_cacheå¿«é€Ÿåˆ¤æ–­è¯¥senderæ˜¯å¦æœ‰receiverï¼Œå¦‚æœæœ‰åˆ™å†è°ƒç”¨_live_receiversè·å–å…¶å¯¹åº”çš„receiversçš„å¼ºåº”ç”¨åˆ—è¡¨</p>
<p>6._dead_receiversï¼šboolç±»å‹ï¼Œç”¨äºæ ‡è¯†self.reiversä¸­æ˜¯å¦å«æœ‰å¤±æ•ˆçš„ receiverçš„å¼±å¼•ç”¨ã€‚å½“å¼±å¼•ç”¨æŒ‡å‘çš„receiverè¢«åƒåœ¾å›æ”¶æ—¶ä¼šè°ƒç”¨Signal._remove_receiveræ–¹æ³•å°†_dead_receiversç½®ä¸ºTrue</p>
<h4 id="2-signalä¸­çš„æ–¹æ³•">2. Signalä¸­çš„æ–¹æ³•</h4>
<p>è¯´åœ¨å‰é¢ï¼šreceiverå’Œsenderéƒ½å¿…é¡»æ˜¯<a class="link" href="https://stackoverflow.com/questions/14535730/what-does-hashable-mean-in-python"  target="_blank" rel="noopener"
    >å¯å“ˆå¸Œçš„</a></p>
<p>1.connectï¼šå°†receiverå’Œsenderé€šè¿‡å¯¹åº”çš„Signalè¿æ¥èµ·æ¥ï¼ˆå³å°†å¯¹åº”è®°å½•æ·»åŠ åˆ°å¯¹åº”Signalå¯¹è±¡çš„receiverså±æ€§åˆ—è¡¨ä¸­ï¼‰</p>
<p>å‚æ•°è§£æï¼š</p>
<ul>
<li>receiverï¼šéœ€è¦æ¥æ”¶ä¿¡å·çš„receiver</li>
<li>senderï¼šå‘é€è¯¥ä¿¡å·çš„sender</li>
<li>weakï¼šæ˜¯å¦ä½¿ç”¨å¼±å¼•ç”¨ï¼Œé»˜è®¤ä¸ºTrueã€‚å¦‚æœä¸ºTrueåˆ™å­˜å‚¨receiverå¯¹åº”çš„weakrefå¦åˆ™ç›´æ¥å­˜å‚¨å¼ºå¼•ç”¨ã€‚ç”±äºè®¾ç½®äº†<code>weakref.finalize(receiver_object, self._remove_receiver)</code>è‹¥å­˜å‚¨å¼±å¼•ç”¨åˆ™å¯ä»¥åœ¨receiveråƒåœ¾å›æ”¶æ—¶è‡ªåŠ¨æ¸…é™¤Signal.receiversä¸­å¯¹åº”çš„è®°å½•ï¼ˆè§ä¸‹é¢çš„åˆ†æï¼‰è‹¥å­˜å‚¨å¼ºå¼•ç”¨åˆ™éœ€è¦å…ˆæ‰‹åŠ¨è°ƒç”¨disconnectæ–¹æ³•åˆ é™¤Signal.receiversä¸­å¯¹åº”çš„è®°å½•å¦åˆ™è¯¥receiverå°†æ— æ³•è¢«åƒåœ¾å›æ”¶å¯¼è‡´â€œå†…å­˜æ³„æ¼â€</li>
<li>dispatch_uidï¼šé»˜è®¤ä¸ºNoneï¼Œå¦‚æœä½¿ç”¨äº†è¯¥å€¼ï¼ˆä¸€èˆ¬ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²ï¼‰ï¼Œç›¸å½“äºä¸ºè¯¥receiverè‡ªå®šä¹‰ä¸ªå”¯ä¸€åç§°ï¼ˆä¸å…è®¸é‡å¤ï¼‰ï¼Œå­˜å‚¨æ—¶å°†ä¼šä½¿ç”¨<code>dispatch_uid</code>ä»£æ›¿<code>id(sender)</code></li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">receiver</span><span class="p">,</span> <span class="n">sender</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">weak</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">dispatch_uid</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">dispatch_uid</span><span class="p">:</span>
        <span class="n">lookup_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">dispatch_uid</span><span class="p">,</span> <span class="n">_make_id</span><span class="p">(</span><span class="n">sender</span><span class="p">))</span>  <span class="c1"># å¦‚æœè®¾ç½®äº†dispatch_uidåˆ™ä½¿ç”¨å…¶æœŸå¾…idå€¼ä½œä¸ºå”¯ä¸€æ ‡è¯†</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">lookup_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">_make_id</span><span class="p">(</span><span class="n">receiver</span><span class="p">),</span> <span class="n">_make_id</span><span class="p">(</span><span class="n">sender</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">weak</span><span class="p">:</span>  <span class="c1"># å¦‚æœä½¿ç”¨å¼±å¼•ç”¨</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ref</span>
        <span class="n">receiver_object</span> <span class="o">=</span> <span class="n">receiver</span>
        <span class="c1"># Check for bound methods</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">receiver</span><span class="p">,</span> <span class="s1">&#39;__self__&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">receiver</span><span class="p">,</span> <span class="s1">&#39;__func__&#39;</span><span class="p">):</span>
            <span class="c1"># å¦‚æœè¯¥receiveræ˜¯å¯¹è±¡æ–¹æ³•ï¼Œåˆ™receiver_objectä¸ºåŒ…å«è¯¥receiverçš„å¯¹è±¡</span>
            <span class="n">ref</span> <span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">WeakMethod</span>
            <span class="n">receiver_object</span> <span class="o">=</span> <span class="n">receiver</span><span class="o">.</span><span class="vm">__self__</span>
        <span class="n">receiver</span> <span class="o">=</span> <span class="n">ref</span><span class="p">(</span><span class="n">receiver</span><span class="p">)</span>  <span class="c1"># è·å–è¯¥receiverçš„å¼±å¼•ç”¨</span>
        <span class="n">weakref</span><span class="o">.</span><span class="n">finalize</span><span class="p">(</span><span class="n">receiver_object</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remove_receiver</span><span class="p">)</span>
        <span class="c1"># receiver_objectåƒåœ¾å›æ”¶æ—¶è°ƒç”¨self._remove_receiverå°†self._dead_receiversç½®ä¸ºTrue</span>
        <span class="c1"># åœ¨åé¢çš„sendæˆ–send_robustä¸­å¯¹self.receiversåŠ é”åæ¸…ç†</span>

    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_clear_dead_receivers</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">r_key</span> <span class="o">==</span> <span class="n">lookup_key</span> <span class="k">for</span> <span class="n">r_key</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">receivers</span><span class="p">):</span>  <span class="c1"># æ£€æŸ¥æ˜¯å¦æœ‰é‡å¤</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">receivers</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">lookup_key</span><span class="p">,</span> <span class="n">receiver</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sender_receivers_cache</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="c1"># æ¯æ¬¡connectæˆ–disconnectåéƒ½è¦æ¸…é™¤ç¼“å­˜</span>
        <span class="c1"># è¯¥ç¼“å­˜ä¼šåœ¨sendæ—¶æ„å»º</span>
</code></pre></div><p>â€‹</p>
<p>2.disconnectï¼šä»å¯¹åº”Signalå¯¹è±¡çš„receiversåˆ—è¡¨ä¸­åˆ é™¤å¯¹åº”è®°å½•ï¼ˆä¸€èˆ¬ç”¨äºæ‰‹åŠ¨åˆ é™¤åœ¨connectæ—¶ä½¿ç”¨weak=Falseçš„æƒ…å†µï¼Œå³è¯¥æ¡è®°å½•å­˜çš„æ˜¯receiverçš„å¼ºå¼•ç”¨ï¼Œè‹¥ä¸æ‰‹åŠ¨åˆ é™¤è¯¥æ¡è®°å½•ä¼šå¯¼è‡´â€œå†…å­˜æ³„æ¼â€ï¼Œä¸<a class="link" href="https://docs.python.org/zh-cn/3.8/library/gc.html"  target="_blank" rel="noopener"
    >gcçš„å¼•ç”¨è®¡æ•°</a>æœ‰å…³ï¼‰</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">receiver</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">sender</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">dispatch_uid</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="s2">&#34;&#34;&#34;
</span><span class="s2">    å°†signalä¸­çš„receiverä¸senderâ€œæ–­å¼€è¿æ¥â€
</span><span class="s2">    è¯¥å‡½æ•°ä¸»è¦é’ˆå¯¹é‚£äº›åœ¨connectæ—¶weakå‚æ•°ä¸ºFalseçš„æƒ…å†µï¼Œå³signalçš„receiversåˆ—è¡¨
</span><span class="s2">    ä¸­å­˜å‚¨çš„æ˜¯rceiverçš„å¼ºå¼•ç”¨
</span><span class="s2">    
</span><span class="s2">    å¦‚æœåœ¨connectæ—¶ä½¿ç”¨çš„å¼±å¼•ç”¨(weak=True), åˆ™ä¸éœ€è¦æ‰‹åŠ¨è°ƒç”¨disconnectæ–¹æ³•
</span><span class="s2">    receiverå’Œsenderçš„è®°å½•ä¼šè¢«è‡ªåŠ¨åˆ é™¤
</span><span class="s2">    &#34;&#34;&#34;</span>
    <span class="k">if</span> <span class="n">dispatch_uid</span><span class="p">:</span>
        <span class="n">lookup_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">dispatch_uid</span><span class="p">,</span> <span class="n">_make_id</span><span class="p">(</span><span class="n">sender</span><span class="p">))</span>  <span class="c1"># å¦‚æœæä¾›äº†dispatch_uidåˆ™ä½¿ç”¨å…¶æ›¿ä»£ id(receiver)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">lookup_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">_make_id</span><span class="p">(</span><span class="n">receiver</span><span class="p">),</span> <span class="n">_make_id</span><span class="p">(</span><span class="n">sender</span><span class="p">))</span>
    
    <span class="n">disconnected</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_clear_dead_receivers</span><span class="p">()</span>  <span class="c1"># å…ˆæ¸…é™¤dead_receivers</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">receivers</span><span class="p">)):</span>
            <span class="p">(</span><span class="n">r_key</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">receivers</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">r_key</span> <span class="o">==</span> <span class="n">lookup_key</span><span class="p">:</span>  <span class="c1"># æ ¹æ®lookup_keyåœ¨self.receiversä¸­æŸ¥æ‰¾</span>
                <span class="n">disconnected</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">receivers</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>  <span class="c1"># åˆ é™¤self.receiversä¸­çš„å¯¹åº”è®°å½•</span>
                <span class="k">break</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sender_receivers_cache</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>  <span class="c1"># å˜æ›´åæ¸…é™¤ç¼“å­˜</span>
    <span class="k">return</span> <span class="n">disconnected</span>
</code></pre></div><p>â€‹</p>
<p>3.has_listenersï¼šæ£€æŸ¥æŸä¸ªsenderæ˜¯å¦æœ‰receiver</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">has_listeners</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sender</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_live_receivers</span><span class="p">(</span><span class="n">sender</span><span class="p">))</span>
</code></pre></div><p>â€‹</p>
<p>4.sendï¼šç»™æŸä¸ªsenderå¯¹åº”çš„æ‰€æœ‰receiverså‘é€ç›¸åº”çš„ä¿¡å·ï¼Œé¦–å…ˆä¼šæ£€æŸ¥è¿™ä¸ªsenderæ˜¯å¦æœ‰receiversã€‚å¦‚æœæœ‰ï¼Œå…ˆè°ƒç”¨_live_receiversè·å–å½“å‰senderå¯¹åº”çš„æ‰€æœ‰çš„receiverçš„å¼ºå¼•ç”¨ï¼Œç„¶åä¾æ¬¡è°ƒç”¨æ¯ä¸ªreceiverä¼ å…¥ç›¸å…³çš„å‚æ•°ã€‚æœ€åï¼Œè¿”å›<code>[(receiver,response),]</code>ï¼ˆè¿™é‡Œçš„receiveræ˜¯å¼ºå¼•ç”¨å³å¯ç›´æ¥è°ƒç”¨çš„receiverå‡½æ•°ï¼Œresponseæ˜¯è°ƒç”¨receiverå‡½æ•°è¿”å›çš„ç»“æœï¼‰</p>
<p>å‚æ•°è§£æï¼š</p>
<ul>
<li>senderï¼šå‘é€ä¿¡å·çš„ç±»</li>
<li>**namedï¼šä¼ é€’ç»™è¯¥senderå¯¹åº”çš„receiversçš„å‚æ•°</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">send</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sender</span><span class="p">,</span> <span class="o">**</span><span class="n">named</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">receivers</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">sender_receivers_cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">sender</span><span class="p">)</span> <span class="ow">is</span> <span class="n">NO_RECEIVERS</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="k">return</span> <span class="p">[</span>
        <span class="p">(</span><span class="n">receiver</span><span class="p">,</span> <span class="n">receiver</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">sender</span><span class="o">=</span><span class="n">sender</span><span class="p">,</span> <span class="o">**</span><span class="n">named</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">receiver</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_live_receivers</span><span class="p">(</span><span class="n">sender</span><span class="p">)</span>  <span class="c1"># _live_receiversè¿”å›çš„æ˜¯è¯¥senderå¯¹åº”çš„æ‰€æœ‰çš„receiversçš„å¼ºå¼•ç”¨</span>
    <span class="p">]</span>
</code></pre></div><p><strong>æ³¨ï¼š</strong> å½“è°ƒç”¨æŸä¸ªreceiverå‘ç”Ÿå¼‚å¸¸æ—¶ç¨‹åºä¼šç›´æ¥é€€å‡ºï¼Œå¯èƒ½å¯¼è‡´å…¶ä»–å‰©ä¸‹çš„receiverå¹¶æ²¡æœ‰è¢«è°ƒç”¨æ‰§è¡Œ</p>
<p>â€‹</p>
<p>5.send_robustï¼šâ€œå¥å£®ç‰ˆâ€çš„sendï¼Œå½“è°ƒç”¨æŸä¸ªreceiverå‘ç”Ÿå¼‚å¸¸æ—¶ä¼šå°†å¼‚å¸¸æ•æ‰å¹¶å­˜å‚¨èµ·æ¥ï¼Œæ•…è¯¥senderçš„æ‰€æœ‰çš„receiveréƒ½èƒ½è¢«è°ƒç”¨æ‰§è¡Œã€‚è¯¥å‡½æ•°ä¼šè¿”å›<code>[(receiver,response / err),]</code></p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">send_robust</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sender</span><span class="p">,</span> <span class="o">**</span><span class="n">named</span><span class="p">):</span>
    <span class="c1"># ç›¸æ¯”sendæ–¹æ³•è°ƒç”¨receiveræ–¹æ³•å¼‚å¸¸æ—¶ç›´æ¥é€€å‡ºï¼Œsend_robustä¼šæ”¶é›†å¼‚å¸¸å¹¶è¿”å›</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">receivers</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">sender_receivers_cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">sender</span><span class="p">)</span> <span class="ow">is</span> <span class="n">NO_RECEIVERS</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="c1"># Call each receiver with whatever arguments it can accept.</span>
    <span class="c1"># Return a list of tuple pairs [(receiver, response), ... ].</span>
    <span class="n">responses</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">receiver</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_live_receivers</span><span class="p">(</span><span class="n">sender</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">receiver</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">sender</span><span class="o">=</span><span class="n">sender</span><span class="p">,</span> <span class="o">**</span><span class="n">named</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="n">responses</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">receiver</span><span class="p">,</span> <span class="n">err</span><span class="p">))</span>  
            <span class="c1"># å¦‚æœè°ƒç”¨receiverå‡ºç°å¼‚å¸¸åˆ™æ•è·å¹¶è¿”å›ç›¸åº”çš„å¼‚å¸¸è€Œä¸å½±å“å…¶ä»–receiverçš„è°ƒç”¨</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">responses</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">receiver</span><span class="p">,</span> <span class="n">response</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">responses</span>
</code></pre></div><p>â€‹</p>
<p>6._clean_dead_receiversï¼šæ¸…é™¤Signal.receiversä¸­çš„dead receiverï¼Œè¯¥å‡½æ•°ä¼šåœ¨sendæˆ–send_robustä¸­å¯¹Signal.receiversåŠ é”äº†çš„æƒ…å†µä¸‹è°ƒç”¨</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">_clear_dead_receivers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c1"># Note: caller is assumed to hold self.lock.</span>
    <span class="c1"># æ¸…é™¤dead_receivers</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dead_receivers</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dead_receivers</span> <span class="o">=</span> <span class="bp">False</span>  <span class="c1"># è¿˜åŸ_dead_receiversä¸ºFalse</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">receivers</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">receivers</span>
            <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ReferenceType</span><span class="p">)</span> <span class="ow">and</span> <span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">]()</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)</span>
            <span class="c1"># å¼±å¼•ç”¨ï¼Œå¹¶ä¸”è¯¥å¼±å¼•ç”¨å¯¹åº”çš„å¯¹è±¡å·²æ¶ˆäº¡</span>
        <span class="p">]</span>
</code></pre></div><p>â€‹</p>
<p><strong>æ³¨ï¼š</strong> å…¶å®è¿™é‡Œè¯´çš„æ¸…é™¤dead receiverï¼Œå°±æ˜¯åˆ é™¤Signal.receiversä¸­é‚£äº›åŸå‡½æ•°/å¯¹è±¡ï¼ˆå³receiverå‡½æ•°æˆ–åŒ…å«receievrå‡½æ•°çš„å¯¹è±¡ï¼‰å·²ç»è¢«åƒåœ¾å›æ”¶äº†çš„weakrefï¼Œè‡³äºé‚£äº›åœ¨connectæ—¶ä½¿ç”¨weak=Falseæ·»åŠ çš„å¼ºå¼•ç”¨åˆ™éœ€è¦æ‰‹åŠ¨è°ƒç”¨disconnectè¿›è¡Œæ‰‹åŠ¨æ¸…é™¤ï¼Œå¦åˆ™å¯èƒ½ä¼šå¯¼è‡´å†…å­˜æ³„éœ²</p>
<p>7._live_receiversï¼šå…ˆé€šè¿‡self._dead_receiversæ£€æŸ¥æ˜¯å¦æœ‰dead receiverså¦‚æœæœ‰åˆ™å…ˆè¿‡æ»¤ä¸€éSignal.receiversï¼Œç„¶åä»Signal.receiversä¸­æ‰¾å‡ºè¯¥senderå¯¹åº”æ‰€æœ‰çš„receiverï¼Œå¹¶è¿”å›åŒ…å«æ‰€æœ‰receiverå¼ºå¼•ç”¨çš„åˆ—è¡¨</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">_live_receivers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sender</span><span class="p">):</span>
    <span class="s2">&#34;&#34;&#34;
</span><span class="s2">    Filter sequence of receivers to get resolved, live receivers.
</span><span class="s2">
</span><span class="s2">    This checks for weak references and resolves them, then returning only
</span><span class="s2">    live receivers.
</span><span class="s2">    &#34;&#34;&#34;</span>
    <span class="n">receivers</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_caching</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dead_receivers</span><span class="p">:</span>  <span class="c1"># å¦‚æœä½¿ç”¨ç¼“å­˜å¹¶ä¸”self.receiversä¸­æ— dead_receivers</span>
        <span class="n">receivers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sender_receivers_cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">sender</span><span class="p">)</span>  <span class="c1"># ç›´æ¥ä»ç¼“å­˜ä¸­è·å–</span>
        <span class="c1"># We could end up here with NO_RECEIVERS even if we do check this case in</span>
        <span class="c1"># .send() prior to calling _live_receivers() due to concurrent .send() call.</span>
        <span class="c1"># å…¶å®æˆ‘ä»¬åœ¨è°ƒç”¨_live_receiversæ–¹æ³•çš„sendæ–¹æ³•ä¸­å·²ç»æ£€æŸ¥è¿‡ä¸€æ¬¡äº†</span>
        <span class="k">if</span> <span class="n">receivers</span> <span class="ow">is</span> <span class="n">NO_RECEIVERS</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">receivers</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>  <span class="c1"># å¦‚æœä¸ä½¿ç”¨ç¼“å­˜æˆ–è€…å­˜åœ¨å¾…æ¸…ç†çš„dead receivers</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_clear_dead_receivers</span><span class="p">()</span>  <span class="c1"># å…ˆæ¸…ç†dead_receivers</span>
            <span class="n">senderkey</span> <span class="o">=</span> <span class="n">_make_id</span><span class="p">(</span><span class="n">sender</span><span class="p">)</span>
            <span class="n">receivers</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">receiverkey</span><span class="p">,</span> <span class="n">r_senderkey</span><span class="p">),</span> <span class="n">receiver</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">receivers</span><span class="p">:</span> <span class="c1"># éå†self.receiversè¿›è¡ŒæŸ¥æ‰¾åŒ¹é…</span>
                <span class="k">if</span> <span class="n">r_senderkey</span> <span class="o">==</span> <span class="n">NONE_ID</span> <span class="ow">or</span> <span class="n">r_senderkey</span> <span class="o">==</span> <span class="n">senderkey</span><span class="p">:</span>  <span class="c1"># å¦‚æœsenderkeyä¸ºid(None)æˆ–åŒ¹é…</span>
                    <span class="n">receivers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">receiver</span><span class="p">)</span>  <span class="c1"># å°†receiver(weakref)æ·»åŠ åˆ°receiversä¸­</span>
            <span class="c1"># æ›´æ–°ç¼“å­˜</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_caching</span><span class="p">:</span>  <span class="c1"># å¦‚æœä½¿ç”¨ç¼“å­˜</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">receivers</span><span class="p">:</span>  <span class="c1"># å¦‚æœè¯¥senderæ²¡æœ‰receiver (receiversä¸ºç©º)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sender_receivers_cache</span><span class="p">[</span><span class="n">sender</span><span class="p">]</span> <span class="o">=</span> <span class="n">NO_RECEIVERS</span>  <span class="c1"># å°†cacheä¸­è¯¥senderçš„receiversç½®ä¸ºç©º</span>
                <span class="k">else</span><span class="p">:</span>  <span class="c1"># å¦‚æœè¯¥senderå­˜åœ¨å¯¹åº”çš„receiver</span>
                    <span class="c1"># Note, we must cache the weakref versions.</span>
                    <span class="c1"># æ³¨æ„æˆ‘ä»¬åº”è¯¥ç¼“å­˜å¼±å¼•ç”¨</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sender_receivers_cache</span><span class="p">[</span><span class="n">sender</span><span class="p">]</span> <span class="o">=</span> <span class="n">receivers</span>  <span class="c1"># å°†è¯¥senderåŠå…¶æ‰€æœ‰çš„receiversç¼“å­˜èµ·æ¥</span>
    <span class="n">non_weak_receivers</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">receiver</span> <span class="ow">in</span> <span class="n">receivers</span><span class="p">:</span>  <span class="c1"># receiversè¦ä¹ˆä¸º[] è¦ä¹ˆä¸º[receiver]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">receiver</span><span class="p">,</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ReferenceType</span><span class="p">):</span>
            <span class="c1"># Dereference the weak reference.</span>
            <span class="c1"># https://www.kite.com/python/docs/weakref.ReferenceType</span>
            <span class="n">receiver</span> <span class="o">=</span> <span class="n">receiver</span><span class="p">()</span>  <span class="c1"># è·å–å¼±å¼•ç”¨æ‰€æŒ‡çš„å®é™…å¯¹è±¡ï¼Œè‹¥å·²æ¶ˆäº¡åˆ™è¿”å›Noneï¼Œå¦åˆ™è¿”å›å¯¹è±¡çš„å¼ºå¼•ç”¨(â€œå¯ç›´æ¥è°ƒç”¨â€)</span>
            <span class="k">if</span> <span class="n">receiver</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>  <span class="c1"># weakrefæ‰€æŒ‡çš„åŸå¯¹è±¡å°šæœªæ¶ˆäº¡</span>
                <span class="n">non_weak_receivers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">receiver</span><span class="p">)</span>  <span class="c1"># æ·»åŠ å®é™…å¯è°ƒç”¨çš„receiverå¯¹è±¡</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">non_weak_receivers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">receiver</span><span class="p">)</span>  <span class="c1"># ä¸æ˜¯å¼±å¼•ç”¨åˆ™ç›´æ¥æ·»åŠ </span>
    <span class="k">return</span> <span class="n">non_weak_receivers</span>  <span class="c1"># å¯è°ƒç”¨å¯¹è±¡receiverçš„åˆ—è¡¨</span>
</code></pre></div><p>8._remove_receiversï¼šå°†Signal._dead_receiversç½®ä¸ºTrueï¼Œåœ¨åé¢è°ƒç”¨sendæˆ–send_robustæ–¹æ³•æ—¶ä¼šå…ˆæ£€æŸ¥_dead_receiversï¼Œå¦‚æœä¸ºTrueåˆ™å…ˆè°ƒç”¨_clean_dead_receiversè¿›è¡Œæ¸…ç†</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">_remove_receiver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">receiver</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="c1"># Mark that the self.receivers list has dead weakrefs. If so, we will</span>
    <span class="c1"># clean those up in connect, disconnect and _live_receivers while</span>
    <span class="c1"># holding self.lock. Note that doing the cleanup here isn&#39;t a good</span>
    <span class="c1"># idea, _remove_receiver() will be called as side effect of garbage</span>
    <span class="c1"># collection, and so the call can happen while we are already holding</span>
    <span class="c1"># self.lock.</span>
    <span class="c1"># æ ‡è®°self.receiversä¸­æœ‰dead weakrefs(weakrefæ‰€æŒ‡å¯¹è±¡å·²æ¶ˆäº¡).å¦‚æœå­˜åœ¨dead receiver</span>
    <span class="c1"># ç¨‹åºä¼šåœ¨è°ƒç”¨connect, disconnectå’Œ_live_receiversæ—¶åœ¨åŠ é”çš„æƒ…å†µä¸‹æ¸…é™¤dead weakrefs</span>
    <span class="c1"># æ³¨æ„åœ¨è¿™é‡Œæ‰§è¡Œå…·ä½“çš„æ¸…é™¤æ“ä½œå¹¶ä¸æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ï¼Œåœ¨åƒåœ¾å›æ”¶æ—¶_remove_receiver()ä¼šè¢«</span>
    <span class="c1"># è‡ªåŠ¨è§¦å‘ï¼Œè€Œæˆ‘ä»¬å¯èƒ½åœ¨å…¶ä»–æ“ä½œä¸­å¯¹receiversåŠ äº†é”ï¼Œæ­¤æ—¶æ¸…ç†receiverså°†ä¼šå¯¼è‡´å†²çª</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_dead_receivers</span> <span class="o">=</span> <span class="bp">True</span>
</code></pre></div><p><strong>æ³¨ï¼š</strong> ç”±äºåœ¨connectæ–¹æ³•ä¸­çš„è®¾ç½®äº†<code>weakref.finalize(receiver_object, self._remove_receiver)</code>ï¼Œåœ¨receiver_objectåƒåœ¾å›æ”¶æ—¶ä¼šè‡ªåŠ¨è§¦å‘_remove_receiveræ–¹æ³•ã€‚å¦‚æœå°†æ¸…é™¤è¿‡æ»¤Signal.receiversçš„è¿‡ç¨‹æ”¾åœ¨è¿™ä¸ªå‡½æ•°ä¸­ï¼Œè€Œå…¶å®ƒåœ°æ–¹å¯èƒ½æ­£åœ¨åœ¨åŠ é”çš„æƒ…å†µä¸‹ä½¿ç”¨receiversåˆ™ä¼šå¯¼è‡´å†²çªã€‚æ•…_remove_receiversåªå°†Signal._dead_receiversç½®ä¸ºTrueï¼Œä»è€ŒæŠŠæ¸…ç†dead receiverçš„è¿‡ç¨‹å»¶è¿Ÿåˆ°äº†connectã€disconnectã€sendã€send_robustä¸­åŠ é”è¿›è¡Œ</p>
<h4 id="3-å¤§æ¦‚æµç¨‹">3. å¤§æ¦‚æµç¨‹</h4>
<p>é€šè¿‡Signal.connectå‘Signal.receiversä¸­æ³¨å†Œå¯¹åº”çš„<code>((receiver_id, sender_id), receiver_weakref)</code>è®°å½•ï¼Œç„¶åsenderä¼šåœ¨æ°å½“çš„æ—¶å€™è°ƒç”¨æ°å½“çš„Signalå¹¶ä½¿ç”¨Signal.sendå‘é€æ°å½“çš„ä¿¡å·ç»™å¯¹åº”çš„æ‰€æœ‰receiverã€‚è¿™å°±æ˜¯ä¿¡å·çš„å¤§è‡´ä¼ é€’è¿‡ç¨‹</p>
<h4 id="4-å¾ˆå¥‡æ€ªçš„ä¸€ç‚¹">4. å¾ˆå¥‡æ€ªçš„ä¸€ç‚¹</h4>
<p>ç¨‹åºé‡Œé¢æœ‰ä¸ªå¥‡æ€ªçš„<code>None</code>ï¼Œåœ¨connectæ—¶ä¸æŒ‡å®šsenderåˆ™senderï¼Œé»˜è®¤senderå°±ä¼šæ˜¯Noneï¼Œè€Œåœ¨senderä¸­è°ƒç”¨Siganl.sendæ–¹æ³•è¯¥æ–¹æ³•åˆä¼šè°ƒç”¨Signal._live_receiversæ–¹æ³•ï¼Œåœ¨Signal._live_receiversä¸­ä¼šå¯»æ‰¾è¯¥senderå¯¹åº”çš„receiverï¼Œè€ŒåŒ¹é…æ¡ä»¶å±…ç„¶æ˜¯<code>if r_senderkey == NONE_ID or r_senderkey == senderkey</code>ï¼Œsenderä¸ºNoneçš„receiversä¹Ÿä¼šè¢«åŒ¹é…ï¼Ÿæœ‰ç‚¹ä¸å¤ªç†è§£è¿™é‡Œçš„åšæ³•</p>
<h4 id="5-å¤šè¯´ä¸€å¥">5. å¤šè¯´ä¸€å¥</h4>
<p>å¼‚æ­¥é—®é¢˜ï¼Œå½“ä¸€ä¸ªsenderæ³¨å†Œçš„receiverè¿‡å¤šæ—¶ï¼Œè°ƒç”¨sendæ–¹æ³•æ—¶å¯èƒ½ä¼šéå¸¸å ç”¨æ—¶é—´é€ æˆé˜»å¡ï¼Œè§‚å¯Ÿè€…æ¨¡å¼å¥½åƒéƒ½æœ‰è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨å¼‚æ­¥æ”¹å–„ï¼Ÿï¼ˆåœ¨ç½‘ä¸Šçœ‹åˆ°çš„ï¼Œå…·ä½“å¦‚ä½•æ”¹å–„æˆ‘è¿˜æ²¡ææ¸…æ¥šï¼Œç­‰å¼„æ˜ç™½äº†å†è¡¥ä¸Šâ€¦â€¦ï¼‰</p>
<h3 id="æºç ç®€æ">æºç ç®€æ</h3>
<p>æºç ï¼š</p>
<ul>
<li><a class="link" href="https://github.com/django/django/blob/main/django/dispatch/dispatcher.py"  target="_blank" rel="noopener"
    >Github</a></li>
<li><a class="link" href="https://docs.djangoproject.com/zh-hans/3.0/_modules/django/dispatch/dispatcher/#Signal.disconnect"  target="_blank" rel="noopener"
    >Django Docs</a></li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">import</span> <span class="nn">weakref</span>
<span class="kn">from</span> <span class="nn">django.utils.inspect</span> <span class="kn">import</span> <span class="n">func_accepts_kwargs</span>

<span class="c1"># è¿”å›å¯¹è±¡çš„id,åœ¨connectå­˜å‚¨è®°å½•å’ŒsendæŸ¥è¯¢è®°å½•æ—¶ä¼šç”¨åˆ°</span>
<span class="c1"># æ³¨æ„ï¼šsenderå’Œreceiveréƒ½å¿…é¡»æ˜¯å¯å“ˆå¸Œçš„</span>
<span class="k">def</span> <span class="nf">_make_id</span><span class="p">(</span><span class="n">target</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="s1">&#39;__func__&#39;</span><span class="p">):</span>  <span class="c1"># å¦‚æœæ˜¯å¯¹è±¡æ–¹æ³•</span>
        <span class="k">return</span> <span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="vm">__self__</span><span class="p">),</span> <span class="nb">id</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="vm">__func__</span><span class="p">))</span>
    <span class="k">return</span> <span class="nb">id</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>

<span class="c1"># django.utils.inspect.func_accepts_kwargs</span>
<span class="c1"># æ£€æŸ¥ä¼ å…¥çš„å‡½æ•°æ˜¯å¦æ¥å—**kwargså‚æ•°</span>
<span class="k">def</span> <span class="nf">func_accepts_kwargs</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">any</span><span class="p">(</span>
        <span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="n">func</span><span class="p">)</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="n">p</span><span class="o">.</span><span class="n">VAR_KEYWORD</span>
    <span class="p">)</span>

<span class="n">NONE_ID</span> <span class="o">=</span> <span class="n">_make_id</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>

<span class="c1"># A marker for caching</span>
<span class="n">NO_RECEIVERS</span> <span class="o">=</span> <span class="nb">object</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">Signal</span><span class="p">:</span>
    <span class="s2">&#34;&#34;&#34;
</span><span class="s2">    æ‰€æœ‰signalçš„åŸºç±»
</span><span class="s2">    Base class for all signals
</span><span class="s2">
</span><span class="s2">    Internal attributes:
</span><span class="s2">    
</span><span class="s2">        receivers
</span><span class="s2">            { receiverkey (id) : weakref(receiver) }
</span><span class="s2">    &#34;&#34;&#34;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">providing_args</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">use_caching</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="s2">&#34;&#34;&#34;
</span><span class="s2">        åˆ›å»ºæ–°çš„signal
</span><span class="s2">        providing_args: åœ¨è°ƒç”¨send()æ–¹æ³•æ—¶å¯ä»¥ä¼ å…¥è¿™ä¸ªsignalçš„å‚æ•°åˆ—è¡¨
</span><span class="s2">        &#34;&#34;&#34;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">receivers</span> <span class="o">=</span> <span class="p">[]</span>  
        <span class="c1"># ((receiver_id,sender_id),receiver_weakref)æˆ–è€…æ˜¯((dispatch_id,sender_id),receiverweak_ref)</span>
        <span class="c1"># å…·ä½“æ˜¯å¼ºå¼•ç”¨è¿˜æ˜¯weakrefå–å†³äºconnectæ—¶çš„weakå‚æ•°æ˜¯Trueè¿˜æ˜¯False</span>
        <span class="c1"># é»˜è®¤weakä¸ºTrueä½¿ç”¨å¼±å¼•ç”¨ï¼Œè‹¥ä¸ºFalseåˆ™åˆ é™¤è¯¥æ¡è®°å½•æ—¶éœ€è¦æ‰‹åŠ¨disconnect</span>

        <span class="k">if</span> <span class="n">providing_args</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">providing_args</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">providing_args</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">providing_args</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>  <span class="c1"># åŠ é”ä¿è¯æ“ä½œæ•°æ®æ—¶çº¿ç¨‹å®‰å…¨</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">use_caching</span> <span class="o">=</span> <span class="n">use_caching</span>  <span class="c1"># æ˜¯å¦ä½¿ç”¨ç¼“å­˜</span>
        <span class="c1"># ä¸ºäº†ä¾¿åˆ©å³ä½¿ä¸ä½¿ç”¨ç¼“å­˜æˆ‘ä»¬ä¹Ÿä¼šåˆ›å»ºç©ºçš„ç¼“å­˜</span>
        <span class="c1"># å…³äºç¼“å­˜éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼šå¦‚æœuse_cachingä¸ºTrueï¼Œå¯¹äºæ¯ä¸€ä¸ªsender</span>
        <span class="c1"># æˆ‘ä»¬ä¼šåœ¨sender_receiver_cacheä¸­ç¼“å­˜å…¶æ‰€æœ‰çš„receiverã€‚</span>
        <span class="c1"># è¯¥ç¼“å­˜åœ¨è°ƒç”¨.connect()æˆ–è€….disconnect()æ—¶ä¼šè¢«æ¸…é™¤ï¼Œè€Œåœ¨è°ƒç”¨sendæ—¶ä¼šè¢«å¡«å……</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sender_receivers_cache</span> <span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">WeakKeyDictionary</span><span class="p">()</span> <span class="k">if</span> <span class="n">use_caching</span> <span class="k">else</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_dead_receivers</span> <span class="o">=</span> <span class="bp">False</span>  
        <span class="c1"># receiverså±æ€§åˆ—è¡¨ä¸­æ˜¯å¦å«æœ‰â€œå¤±æ•ˆâ€çš„receiverå¼•ç”¨(å·²è¢«åƒåœ¾å›æ”¶)</span>
        <span class="c1"># åœ¨_clear_dead_receiversæ–¹æ³•ä¸­ä¼šæ£€æŸ¥å…¶å€¼ï¼Œå¦‚æœä¸ºTrueåˆ™ä»£è¡¨å…¶ä¸­</span>
        <span class="c1"># æœ‰å¤±æ•ˆçš„receiverå¼•ç”¨ï¼Œåˆ™è¿‡æ»¤æ¸…ç†ä¸€éreceiverså±æ€§åˆ—è¡¨</span>

    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">receiver</span><span class="p">,</span> <span class="n">sender</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">weak</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">dispatch_uid</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="s2">&#34;&#34;&#34;
</span><span class="s2">        # é€šè¿‡signalå°†receiverè¿æ¥åˆ°sender
</span><span class="s2">
</span><span class="s2">        Arguments:
</span><span class="s2">
</span><span class="s2">            receiver
</span><span class="s2">                A function or an instance method which is to receive signals.
</span><span class="s2">                Receivers must be hashable objects.
</span><span class="s2">
</span><span class="s2">                If weak is True, then receiver must be weak referenceable.
</span><span class="s2">
</span><span class="s2">                Receivers must be able to accept keyword arguments.
</span><span class="s2">
</span><span class="s2">                If a receiver is connected with a dispatch_uid argument, it
</span><span class="s2">                will not be added if another receiver was already connected
</span><span class="s2">                with that dispatch_uid.
</span><span class="s2">
</span><span class="s2">            sender
</span><span class="s2">                The sender to which the receiver should respond. Must either be
</span><span class="s2">                a Python object, or None to receive events from any sender.
</span><span class="s2">
</span><span class="s2">            weak
</span><span class="s2">                Whether to use weak references to the receiver. By default, the
</span><span class="s2">                module will attempt to use weak references to the receiver
</span><span class="s2">                objects. If this parameter is false, then strong references will
</span><span class="s2">                be used.
</span><span class="s2">
</span><span class="s2">            dispatch_uid
</span><span class="s2">                An identifier used to uniquely identify a particular instance of
</span><span class="s2">                a receiver. This will usually be a string, though it may be
</span><span class="s2">                anything hashable.
</span><span class="s2">        &#34;&#34;&#34;</span>
        <span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span>

        <span class="c1"># If DEBUG is on, check that we got a good receiver</span>
        <span class="c1"># å¦‚æœåœ¨DEBUGæ¨¡å¼ä¸‹ï¼Œåˆ™æ£€æŸ¥è¯¥receiveræ˜¯å¦æ»¡è¶³è¦æ±‚</span>
        <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">configured</span> <span class="ow">and</span> <span class="n">settings</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">callable</span><span class="p">(</span><span class="n">receiver</span><span class="p">),</span> <span class="s2">&#34;Signal receivers must be callable.&#34;</span>

            <span class="c1"># Check for **kwargs</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">func_accepts_kwargs</span><span class="p">(</span><span class="n">receiver</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&#34;Signal receivers must accept keyword arguments (**kwargs).&#34;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">dispatch_uid</span><span class="p">:</span>
            <span class="n">lookup_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">dispatch_uid</span><span class="p">,</span> <span class="n">_make_id</span><span class="p">(</span><span class="n">sender</span><span class="p">))</span>  <span class="c1"># å¦‚æœè®¾ç½®äº†dispatch_uidä½œä¸ºæŸreceiverçš„æ ‡è¯†</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lookup_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">_make_id</span><span class="p">(</span><span class="n">receiver</span><span class="p">),</span> <span class="n">_make_id</span><span class="p">(</span><span class="n">sender</span><span class="p">))</span>  <span class="c1"># æ²¡æœ‰dispatch_uidåˆ™ä½¿ç”¨receiverçš„id</span>

        <span class="k">if</span> <span class="n">weak</span><span class="p">:</span>  <span class="c1"># å¦‚æœä½¿ç”¨weakåˆ™å­˜å‚¨è¯¥receiverçš„å¼±å¼•ç”¨ï¼Œå¦åˆ™å°±ç›´æ¥å­˜å‚¨å¼ºå¼•ç”¨(å¼ºå¼•ç”¨æœ€ç»ˆéœ€è¦æ‰‹åŠ¨disconnect)</span>
            <span class="n">ref</span> <span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ref</span>
            <span class="n">receiver_object</span> <span class="o">=</span> <span class="n">receiver</span>  <span class="c1"># å¼ºå¼•ç”¨</span>
            <span class="c1"># Check for bound methods</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">receiver</span><span class="p">,</span> <span class="s1">&#39;__self__&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">receiver</span><span class="p">,</span> <span class="s1">&#39;__func__&#39;</span><span class="p">):</span>  <span class="c1"># æ£€æŸ¥æ˜¯å¦æ˜¯å¯¹è±¡æ–¹æ³•</span>
                <span class="c1"># https://docs.python.org/zh-cn/3/library/weakref.html#weakref.WeakMethod</span>
                <span class="n">ref</span> <span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">WeakMethod</span>
                <span class="n">receiver_object</span> <span class="o">=</span> <span class="n">receiver</span><span class="o">.</span><span class="vm">__self__</span>  <span class="c1"># åŒ…å«è¯¥å¯¹è±¡æ–¹æ³•çš„å¯¹è±¡</span>
            <span class="c1"># ä½¿ç”¨å¼±å¼•ç”¨æ›¿ä»£å¼ºå¼•ç”¨</span>
            <span class="n">receiver</span> <span class="o">=</span> <span class="n">ref</span><span class="p">(</span><span class="n">receiver</span><span class="p">)</span>  <span class="c1"># æ™®é€šå‡½æ•°æ–¹æ³•åˆ™ç›´æ¥å–å…¶å¼±å¼•ç”¨</span>

            <span class="c1"># å½“receiveræ–¹æ³•ã€æˆ–åŒ…å«è¯¥æ–¹æ³•å¯¹è±¡æ¶ˆäº¡æ—¶ä»signalçš„receiversåˆ—è¡¨ä¸­æ¸…é™¤è¯¥æ¡è®°å½•</span>
            <span class="n">weakref</span><span class="o">.</span><span class="n">finalize</span><span class="p">(</span><span class="n">receiver_object</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remove_receiver</span><span class="p">)</span>
            <span class="c1"># https://docs.python.org/zh-cn/3/library/weakref.html#weakref.finalize</span>
            <span class="c1"># å½“receiverå¯¹è±¡åƒåœ¾å›æ”¶æ—¶è°ƒç”¨_remove_receiverç½®self._dead_receivers = True</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_clear_dead_receivers</span><span class="p">()</span>  <span class="c1"># æ¸…é™¤ã€è¿‡æ»¤dead_receivers</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">r_key</span> <span class="o">==</span> <span class="n">lookup_key</span> <span class="k">for</span> <span class="n">r_key</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">receivers</span><span class="p">):</span>  <span class="c1"># æŸ¥é‡</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">receivers</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">lookup_key</span><span class="p">,</span> <span class="n">receiver</span><span class="p">))</span>  <span class="c1"># æ·»åŠ ((receiver_id,sender_id),receiver_weakref)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sender_receivers_cache</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>  <span class="c1"># å˜æ›´åæ¸…é™¤ç¼“å­˜</span>

    <span class="k">def</span> <span class="nf">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">receiver</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">sender</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">dispatch_uid</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="s2">&#34;&#34;&#34;
</span><span class="s2">        å°†signalä¸­çš„receiverä¸senderâ€œæ–­å¼€è¿æ¥â€
</span><span class="s2">        è¯¥å‡½æ•°ä¸»è¦é’ˆå¯¹é‚£äº›åœ¨connectæ—¶weakå‚æ•°ä¸ºFalseçš„æƒ…å†µï¼Œå³signalçš„receiversåˆ—è¡¨
</span><span class="s2">        ä¸­å­˜å‚¨çš„æ˜¯rceiverçš„å¼ºå¼•ç”¨
</span><span class="s2">
</span><span class="s2">        å¦‚æœåœ¨connectæ—¶ä½¿ç”¨çš„å¼±å¼•ç”¨(weak=True), åˆ™ä¸éœ€è¦æ‰‹åŠ¨è°ƒç”¨disconnectæ–¹æ³•
</span><span class="s2">        receiverå’Œsenderçš„è®°å½•ä¼šè¢«è‡ªåŠ¨åˆ é™¤
</span><span class="s2">
</span><span class="s2">        Arguments:
</span><span class="s2">
</span><span class="s2">            receiver
</span><span class="s2">                The registered receiver to disconnect. May be none if
</span><span class="s2">                dispatch_uid is specified.
</span><span class="s2">
</span><span class="s2">            sender
</span><span class="s2">                The registered sender to disconnect
</span><span class="s2">
</span><span class="s2">            dispatch_uid
</span><span class="s2">                the unique identifier of the receiver to disconnect
</span><span class="s2">        &#34;&#34;&#34;</span>
        <span class="k">if</span> <span class="n">dispatch_uid</span><span class="p">:</span>
            <span class="n">lookup_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">dispatch_uid</span><span class="p">,</span> <span class="n">_make_id</span><span class="p">(</span><span class="n">sender</span><span class="p">))</span>  <span class="c1"># å¦‚æœæä¾›äº†dispatch_uidåˆ™ä½¿ç”¨å…¶æ›¿ä»£ id(receiver)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lookup_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">_make_id</span><span class="p">(</span><span class="n">receiver</span><span class="p">),</span> <span class="n">_make_id</span><span class="p">(</span><span class="n">sender</span><span class="p">))</span>

        <span class="n">disconnected</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_clear_dead_receivers</span><span class="p">()</span>  <span class="c1"># å…ˆæ¸…é™¤dead_receivers</span>
            <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">receivers</span><span class="p">)):</span>
                <span class="p">(</span><span class="n">r_key</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">receivers</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">r_key</span> <span class="o">==</span> <span class="n">lookup_key</span><span class="p">:</span>  <span class="c1"># æ ¹æ®lookup_keyåœ¨self.receiversä¸­æŸ¥æ‰¾</span>
                    <span class="n">disconnected</span> <span class="o">=</span> <span class="bp">True</span>
                    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">receivers</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>  <span class="c1"># åˆ é™¤self.receiversä¸­çš„å¯¹åº”è®°å½•</span>
                    <span class="k">break</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sender_receivers_cache</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>  <span class="c1"># å˜æ›´åæ¸…é™¤ç¼“å­˜</span>
        <span class="k">return</span> <span class="n">disconnected</span>

    <span class="k">def</span> <span class="nf">has_listeners</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sender</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="c1"># é€šè¿‡è°ƒç”¨_live_receiversæ–¹æ³•çœ‹senderçš„reciversæ˜¯å¦ä¸ºç©º</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_live_receivers</span><span class="p">(</span><span class="n">sender</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">send</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sender</span><span class="p">,</span> <span class="o">**</span><span class="n">named</span><span class="p">):</span>
        <span class="s2">&#34;&#34;&#34;
</span><span class="s2">        Send signal from sender to all connected receivers.
</span><span class="s2">        ä»senderä¸­å‘é€ä¿¡å·ç»™æ‰€æœ‰è¿æ¥åˆ°è¯¥senderçš„receiver
</span><span class="s2">
</span><span class="s2">        If any receiver raises an error, the error propagates back through send,
</span><span class="s2">        terminating the dispatch loop. So it&#39;s possible that all receivers
</span><span class="s2">        won&#39;t be called if an error is raised.
</span><span class="s2">
</span><span class="s2">        Arguments:
</span><span class="s2">
</span><span class="s2">            sender
</span><span class="s2">                The sender of the signal. Either a specific object or None.
</span><span class="s2">
</span><span class="s2">            named
</span><span class="s2">                Named arguments which will be passed to receivers.
</span><span class="s2">
</span><span class="s2">        Return a list of tuple pairs [(receiver, response), ... ].
</span><span class="s2">        &#34;&#34;&#34;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">receivers</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">sender_receivers_cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">sender</span><span class="p">)</span> <span class="ow">is</span> <span class="n">NO_RECEIVERS</span><span class="p">:</span>
            <span class="c1"># å¦‚æœè¯¥signalå¾—receiversä¸ºç©ºæˆ–è€…è¯¥senderå¯¹åº”çš„receiversç¼“å­˜ä¸ºç©º</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="k">return</span> <span class="p">[</span>
            <span class="p">(</span><span class="n">receiver</span><span class="p">,</span> <span class="n">receiver</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">sender</span><span class="o">=</span><span class="n">sender</span><span class="p">,</span> <span class="o">**</span><span class="n">named</span><span class="p">))</span>  <span class="c1"># è¿™é‡Œçš„receiverå°±æ˜¯å…·ä½“çš„receiverå‡½æ•°</span>
            <span class="k">for</span> <span class="n">receiver</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_live_receivers</span><span class="p">(</span><span class="n">sender</span><span class="p">)</span>
            <span class="c1"># _live_receiverè¿”å›çš„æ˜¯receiverçš„å¯è°ƒç”¨å¯¹è±¡(å°±æ˜¯å…·ä½“çš„receiverå‡½æ•°ï¼Œå¼ºå¼•ç”¨)çš„åˆ—è¡¨</span>
        <span class="p">]</span>
        <span class="c1"># è¿”å›[(receiverå‡½æ•°,è°ƒç”¨receiverå‡½æ•°çš„ç»“æœ)]å¦‚æœè°ƒç”¨æŸä¸ªreceiveræ—¶å‘ç”Ÿå¼‚å¸¸ç¨‹åºä¼šç›´æ¥é€€å‡º</span>
        <span class="c1"># å¯¼è‡´å…¶ä»–çš„å‰©ä¸‹çš„receiverå¹¶æœªè¢«æ‰§è¡Œ</span>

    <span class="k">def</span> <span class="nf">send_robust</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sender</span><span class="p">,</span> <span class="o">**</span><span class="n">named</span><span class="p">):</span>
        <span class="s2">&#34;&#34;&#34;
</span><span class="s2">        Send signal from sender to all connected receivers catching errors.
</span><span class="s2">
</span><span class="s2">        Arguments:
</span><span class="s2">
</span><span class="s2">            sender
</span><span class="s2">                The sender of the signal. Can be any Python object (normally one
</span><span class="s2">                registered with a connect if you actually want something to
</span><span class="s2">                occur).
</span><span class="s2">
</span><span class="s2">            named
</span><span class="s2">                Named arguments which will be passed to receivers. These
</span><span class="s2">                arguments must be a subset of the argument names defined in
</span><span class="s2">                providing_args.
</span><span class="s2">
</span><span class="s2">        Return a list of tuple pairs [(receiver, response), ... ].
</span><span class="s2">
</span><span class="s2">        If any receiver raises an error (specifically any subclass of
</span><span class="s2">        Exception), return the error instance as the result for that receiver.
</span><span class="s2">        ç›¸æ¯”sendæ–¹æ³•è°ƒç”¨receiveræ–¹æ³•å¼‚å¸¸æ—¶ç›´æ¥é€€å‡ºï¼Œsend_robustä¼šæ”¶é›†å¼‚å¸¸å¹¶è¿”å›
</span><span class="s2">        &#34;&#34;&#34;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">receivers</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">sender_receivers_cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">sender</span><span class="p">)</span> <span class="ow">is</span> <span class="n">NO_RECEIVERS</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="c1"># Call each receiver with whatever arguments it can accept.</span>
        <span class="c1"># Return a list of tuple pairs [(receiver, response), ... ].</span>
        <span class="n">responses</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">receiver</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_live_receivers</span><span class="p">(</span><span class="n">sender</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">receiver</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">sender</span><span class="o">=</span><span class="n">sender</span><span class="p">,</span> <span class="o">**</span><span class="n">named</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="n">responses</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">receiver</span><span class="p">,</span> <span class="n">err</span><span class="p">))</span>  
                <span class="c1"># å¦‚æœè°ƒç”¨receiverå‡ºç°å¼‚å¸¸åˆ™æ•è·å¹¶è¿”å›ç›¸åº”çš„å¼‚å¸¸è€Œä¸å½±å“å…¶ä»–receiverçš„è°ƒç”¨</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">responses</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">receiver</span><span class="p">,</span> <span class="n">response</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">responses</span>

    <span class="k">def</span> <span class="nf">_clear_dead_receivers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Note: caller is assumed to hold self.lock.</span>
        <span class="c1"># æ¸…é™¤dead_receivers</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dead_receivers</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dead_receivers</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">receivers</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">receivers</span>
                <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ReferenceType</span><span class="p">)</span> <span class="ow">and</span> <span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">]()</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)</span>
                <span class="c1"># å¼±å¼•ç”¨ï¼Œå¹¶ä¸”è¯¥å¼±å¼•ç”¨å¯¹åº”çš„å¯¹è±¡å·²æ¶ˆäº¡</span>
            <span class="p">]</span>

    <span class="k">def</span> <span class="nf">_live_receivers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sender</span><span class="p">):</span>
        <span class="s2">&#34;&#34;&#34;
</span><span class="s2">        Filter sequence of receivers to get resolved, live receivers.
</span><span class="s2">
</span><span class="s2">        This checks for weak references and resolves them, then returning only
</span><span class="s2">        live receivers.
</span><span class="s2">        &#34;&#34;&#34;</span>
        <span class="n">receivers</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_caching</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dead_receivers</span><span class="p">:</span>  <span class="c1"># å¦‚æœä½¿ç”¨ç¼“å­˜å¹¶ä¸”self.receiversä¸­æ— dead_receivers</span>
            <span class="n">receivers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sender_receivers_cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">sender</span><span class="p">)</span>  <span class="c1"># ç›´æ¥ä»ç¼“å­˜ä¸­è·å–</span>
            <span class="c1"># We could end up here with NO_RECEIVERS even if we do check this case in</span>
            <span class="c1"># .send() prior to calling _live_receivers() due to concurrent .send() call.</span>
            <span class="c1"># åœ¨è°ƒç”¨_live_receiversæ–¹æ³•çš„æ–¹æ³•ä¸­å·²ç»æ£€æŸ¥è¿‡ä¸€æ¬¡äº†</span>
            <span class="k">if</span> <span class="n">receivers</span> <span class="ow">is</span> <span class="n">NO_RECEIVERS</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">receivers</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>  <span class="c1"># å¦‚æœä¸ä½¿ç”¨ç¼“å­˜æˆ–è€…å­˜åœ¨å¾…æ¸…ç†çš„dead receivers</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_clear_dead_receivers</span><span class="p">()</span>  <span class="c1"># å…ˆæ¸…ç†dead_receivers</span>
                <span class="n">senderkey</span> <span class="o">=</span> <span class="n">_make_id</span><span class="p">(</span><span class="n">sender</span><span class="p">)</span>
                <span class="n">receivers</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="p">(</span><span class="n">receiverkey</span><span class="p">,</span> <span class="n">r_senderkey</span><span class="p">),</span> <span class="n">receiver</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">receivers</span><span class="p">:</span> <span class="c1"># éå†self.receiversè¿›è¡ŒæŸ¥æ‰¾åŒ¹é…</span>
                    <span class="k">if</span> <span class="n">r_senderkey</span> <span class="o">==</span> <span class="n">NONE_ID</span> <span class="ow">or</span> <span class="n">r_senderkey</span> <span class="o">==</span> <span class="n">senderkey</span><span class="p">:</span>  <span class="c1"># å¦‚æœsenderkeyä¸ºid(None)æˆ–åŒ¹é…</span>
                        <span class="n">receivers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">receiver</span><span class="p">)</span>  <span class="c1"># å°†receiver(weakref)æ·»åŠ åˆ°receiversä¸­</span>
                <span class="c1"># æ›´æ–°ç¼“å­˜</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_caching</span><span class="p">:</span>  <span class="c1"># å¦‚æœä½¿ç”¨ç¼“å­˜</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">receivers</span><span class="p">:</span>  <span class="c1"># å¦‚æœè¯¥senderæ²¡æœ‰receiver (receiversä¸ºç©º)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">sender_receivers_cache</span><span class="p">[</span><span class="n">sender</span><span class="p">]</span> <span class="o">=</span> <span class="n">NO_RECEIVERS</span>  <span class="c1"># å°†cacheä¸­è¯¥senderçš„receiversç½®ä¸ºç©º</span>
                    <span class="k">else</span><span class="p">:</span>  <span class="c1"># å¦‚æœè¯¥senderå­˜åœ¨å¯¹åº”çš„receiver</span>
                        <span class="c1"># Note, we must cache the weakref versions.</span>
                        <span class="c1"># æ³¨æ„æˆ‘ä»¬åº”è¯¥ç¼“å­˜å¼±å¼•ç”¨</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">sender_receivers_cache</span><span class="p">[</span><span class="n">sender</span><span class="p">]</span> <span class="o">=</span> <span class="n">receivers</span>  <span class="c1"># å°†è¯¥senderåŠå…¶æ‰€æœ‰çš„receiversç¼“å­˜èµ·æ¥</span>
        <span class="n">non_weak_receivers</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">receiver</span> <span class="ow">in</span> <span class="n">receivers</span><span class="p">:</span>  <span class="c1"># receiversè¦ä¹ˆä¸º[] è¦ä¹ˆä¸º[receiver]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">receiver</span><span class="p">,</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ReferenceType</span><span class="p">):</span>
                <span class="c1"># Dereference the weak reference.</span>
                <span class="c1"># https://www.kite.com/python/docs/weakref.ReferenceType</span>
                <span class="n">receiver</span> <span class="o">=</span> <span class="n">receiver</span><span class="p">()</span>  <span class="c1"># è·å–å¼±å¼•ç”¨æ‰€æŒ‡çš„å®é™…å¯¹è±¡ï¼Œè‹¥å·²æ¶ˆäº¡åˆ™è¿”å›Noneï¼Œå¦åˆ™è¿”å›å¯¹è±¡çš„å¼ºå¼•ç”¨(â€œå¯ç›´æ¥è°ƒç”¨â€)</span>
                <span class="k">if</span> <span class="n">receiver</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>  <span class="c1"># refæ‰€æŒ‡çš„åŸå¯¹è±¡å°šæœªæ¶ˆäº¡</span>
                    <span class="n">non_weak_receivers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">receiver</span><span class="p">)</span>  <span class="c1"># æ·»åŠ å®é™…å¯è°ƒç”¨çš„å¯¹è±¡</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">non_weak_receivers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">receiver</span><span class="p">)</span>  <span class="c1"># ä¸æ˜¯å¼±å¼•ç”¨åˆ™ç›´æ¥æ·»åŠ </span>
        <span class="k">return</span> <span class="n">non_weak_receivers</span>  <span class="c1"># å¯è°ƒç”¨å¯¹è±¡receiverçš„åˆ—è¡¨</span>

    <span class="k">def</span> <span class="nf">_remove_receiver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">receiver</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="c1"># Mark that the self.receivers list has dead weakrefs. If so, we will</span>
        <span class="c1"># clean those up in connect, disconnect and _live_receivers while</span>
        <span class="c1"># holding self.lock. Note that doing the cleanup here isn&#39;t a good</span>
        <span class="c1"># idea, _remove_receiver() will be called as side effect of garbage</span>
        <span class="c1"># collection, and so the call can happen while we are already holding</span>
        <span class="c1"># self.lock.</span>
        <span class="c1"># æ ‡è®°self.receiversä¸­æœ‰dead weakrefs(weakrefæ‰€æŒ‡å¯¹è±¡å·²æ¶ˆäº¡).å¦‚æœå­˜åœ¨dead receiver</span>
        <span class="c1"># ç¨‹åºä¼šåœ¨è°ƒç”¨connect, disconnectå’Œ_live_receiversæ—¶åœ¨åŠ é”çš„æƒ…å†µä¸‹æ¸…é™¤dead weakrefs</span>
        <span class="c1"># æ³¨æ„åœ¨è¿™é‡Œæ‰§è¡Œå…·ä½“çš„æ¸…é™¤æ“ä½œå¹¶ä¸æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ï¼Œåœ¨åƒåœ¾å›æ”¶æ—¶_remove_receiver()ä¼šè¢«</span>
        <span class="c1"># è‡ªåŠ¨è§¦å‘ï¼Œè€Œæˆ‘ä»¬å¯èƒ½åœ¨å…¶ä»–æ“ä½œä¸­å¯¹receiversåŠ äº†é”ï¼Œæ­¤æ—¶æ¸…ç†receiverså°†ä¼šå¯¼è‡´å†²çª</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dead_receivers</span> <span class="o">=</span> <span class="bp">True</span>


<span class="k">def</span> <span class="nf">receiver</span><span class="p">(</span><span class="n">signal</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="s2">&#34;&#34;&#34;
</span><span class="s2">    A decorator for connecting receivers to signals. Used by passing in the
</span><span class="s2">    signal (or list of signals) and keyword arguments to connect::
</span><span class="s2">    ç”¨æ¥å°†receiversè¿æ¥åˆ°å¯¹åº”signalçš„è£…é¥°å™¨. ä½¿ç”¨æ—¶ä¼ å…¥signal(æˆ–è€…æ˜¯è£…æœ‰signalçš„åˆ—è¡¨)
</span><span class="s2">    ä»¥åŠç›¸å…³çš„å…³é”®å­—å‚æ•°
</span><span class="s2">
</span><span class="s2">        @receiver(post_save, sender=MyModel)
</span><span class="s2">        def signal_receiver(sender, **kwargs):
</span><span class="s2">            ...
</span><span class="s2">
</span><span class="s2">        @receiver([post_save, post_delete], sender=MyModel)
</span><span class="s2">        def signals_receiver(sender, **kwargs):
</span><span class="s2">            ...
</span><span class="s2">    &#34;&#34;&#34;</span>
    <span class="k">def</span> <span class="nf">_decorator</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">signal</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>  <span class="c1"># ä¼ å…¥çš„æ˜¯signalåˆ—è¡¨</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">signal</span><span class="p">:</span>
                <span class="n">s</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># è°ƒç”¨connectæ–¹æ³•ï¼Œsenderçš„ä¿¡æ¯åŒ…å«åœ¨kwargsä¸­äº†</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">signal</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">func</span>
    <span class="k">return</span> <span class="n">_decorator</span>

</code></pre></div><p>é™¤æ­¤ä¹‹å¤–ï¼Œdjangoå·²ç»ä¸ºæˆ‘ä»¬é¢„ç½®äº†ä¸€äº›ä¿¡å·:</p>
<p><code>pre_init</code>ã€<code>post_init</code>ã€<code>pre_save</code>ã€<code>post_save</code>ã€<code>pre_delete</code>ã€<code>post_delete</code>ã€<code>m2m_change</code>â€¦â€¦(<a class="link" href="https://docs.djangoproject.com/zh-hans/3.0/ref/signals/"  target="_blank" rel="noopener"
    >è¯¦ç»†ç”¨æ³•è§å®˜æ–¹æ–‡æ¡£</a>)</p>
<p>djangoåœ¨<a class="link" href="https://github.com/django/django/blob/main/django/db/models/signals.py"  target="_blank" rel="noopener"
    ><code>django/db/models/signals.py</code></a>ä¸­å®šä¹‰äº†ä¸æ•°æ®åº“Modelç›¸å…³çš„ä¿¡å·å¯¹è±¡:</p>
<ul>
<li><a class="link" href="https://docs.djangoproject.com/zh-hans/3.0/ref/signals/#pre-init"  target="_blank" rel="noopener"
    >pre_init &amp; post_init</a></li>
<li><a class="link" href="https://docs.djangoproject.com/zh-hans/3.0/ref/signals/#pre-save"  target="_blank" rel="noopener"
    >pre_save &amp; post_save</a></li>
<li><a class="link" href="https://docs.djangoproject.com/zh-hans/3.0/ref/signals/#pre-delete"  target="_blank" rel="noopener"
    >pre_delete &amp; post_delete</a></li>
<li><a class="link" href="https://docs.djangoproject.com/zh-hans/3.0/ref/signals/#m2m-changed"  target="_blank" rel="noopener"
    >m2m_change</a></li>
<li><a class="link" href="https://docs.djangoproject.com/zh-hans/3.0/ref/signals/#class-prepared"  target="_blank" rel="noopener"
    >class_prepared</a></li>
<li><a class="link" href="https://docs.djangoproject.com/zh-hans/3.0/ref/signals/#pre-migrate"  target="_blank" rel="noopener"
    >pre_migrate &amp; post_migrate</a></li>
</ul>
<p>åœ¨<a class="link" href="https://github.com/django/django/blob/main/django/core/signals.py"  target="_blank" rel="noopener"
    ><code>django/core/signals.py</code></a>ä¸­å®šä¹‰äº†ä¸requestå’Œsettingç›¸å…³çš„ä¿¡å·å¯¹è±¡:</p>
<ul>
<li><a class="link" href="https://docs.djangoproject.com/zh-hans/3.0/ref/signals/#request-started"  target="_blank" rel="noopener"
    >request_started &amp; request_finished</a></li>
<li><a class="link" href="https://docs.djangoproject.com/zh-hans/3.0/ref/signals/#got-request-exception"  target="_blank" rel="noopener"
    >got_request_exception</a></li>
<li><a class="link" href="https://docs.djangoproject.com/zh-hans/3.0/ref/signals/#setting-changed"  target="_blank" rel="noopener"
    >setting_changed</a></li>
</ul>
<p>djangoä¸ºæˆ‘ä»¬é¢„ç½®è¿™äº›ä¿¡å·å¯¹è±¡ï¼Œå¹¶ä¸”åœ¨<u>é€‚å½“çš„æ—¶å€™</u>è°ƒç”¨<u>é€‚å½“çš„ä¿¡å·å¯¹è±¡</u>å‘é€<u>é€‚å½“çš„â€œä¿¡å·â€</u>ã€‚æ¯”å¦‚åœ¨<a class="link" href="https://github.com/django/django/blob/316cc34d046ad86e100227772294f906fae1c2e5/django/db/models/base.py#L404"  target="_blank" rel="noopener"
    ><code>django/db/models/base.py</code></a>ä¸­ï¼Œåœ¨Modelç±»çš„__init__æ–¹æ³•å¼€å§‹ä½ç½®è°ƒç”¨<a class="link" href="https://github.com/django/django/blob/316cc34d046ad86e100227772294f906fae1c2e5/django/db/models/base.py#L415"  target="_blank" rel="noopener"
    >pre_init.send()</a>åœ¨__init__çš„ç»“æŸä½ç½®è°ƒç”¨<a class="link" href="https://github.com/django/django/blob/316cc34d046ad86e100227772294f906fae1c2e5/django/db/models/base.py#L509"  target="_blank" rel="noopener"
    >post_init.send()</a>ï¼Œè€Œæˆ‘ä»¬çš„modelåˆéƒ½æ˜¯ç»§æ‰¿è‡ªè¯¥Modelã€‚</p>
<p>djangoä¸ºæˆ‘ä»¬é¢„ç½®å¥½äº†ä¸€äº›ä¿¡å·ï¼Œå¹¶ä¸”åœ¨åšç›¸åº”æ“ä½œæ—¶ä¼šå‘é€å¯¹åº”çš„ä¿¡å·ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯åœ¨éœ€è¦ç”¨åˆ°æ—¶ï¼Œå®šä¹‰å¯¹åº”çš„receiverå»æ¥æ”¶å¯¹åº”çš„ä¿¡å·ğŸ“¶å³å¯ã€‚å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥å®ä¾‹åŒ–æˆ–ç»§æ‰¿Signalç±»æ¥å®šä¹‰æˆ‘ä»¬è‡ªå·±çš„ä¿¡å·ã€‚å…·ä½“çš„ä½¿ç”¨å¯ä»¥å‚è§<a class="link" href="https://www.liujiangblog.com/course/django/170"  target="_blank" rel="noopener"
    >è¿™ç¯‡åšå®¢</a></p>
<h3 id="ä¸€äº›å¯èƒ½æœ‰ç”¨çš„é“¾æ¥">ä¸€äº›å¯èƒ½æœ‰ç”¨çš„é“¾æ¥</h3>
<ul>
<li><a class="link" href="https://docs.python.org/zh-cn/3/library/weakref.html"  target="_blank" rel="noopener"
    >Python å¼±å¼•ç”¨</a></li>
<li>Python åƒåœ¾å›æ”¶
<ol>
<li><a class="link" href="https://docs.python.org/zh-cn/3.8/library/gc.html"  target="_blank" rel="noopener"
    >python gcæ¨¡å—æ¥å£æ–‡æ¡£</a></li>
<li><a class="link" href="https://www.jianshu.com/p/1e375fb40506"  target="_blank" rel="noopener"
    >ç®€ä¹¦ Pythonåƒåœ¾å›æ”¶æœºåˆ¶</a></li>
<li><a class="link" href="https://zhuanlan.zhihu.com/p/83251959"  target="_blank" rel="noopener"
    >çŸ¥ä¹ Pythonåƒåœ¾å›æ”¶æœºåˆ¶</a></li>
</ol>
</li>
</ul>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/python/">python</a>
        
            <a href="/tags/django/">django</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>

    
</article>

    <aside class="related-contents--wrapper">
    
    
        <h2 class="section-title">Related contents</h2>
        <div class="related-contents">
            <div class="flex article-list--tile">
                
                    
<article class="has-image">
    <a href="/p/top-6-django-decorators/">
        
        
            <div class="article-image">
                <img src="/p/top-6-django-decorators/_hu3d03a01dcc18bc5be0e67db3d8d209a6_149949_153c978c4bce9cab5600dcb5341107b4.jpg" 
                        width="250" 
                        height="150" 
                        loading="lazy" 
                        data-key="top-6-django-decorators" 
                        data-hash="md5-PRnx8Jul2UCqDWD5pa/ytA=="
                        referrer="no-referrer|origin|unsafe-url">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">Top 6 Django Decorators</h2>
        </div>
    </a>
</article>
                
                    
<article class="has-image">
    <a href="/p/internal-sort/">
        
        
            <div class="article-image">
                <img src="/p/internal-sort/_hu3d03a01dcc18bc5be0e67db3d8d209a6_55454_2b8512ae7c6cc1351d689b45567ba42e.jpg" 
                        width="250" 
                        height="150" 
                        loading="lazy" 
                        data-key="internal sort" 
                        data-hash="md5-3lXz&#43;sQLfNqSI4vWVm6ELQ=="
                        referrer="no-referrer|origin|unsafe-url">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">å¸¸ç”¨å†…éƒ¨æ’åºç®—æ³•</h2>
        </div>
    </a>
</article>
                
                    
<article class="has-image">
    <a href="/p/implementing-a-trie-in-python/">
        
        
            <div class="article-image">
                <img src="/p/implementing-a-trie-in-python/trie.02fdb0bd3268abc47c744733f52d5d50_hu5ca3eeea9d4841595d42211afa052e1d_72289_250x150_fill_q75_box_smart1.jpeg" 
                        width="250" 
                        height="150" 
                        loading="lazy" 
                        data-key="implementing a trie in Python" 
                        data-hash="md5-Av2wvTJoq8R8dEcz9S1dUA=="
                        referrer="no-referrer|origin|unsafe-url">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">Implementing a Trie in Python</h2>
        </div>
    </a>
</article>
                
                    
<article class="has-image">
    <a href="/p/neural-network-with-python/">
        
        
            <div class="article-image">
                
                    <img src="https://images.unsplash.com/photo-1590859808308-3d2d9c515b1a?ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&amp;amp;ixlib=rb-1.2.1&amp;amp;auto=format&amp;amp;fit=crop&amp;amp;w=1653&amp;amp;q=80" loading="lazy" data-key="neural network with python" data-hash="https://images.unsplash.com/photo-1590859808308-3d2d9c515b1a?ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&amp;amp;ixlib=rb-1.2.1&amp;amp;auto=format&amp;amp;fit=crop&amp;amp;w=1653&amp;amp;q=80" referrer="no-referrer|origin|unsafe-url"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">Neural Network With Python</h2>
        </div>
    </a>
</article>
                
            </div>
        </div>
    
</aside>


    
        
    <div id="vcomments" class="valine-container"></div>
<style>
    .valine-container {
        background-color: var(--card-background);
        border-radius: var(--card-border-radius);
        box-shadow: var(--shadow-l1);
        padding: var(--card-padding);
    }
</style>
<script async="async">
    new Valine({
        el: '#vcomments',  
        serverURLs: 'https://us.avoscloud.com',
        appId: 'GvRq0fD2lU22a9zvtTz1KWbr-MdYXbMMI',
        appKey: 'ii7hhKwHBCBo95atXNpFNcLf',
    })
</script>

    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2019 - 
        
        2023 Heaciy&#39;s Blog
    </section>
    
    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        Theme <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="2.3.0">Stack</a></b> designed by <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a>
    </section>
</footer>
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer="true"
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer="true"
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css"integrity="sha256-c0uckgykQ9v5k&#43;IqViZOZKc47Jn7KQil4/MP3ySA3F8="crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css"integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE="crossorigin="anonymous"
            >
            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js"integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g="crossorigin="anonymous"
                defer="false"
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
